(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{115:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));var s=a(19);const r=a.n(s).a.create({baseURL:"https://hcfy.limingkai.cn/"})},145:function(t,e,a){"use strict";a.d(e,"c",(function(){return c})),a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return d}));var s=a(15),r=a(3),n=a(116),i=a.n(n);async function c(){const t=await browser.storage.local.get(r.a),e=await s.a.put("/options",{options:JSON.stringify(t)});await browser.storage.local.set({optionsSyncAt:e.data})}async function o(t){let e;t||(e=(await browser.storage.local.get("optionsSyncAt")).optionsSyncAt);const a=await s.a.get("/options",{params:{ifModifiedSince:e}});if(204===a.status)return"no-data";if(304===a.status)return"not-modified";const n=a.data;if(!n)return"server-data-error";let c;try{c=JSON.parse(n.optionsString)}catch(t){return"server-data-error"}return i()(await browser.storage.local.get(r.a),c)?(await browser.storage.local.set({optionsSyncAt:n.updatedAt}),"not-modified"):t||e?(c.optionsSyncAt=n.updatedAt,await browser.storage.local.set(c),"covered"):{status:"need-confirm",date:n.updatedAt}}async function d(){const t=await o();return"no-data"===t?(await c(),"uploaded"):t}},164:function(t,e,a){"use strict";a.d(e,"b",(function(){return d})),a.d(e,"a",(function(){return u}));var s=a(298),r=a(105),n=a(90),i=a(183),c=a(95);const o=(t,e)=>{t._id?(t.deleted=!0,t.syncStatus=d.Pending):delete e.value};var d;!function(t){t.Pending="Pending"}(d||(d={}));class u{constructor(t,e,a,s,r,n,i,c){this.table=t,this.syncKeys=e.concat("date"),this.getDataFromServer=a,this.syncTimeStorageKey=s,this.deleteData=r,this.commitChanges=n,this.pullChanges=i,this.deleteLogsFn=c}async add(t,e){const a={...t},n=Date.now();a.id=Object(s.a)(n+"-"),a.date=n,a.syncStatus=d.Pending,await this.table.add(a),e&&this.commit().catch(r.a)}async deleteById(t,e){await this.table.where("id").anyOf(t).modify(o),e&&this.commit().catch(r.a)}async deleteAll(t){let e;t&&(e=await this.deleteData()),await this.table.clear(),e&&await this.setSyncTime(e)}async deleteByKey(t,e,a){await this.table.where(t).equalsIgnoreCase(e).modify(o),a&&this.commit().catch(r.a)}async hasByKey(t,e){return await this.table.where(t).equalsIgnoreCase(e).and((t=>!t.deleted)).count()>0}query(t,e,a){const s=e?this.table.where("date").below(e).reverse():this.table.orderBy("date").reverse();return s.filter(a?t=>!t.deleted&&a(t):t=>!t.deleted),s.limit(t).toArray()}async getSyncChanges(){const t=await this.table.where("syncStatus").equals(d.Pending).toArray(),e=[],a=[],s=[];return t.forEach((t=>{t._id?t.deleted&&s.push(t._id):(e.push(Object(n.a)(t,this.syncKeys)),a.push(t.id))})),{changes:{added:Object(i.a)(e)?void 0:e,deleted:Object(i.a)(s)?void 0:s},addedLocalIds:a}}addServerData(t){return c.a.transaction("rw",this.table,(async()=>{const e=Date.now()+"-",a=t.map((t=>(t.id=Object(s.a)(e),t._id)));await this.table.where("_id").anyOf(a).delete(),await this.table.bulkAdd(t)}))}async downloadData(t){const e=await this.getDataFromServer(t),a=e.list;return Array.isArray(a)&&a.length&&await this.addServerData(a),e.date}setSyncTime(t){return browser.storage.local.set({[this.syncTimeStorageKey]:t})}async commit(){const{changes:t,addedLocalIds:e}=await this.getSyncChanges(),a=await this.commitChanges(t);Object(i.a)(a)||await this.table.where("id").anyOf(e).modify((t=>{const s=e.indexOf(t.id);s>=0&&(t._id=a[s],delete t.syncStatus)}))}async pull(t){const e=(await browser.storage.local.get(this.syncTimeStorageKey))[this.syncTimeStorageKey];if(!e){const t=await this.downloadData();return await this.setSyncTime(t),this.deleteLogsFn(t).catch(r.a),!0}if(!t)return!1;const{changes:a,date:s}=await this.pullChanges(e);let n;const o=a.reduce(((t,e)=>{var a,s;return e.deleteAll?(t.added.clear(),t.deleted.clear(),n=!0,t):(null===(a=e.added)||void 0===a||a.forEach((e=>{t.added.add(e)})),null===(s=e.deleted)||void 0===s||s.forEach((e=>{t.added.has(e)?t.added.delete(e):t.deleted.add(e)})),t)}),{added:new Set,deleted:new Set});let d,u=[];const l=!!o.added.size;o.added.size&&(u=await this.table.where("_id").anyOf(Array.from(o.added)).toArray(),u.forEach((t=>{o.added.delete(t._id)})),o.added.size&&(d=(await this.getDataFromServer(Array.from(o.added))).list));const h=n||!!d||!!o.deleted.size;return h&&await c.a.transaction("rw",this.table,(async()=>{n&&(await this.table.clear(),!Object(i.a)(u)&&await this.table.bulkAdd(u));const t=[];return d&&t.push(this.addServerData(d)),o.deleted.size&&t.push(this.table.where("_id").anyOf(Array.from(o.deleted)).delete()),Promise.all(t)})),await this.setSyncTime(s),(h||l)&&this.deleteLogsFn(s).catch(r.a),h}}},175:function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return c}));var s=a(95),r=a(164),n=a(15);const i=new r.a(s.a.historyRecords,["text","url","favicon","title"],(async t=>(await n.a.post("/histories",t)).data),"historiesSyncAt",(async()=>(await n.a.delete("/histories")).data),(async t=>(await n.a.put("/histories",t)).data),(async t=>(await n.a.get("/histories?lastCheck="+t)).data),(t=>n.a.delete("/histories/logs?date="+t)));function c(t,e,a){let s;if(a){const t=a.toLocaleLowerCase();s=e=>e.title.toLocaleLowerCase().includes(t)||e.url.toLocaleLowerCase().includes(t)||e.text.toLocaleLowerCase().includes(t)}return i.query(t,e,s)}},224:function(t,e,a){"use strict";a.d(e,"b",(function(){return u})),a.d(e,"a",(function(){return l}));var s=a(225),r=a(90),n=a(3),i=a(398);const c={workerPath:"worker.min.js",corePath:"tesseract-core.wasm.js",langPath:"https://tessdata.projectnaptha.com/4.0.0_best",workerBlobURL:!1},o=Object(r.a)(n.a,["localOCR"]);class d extends s.a{async ocrDirect(t){const e=(await browser.storage.local.get(o)).localOCR.lang,a=Object(i.createWorker)(c);await a.load(),await a.loadLanguage(e),await a.initialize(e),await a.setParameters({tessjs_create_hocr:"0",tessjs_create_tsv:"0",preserve_interword_spaces:"1"});const s=await a.recognize(t);return a.terminate(),s.data}transform(t){return t.paragraphs.map((t=>t.text.trim().replace(/\r?\n/g," "))).join("\n")}}const u={id:"tesseractocr",name:"Tesseract OCR"},l=new d(u)},225:function(t,e,a){"use strict";a.d(e,"a",(function(){return c}));var s=a(85),r=a(44),n=a(15),i=a(70);class c extends s.a{constructor(t,e){super(t),this.noRetry=e}isSuccessResponse(t){return!0}async ocrByHcfy(t){return(await n.a.post("/ocr",{api:this.service.id,image:t})).data.serverResponse}async ocr(t){const e=await this.getCallType();if(!e.ok)throw new r.a({type:e.reason,message:e.message});let a;switch(e.type){case 2:case 1:a=await(this.noRetry?this.ocrDirect(t,e.secretKeyInStorage?Object(s.b)(e.secretKeyInStorage):void 0):Object(i.a)((()=>this.ocrDirect(t,e.secretKeyInStorage?Object(s.b)(e.secretKeyInStorage):void 0))));break;case 0:a=await this.ocrByHcfy(t)}if(this.isSuccessResponse(a))return this.transform(a);throw new r.a({type:"API_SERVER_ERROR",message:`${this.service.name}报错了。`})}}},247:function(t,e,a){"use strict";a.d(e,"a",(function(){return d})),a.d(e,"b",(function(){return u}));var s=a(225),r=a(19),n=a.n(r),i=a(49);class c{constructor(t){this.accessTokenObj=null,this.accessTime=0,this.key=t}async requestAccessToken(){const t=await n.a.post("https://aip.baidubce.com/oauth/2.0/token",Object(i.a)({grant_type:"client_credentials",client_id:this.key.id,client_secret:this.key.key}));if(null==(e=t.data)?void 0:e.error)throw new Error("获取百度智能云授权码时失败，请稍后重试。错误消息："+t.data.error+": "+t.data.error_description);var e;return t.data}async getAccessToken(){let t=this.accessTokenObj;return(!t||(Date.now()-this.accessTime)/1e3>=t.expires_in)&&(t=await this.requestAccessToken(),this.accessTokenObj=t,this.accessTime=Date.now()),t.access_token}async ocr(t){return async function(t,e){const a={image:t.replace(/^data:[^;]+;base64,/,""),paragraph:"true",language_type:"auto_detect"};return(await n.a.post("https://aip.baidubce.com/rest/2.0/ocr/v1/accurate_basic?access_token="+e,Object(i.a)(a))).data}(t,await this.getAccessToken())}}class o extends s.a{async ocrDirect(t,e){if(!e)throw new Error(`未提供${this.service.name}的密钥。`);return new c(e).ocr(t)}transform(t){return t.paragraphs_result.reduce(((e,{words_result_idx:a})=>(e.push(a.reduce(((e,a)=>e+t.words_result[a].words),"")),e)),[]).join("\n")}}const d={id:"bdocr",name:"百度大脑通用文字识别（高精度版）",points:!0,secretKey:{storageKey:"baiDuOCRKey",legacy:!0,keyDocLink:"https://hcfy.limingkai.cn/docs/services/baidu-ocr",idLabel:"API Key",keyLabel:"Secret Key"}},u=new o(d)},32:function(t,e,a){"use strict";function s(t){return`${t.host}${t.path}`}function r(t){const e=t.match(/^(([^:]+):\/\/)?([^/]+)?(\/.*)?$/);if(!e)return;let a=e[3]||"";const s=a.indexOf(":");s>=0&&(a=a.slice(0,s));let r=e[4]||"";const n=r.indexOf("#");if(n>=0&&(r=r.slice(0,n)),!a.startsWith(".")){if(!r){if(!a)return;r="/"}return{host:a,path:r}}}function n(t,e){return new RegExp("^"+t.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".*").replace(/^\.\*\\\./,"(.*\\.)?")+"$").test(e)}function i(t,e){return new RegExp("^"+t.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(e)}function c(t,e){let a;if(a="string"==typeof e?r(e):e,a)return{isHostMatch:{ruleHost:t.host,urlHost:a.host,matches:n(t.host,a.host)},isPathMatch:{rulePath:t.path,urlPath:a.path,matches:i(t.path,a.path)}}}function o(t,e,a){let s,c;s="string"==typeof t?r(t):t;let o=!1,d=!1;if(s){const t=t=>{const e=function(t,e){let a;if(a="string"==typeof e?r(e):e,a)return n(t.host,a.host)&&i(t.path,a.path)}(t,s);return e&&(c=t),e};o=a.some(t),o||(d=e.some(t))}return{urlParts:s,matchedRule:c,whiteListMatched:o,blackListMatched:d}}function d(t,e,a){const s=o(t,e,a);return!s.urlParts||s.whiteListMatched||!s.blackListMatched}a.d(e,"e",(function(){return s})),a.d(e,"a",(function(){return r})),a.d(e,"d",(function(){return c})),a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return d}))},86:function(t,e,a){"use strict";a.d(e,"b",(function(){return o})),a.d(e,"a",(function(){return d})),a.d(e,"c",(function(){return u})),a.d(e,"d",(function(){return l}));var s=a(95),r=a(164),n=a(15),i=a(255),c=a(666);function o(t){const e=[];Object(i.a)(t,(t=>{if(!t)return;const a=t.from+" "+t.to,s=e.findIndex((t=>t[0]===a));s>=0?e[s][1]+=1:e.push([a,1])}));const a=Object(c.a)(e,(t=>t[1]));if(a){const t=a[0].split(" ");return{from:t[0],to:t[1]}}}const d=new r.a(s.a.favorites,["text","dir"],(async t=>(await n.a.post("/favorites",t)).data),"favoritesSyncAt",(async()=>(await n.a.delete("/favorites")).data),(async t=>(await n.a.put("/favorites",t)).data),(async t=>(await n.a.get("/favorites?lastCheck="+t)).data),(t=>n.a.delete("/favorites/logs?date="+t)));async function u(t){return d.hasByKey("text",t)}function l(t,e,a){let s;if(a){const t=a.toLocaleLowerCase();s=e=>{if(e.text.toLocaleLowerCase().includes(t))return!0;const a=e.results;return!!a&&Object.keys(a).some((e=>{var s,r;const n=a[e];return!!n&&(!!(null===(s=n.dict)||void 0===s?void 0:s.some((e=>e.terms.some((e=>e.includes(t))))))||!!(null===(r=n.result)||void 0===r?void 0:r.some((e=>e.includes(t)))))}))}}return d.query(t,e,s)}},89:function(t,e,a){"use strict";a.d(e,"e",(function(){return c})),a.d(e,"d",(function(){return o})),a.d(e,"c",(function(){return d})),a.d(e,"b",(function(){return u})),a.d(e,"a",(function(){return l}));var s=a(70),r=a(255),n=a(415);let i;const c=()=>i||(i=Object(s.a)((()=>new Promise(((t,e)=>{const a=window.speechSynthesis.getVoices();a.length?t(a):e(new Error("无法获取系统支持的语音列表，请稍后重试。"))}))),{delay:500,count:10}).then((t=>{const e={},a={};t.forEach((t=>{const s=t.lang;e[s]?e[s].push(t):e[s]=[t];const r=s.slice(0,s.indexOf("-"));a[r]?a[r].indexOf(s)<0&&a[r].push(s):a[r]=[s]}));const s=[],n={};return Object(r.a)(e,((t,a)=>{1===t.length&&(s.push(a),n[a]=t[0],delete e[a])})),Object(r.a)(a,((t,e)=>{1===t.length&&delete a[e]})),{singleVoiceMap:n,singleList:s,voicesGroup:e,multipleLang:a}}))),o={"中文(简体)":"zh-CN","中文(粤语)":"zh-HK","中文(繁体)":"zh-TW","英语":"en","英语(英国)":"en-GB","英语(美国)":"en-US","英语(加拿大)":"en-CA","英语(澳大利亚)":"en-AU","英语(印度)":"en-IN","英语(爱尔兰)":"en-IE","英语(南非)":"en-ZA","德语":"de-DE","西班牙语":"es-ES","西班牙语(墨西哥)":"es-MX","西班牙语(美国)":"es-US","西班牙语(阿根廷)":"es-AR","法语":"fr-FR","法语(加拿大)":"fr-CA","印地语":"hi-IN","印尼语":"id-ID","意大利语":"it-IT","日语":"ja-JP","韩语":"ko-KR","荷兰语":"nl-NL","荷兰语(比利时)":"nl-BE","波兰语":"pl-PL","葡萄牙语":"pt-PT","葡萄牙语(巴西)":"pt-BR","俄语":"ru-RU","土耳其语":"tr-TR","瑞典语":"sv-SE","希伯来语":"he-IL","罗马尼亚语":"ro-RO","泰语":"th-TH","斯洛伐克语":"sk-SK","阿拉伯语":"ar-SA","匈牙利语":"hu-HU","希腊语":"el-GR","挪威语":"nb-NO","丹麦语":"da-DK","芬兰语":"fi-FI","捷克语":"cs-CZ"},d=Object(n.a)(o),u={"中文(简体)":"zh","英语":"en","法语":"fr","西班牙语":"es","荷兰语":"nl","葡萄牙语":"pt"},l=Object(n.a)(u);l.zh="中文"},95:function(t,e,a){"use strict";var s=a(397);class r extends s.a{constructor(){super("hcfy"),this.version(3).stores({historyRecords:"id,date,_id,syncStatus",favorites:"id,date,text,_id,syncStatus"}),this.historyRecords=this.table("historyRecords"),this.favorites=this.table("favorites")}}e.a=new r}}]);