!function(e){function t(t){for(var r,o,i=t[0],l=t[1],u=t[2],d=0,f=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(s&&s(t);f.length;)f.shift()();return c.push.apply(c,u||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,i=1;i<n.length;i++){var l=n[i];0!==a[l]&&(r=!1)}r&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={13:0},c=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var s=l;c.push([647,0,2,4,1,3,5]),n()}({108:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return c}));var r=n(57);async function a(e){var t;try{let t;if(t=void 0===e?(await browser.tabs.executeScript({code:"window.location.href",runAt:"document_start"}))[0]:(await browser.tabs.executeScript(e,{code:"window.location.href",runAt:"document_start"}))[0],t.startsWith("moz-extension"))throw new Error;return t}catch(n){if(void 0===e&&!(e=null===(t=await Object(r.a)())||void 0===t?void 0:t.id))return;try{return await browser.tabs.sendMessage(e,"get tab url")}catch(e){}}}function c(){const e=e=>{if("get tab url"===e)return Promise.resolve(window.location.href)};return browser.runtime.onMessage.addListener(e),()=>{browser.runtime.onMessage.removeListener(e)}}},288:function(e,t,n){},290:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(11),a=n(121),c="undefined"!=typeof document?new a.a(document.documentElement,r.FOCUS_DISABLED):{isActive:function(){return!0},start:function(){return!0},stop:function(){return!0}},o={alwaysShowFocus:function(){return c.stop()},isActive:function(){return c.isActive()},onlyShowFocusOnTabs:function(){return c.start()}}},32:function(e,t,n){"use strict";function r(e){return`${e.host}${e.path}`}function a(e){const t=e.match(/^(([^:]+):\/\/)?([^/]+)?(\/.*)?$/);if(!t)return;let n=t[3]||"";const r=n.indexOf(":");r>=0&&(n=n.slice(0,r));let a=t[4]||"";const c=a.indexOf("#");if(c>=0&&(a=a.slice(0,c)),!n.startsWith(".")){if(!a){if(!n)return;a="/"}return{host:n,path:a}}}function c(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".*").replace(/^\.\*\\\./,"(.*\\.)?")+"$").test(t)}function o(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(t)}function i(e,t){let n;if(n="string"==typeof t?a(t):t,n)return{isHostMatch:{ruleHost:e.host,urlHost:n.host,matches:c(e.host,n.host)},isPathMatch:{rulePath:e.path,urlPath:n.path,matches:o(e.path,n.path)}}}function l(e,t,n){let r,i;r="string"==typeof e?a(e):e;let l=!1,u=!1;if(r){const e=e=>{const t=function(e,t){let n;if(n="string"==typeof t?a(t):t,n)return c(e.host,n.host)&&o(e.path,n.path)}(e,r);return t&&(i=e),t};l=n.some(e),l||(u=t.some(e))}return{urlParts:r,matchedRule:i,whiteListMatched:l,blackListMatched:u}}function u(e,t,n){const r=l(e,t,n);return!r.urlParts||r.whiteListMatched||!r.blackListMatched}n.d(t,"e",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u}))},386:function(e,t,n){"use strict";var r=n(113);t.a=function(e,t,n){return null==e?e:Object(r.a)(e,t,n)}},387:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0);function a(e){var t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current=e})),t.current}},388:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(64),a=n(0);function c(){var e=Object(a.useState)(Object(r.a)()),t=e[0],n=e[1];return Object(a.useEffect)((function(){if(void 0===t){var e=requestAnimationFrame((function(){n(Object(r.a)())}));return function(){return cancelAnimationFrame(e)}}}),[]),t}},390:function(e,t,n){"use strict";var r=n(125);var a=function(e,t,n,r){for(var a=e.length,c=n+(r?1:-1);r?c--:++c<a;)if(t(e[c],c,e))return c;return-1};var c=function(e){return e!=e};var o=function(e,t,n){for(var r=n-1,a=e.length;++r<a;)if(e[r]===t)return r;return-1};var i=function(e,t,n){return t==t?o(e,t,n):a(e,c,n)};var l=function(e,t){return!!(null==e?0:e.length)&&i(e,t,0)>-1};var u=function(e,t,n){for(var r=-1,a=null==e?0:e.length;++r<a;)if(n(t,e[r]))return!0;return!1},s=n(111),d=n(69),f=n(114);var m=function(e,t,n,a){var c=-1,o=l,i=!0,m=e.length,p=[],h=t.length;if(!m)return p;n&&(t=Object(s.a)(t,Object(d.a)(n))),a?(o=u,i=!1):t.length>=200&&(o=f.a,i=!1,t=new r.a(t));e:for(;++c<m;){var b=e[c],v=null==n?b:n(b);if(b=a||0!==b?b:0,i&&v==v){for(var w=h;w--;)if(t[w]===v)continue e;p.push(b)}else o(t,v,a)||p.push(b)}return p},p=n(127),h=n(61),b=n(128),v=n(124);var w=function(e,t){return Object(v.a)(Object(b.a)(e,t,h.a),e+"")},E=n(56),g=n(38);var O=function(e){return Object(g.a)(e)&&Object(E.a)(e)},j=w((function(e,t){return O(e)?m(e,Object(p.a)(t,1,O,!0)):[]}));t.a=j},46:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return o}));const r=browser.runtime.getURL("/pdf-viewer/web/viewer.html");function a(e){return e.startsWith(r)}function c(e){let t,n,a;e&&("string"==typeof e?t=e:(t=e.file,n=e.blocked,a=e.incognito));let c="",o="";if(t){const e=new URL(t);c+=`&file=${encodeURIComponent(t)}`,o=e.hash}return n&&(c+="&_blocked"),a&&(c+="&_incognito"),r+c.replace("&","?")+o}function o(e){return async function(e){const t=await browser.tabs.create({url:e}),n=await browser.windows.get(t.windowId);n.focused||await browser.windows.update(n.id,{drawAttention:!0})}(c(e))}},57:function(e,t,n){"use strict";async function r(){return(await browser.tabs.query({active:!0,highlighted:!0,windowId:browser.windows.WINDOW_ID_CURRENT}))[0]}n.d(t,"a",(function(){return r}))},64:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){if("undefined"==typeof document)return 0;if(document.body&&(!document.readyState||"loading"!==document.readyState)){if(!0!==e&&"number"==typeof r.__cache)return r.__cache;var t=document.createElement("div"),n=t.style;n.display="block",n.position="absolute",n.width="100px",n.height="100px",n.left="-999px",n.top="-999px",n.overflow="scroll",document.body.insertBefore(t,null);var a=t.clientWidth;if(0!==a)return r.__cache=100-a,document.body.removeChild(t),r.__cache;document.body.removeChild(t)}}},647:function(e,t,n){e.exports=n(663)},648:function(e,t,n){},663:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(24),o=n.n(c),i=n(90),l=n(290),u=n(59),s=n(108),d=n(3),f=n(10),m=n(32),p=n(73),h=n(87),b=n(79),v=n(46);l.a.onlyShowFocusOnTabs();const w=Object(i.a)(d.a,["autoClipboard"]),E=browser.runtime.getURL("/")+"settings.html#/#%E5%BF%AB%E6%8D%B7%E9%94%AE",g=browser.runtime.getURL("/")+"settings.html#/#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F",O=Object(i.a)(d.a,["domainBlackList","domainWhiteList"]),j=window.navigator.userAgent.toLowerCase().includes("edg")?"Microsoft Edge":"Chrome";function y(){var e,t;const[n,c]=Object(r.useState)(),[o,i]=Object(f.a)(O),[l,d]=Object(r.useState)(),[p,h]=Object(r.useState)(!1),b=(e,t)=>{i((n=>{const r=n[t],a=r.findIndex((t=>t.host===e.host&&t.path===e.path));a>=0&&r.splice(a,1)}))},w=(e,t)=>{i((n=>{n[t].push(e)}))};Object(r.useEffect)((()=>{Object(s.a)().then(c)}),[]),Object(r.useEffect)((()=>{d(o&&n?Object(m.b)(n,o.domainBlackList,o.domainWhiteList):void 0)}),[o,n]);const E=Object(r.useMemo)((()=>!!n&&Object(v.b)(n)),[n]),j=null==l?void 0:l.matchedRule,y=(null===(e=null==l?void 0:l.urlParts)||void 0===e?void 0:e.host)||"",x=(null===(t=null==l?void 0:l.urlParts)||void 0===t?void 0:t.path)||"",k=E||l&&l.whiteListMatched||l&&!l.matchedRule?"启用":"禁用",L=null==o?void 0:o.domainBlackList.some((e=>"*"===e.host&&"/*"===e.path));return a.a.createElement("div",{style:{padding:"8px 8px 0 8px"}},a.a.createElement(u.d,{onClick:()=>{h((e=>!e))},fill:!0,text:"禁用"===k&&L&&l?"已在所有网站中禁用网页划词":"此页面已"+k+"网页划词",rightIcon:a.a.createElement(u.w,{icon:p?"chevron-up":"chevron-down",iconSize:12}),minimal:!0,small:!0}),a.a.createElement(u.j,{isOpen:p},!l&&a.a.createElement("span",{className:"bp3-text-muted bp3-text-small"},"在浏览器的内置页面中，只能使用划词后在右键菜单中选择“翻译这段文本”的翻译方式。"),E&&a.a.createElement("span",{className:"bp3-text-muted bp3-text-small"},"在划词翻译内置的 PDF 阅读器中，网页划词功能始终可用。"),l&&!E&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{marginTop:"4px",marginBottom:"10px"}},a.a.createElement("div",null,"当前网站：",y),a.a.createElement("div",null,"当前页面：",x)),l.whiteListMatched&&j&&a.a.createElement("div",null,a.a.createElement("p",{className:"bp3-text-muted bp3-text-small"},"此网址命中了白名单规则 ",a.a.createElement(u.i,null,Object(m.e)(j)),"。"),a.a.createElement("p",null,a.a.createElement(u.d,{fill:!0,small:!0,onClick:()=>b(j,"domainWhiteList")},"删除命中的规则"))),!l.whiteListMatched&&l.blackListMatched&&j&&a.a.createElement("div",null,a.a.createElement("p",{className:"bp3-text-muted bp3-text-small"},L?"你已经在所有网站中禁用了网页划词":a.a.createElement(a.a.Fragment,null,"此网址命中了黑名单规则"," ",a.a.createElement(u.i,null,Object(m.e)(j))),"，但你仍然可以使用",a.a.createElement("a",{href:g,target:"_blank",rel:"noreferrer"},"这几种方式"),"获取翻译结果。"),a.a.createElement("p",{className:"url-actions"},a.a.createElement(u.d,{small:!0,onClick:()=>w({host:y,path:"/*"},"domainWhiteList")},"在当前网站中启用"),a.a.createElement(u.d,{small:!0,onClick:()=>w({host:y,path:x},"domainWhiteList")},"在当前页面中启用")),a.a.createElement("p",null,a.a.createElement(u.d,{fill:!0,small:!0,onClick:()=>b(L?{host:"*",path:"/*"}:j,"domainBlackList")},L?"重新启用网页划词":"删除命中的规则"))),!l.whiteListMatched&&!l.blackListMatched&&a.a.createElement("div",null,a.a.createElement("p",{className:"bp3-text-muted bp3-text-small"},"此网址没有命中任何规则。"),a.a.createElement("p",{className:"url-actions"},a.a.createElement(u.d,{small:!0,onClick:()=>w({host:y,path:"/*"},"domainBlackList")},"在当前网站中禁用"),a.a.createElement(u.d,{small:!0,onClick:()=>w({host:y,path:x},"domainBlackList")},"在当前页面中禁用")))),l&&!L&&!E&&a.a.createElement("p",null,a.a.createElement(u.d,{fill:!0,small:!0,onClick:()=>w({host:"*",path:"/*"},"domainBlackList")},"在所有网站中禁用网页划词"))))}function x(){browser.runtime.sendMessage({action:"open panel"}).catch((e=>{window.alert("打开独立窗口时发生了一个错误："+(null==e?void 0:e.message))}))}function k(){const[e,t]=Object(r.useState)(!1),[n,c]=Object(r.useState)("");return Object(r.useEffect)((()=>{browser.commands.getAll().then((e=>{e.some((e=>{if("panel"===e.name)return c(e.shortcut||""),!0}))}))}),[]),a.a.createElement("div",{style:{padding:"0 8px 8px 8px"}},a.a.createElement(u.d,{onClick:()=>{t((e=>!e))},fill:!0,intent:n?"primary":"warning",text:"试一试独立翻译窗口吧",rightIcon:a.a.createElement(u.w,{icon:n?e?"chevron-up":"chevron-down":"error",iconSize:12}),minimal:!0,small:!0}),a.a.createElement(u.j,{isOpen:e},a.a.createElement("p",{className:"bp3-text-muted"},"您的浏览器支持全局快捷键！您可以在浏览器以外的地方按下快捷键",n&&a.a.createElement(a.a.Fragment,null," ",a.a.createElement("kbd",null,n)," "),"来翻译剪切板内的文本，无需切换回您的浏览器。"),n&&a.a.createElement("div",{className:"bp3-text-muted"},"您可以在",a.a.createElement("a",{href:E,target:"_blank",rel:"noreferrer"},"设置"),"中修改独立翻译窗口的快捷键。"),!n&&a.a.createElement(u.f,{title:"未设置独立窗口快捷键",intent:"warning"},"快捷键已被占用或清除，请前往",a.a.createElement("a",{href:E,target:"_blank",rel:"noreferrer"},"设置"),"中为独立窗口分配一个快捷键，并将作用域由“在 ",j," ","中”改为“全局”。")))}const L=Object(i.a)(d.a,["autoClipboard"]),C=u.T.create();n(288),n(648);o.a.render(a.a.createElement((function(){const e=Object(r.useRef)(null),[t,n]=Object(f.a)(L);return Object(p.a)(),Object(r.useEffect)((()=>{browser.storage.local.get(w).then((({autoClipboard:t})=>{var n,r;null===(n=e.current)||void 0===n||n.translate(t&&Object(b.a)()||""),null===(r=e.current)||void 0===r||r.select()}))}),[]),a.a.createElement("div",null,a.a.createElement(y,null),a.a.createElement(u.m,null),a.a.createElement(h.b,{ref:e,toaster:C,extendOptions:a.a.createElement(u.h,{label:"自动读取剪切板",checked:t?t.autoClipboard:L.autoClipboard,onChange:e=>{n({autoClipboard:e.target.checked})}}),showTextArea:!0}),a.a.createElement(u.m,null),a.a.createElement("div",{className:"openBtn"},a.a.createElement(u.d,{small:!0,onClick:()=>{Object(v.c)()}},"内置 PDF 阅读器"),a.a.createElement(u.d,{small:!0,onClick:x},"独立翻译窗口")),a.a.createElement(u.m,null),a.a.createElement(k,null))}),null),document.getElementById("app"))},79:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));var r=n(105);let a,c=()=>{c=r.a,a=document.createElement("textarea"),a.style.position="absolute",a.style.top="-99999px",document.body.appendChild(a)};function o(e){return c(),a.value=e,a.select(),document.execCommand("copy")}function i(){return c(),a.value="",a.focus(),!!document.execCommand("paste")&&a.value}}});