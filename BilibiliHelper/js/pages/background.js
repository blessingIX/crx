/*! For license information please see background.js.LICENSE.txt */
!function(t){function e(e){for(var n,a,r=e[0],c=e[1],l=e[2],u=0,d=[];u<r.length;u++)a=r[u],s[a]&&d.push(s[a][0]),s[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);for(h&&h(e);d.length;)d.shift()();return o.push.apply(o,l||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,r=1;r<i.length;r++){var c=i[r];0!==s[c]&&(n=!1)}n&&(o.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},s={23:0},o=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="../";var r=window.webpackJsonp=window.webpackJsonp||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var h=c;o.push([303,0,13]),i()}({155:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n=i(66),s=i.n(n),o=i(16),a=i.n(o),r=i(1),c=i.n(r);let l;class h{constructor(t){if(c()(this,"origin",{}),c()(this,"options",{debug:{log:!0,info:!0,warn:!0,error:!0},error:{log:!1,info:!1,warn:!0,error:!0}}),c()(this,"level",l||(l=/^dev/.test("production")?"debug":(/^pro/.test("production"),"error"))),c()(this,"canWrite",t=>this.options[this.level]&&!!this.options[this.level][t]),c()(this,"textWrapper",(...t)=>{if(this.name)return["["+this.name+"]",...t]}),this.name=t,this.debug={},!window.console)return function(){};for(let e in console)"function"==typeof console[e]&&(this.origin[e]=console[e].bind(window.console,t+": "));return this}info(...t){this.canWrite("info")&&this.origin.info(...this.textWrapper(...t))}log(...t){this.canWrite("log")&&this.origin.log(...this.textWrapper(...t))}warn(...t){this.canWrite("warn")&&this.origin.warn(...this.textWrapper(...t))}error(...t){this.canWrite("error")&&this.origin.error(...this.textWrapper(...t))}topic(t,...e){const i=this.origin.group.bind(window.console),n=this.origin.groupEnd.bind(window.console);i("%cTOPIC ~ "+t,"color: #f1e05a;"),e.map(t=>this.__groupItem(t,e.length>5)),n()}group(t,e){this.origin.group("%c"+t,"color: #3ed203;"),a()(s()(e)).map(([t,e])=>{this.origin.log("%c"+t,"color: #fb8f07;",e)}),this.origin.groupEnd()}__groupItem(t,e=!1){const i=this.origin.log.bind(window.console),n=this.origin.group.bind(window.console),o=this.origin.groupCollapsed.bind(window.console),r=this.origin.groupEnd.bind(window.console);if("string"==typeof t||"boolean"==typeof t||"number"==typeof t)i("%c"+t.constructor.name,"color: #fb8f07;",t);else{let r=a()(s()(t));e||r.length>3?o("%c"+t.constructor.name,"color: #e03bfd;"):n("%c"+t.constructor.name,"color: #e03bfd;"),r.map(([t,e])=>{i("%c"+t,"color: #fb8f07;",e)})}r()}}},202:function(t,e,i){"use strict";i.r(e);var n=i(213);i.d(e,"Popup",(function(){return n.f})),i.d(e,"PopupMain",(function(){return n.g})),i.d(e,"PopupMenu",(function(){return n.h})),i.d(e,"PopupSearcher",(function(){return n.i})),i.d(e,"MainHome",(function(){return n.c})),i.d(e,"MainAnime",(function(){return n.a})),i.d(e,"MainFavlist",(function(){return n.b})),i.d(e,"MainLive",(function(){return n.d})),i.d(e,"MainManga",(function(){return n.e}));var s=i(238);i.d(e,"SpecialAttention",(function(){return s.a}));var o=i(210);i.d(e,"SubscriptionDynamic",(function(){return o.d})),i.d(e,"BilibiliLiveBroadcast",(function(){return o.a})),i.d(e,"MESSAGE_TYPE_STRING",(function(){return o.c})),i.d(e,"BilibiliMessage",(function(){return o.b}));var a=i(237);i.d(e,"VideoShortcuts",(function(){return a.a}));var r=i(212);i.d(e,"AutoSignIn",(function(){return r.a})),i.d(e,"Silver2coin",(function(){return r.d})),i.d(e,"ChatFilter",(function(){return r.b})),i.d(e,"LiveReplayDownload",(function(){return r.c}));var c=i(214);i.d(e,"VideoWiden",(function(){return c.h})),i.d(e,"VideoHideDanmu",(function(){return c.f})),i.d(e,"WatchLater",(function(){return c.i})),i.d(e,"VideoDownload",(function(){return c.e})),i.d(e,"VideoDanmu",(function(){return c.d})),i.d(e,"VideoSubtitleDownload",(function(){return c.g})),i.d(e,"VideoAutoQuality",(function(){return c.c})),i.d(e,"VideoAutoPlaySpeed",(function(){return c.b})),i.d(e,"AutoLikeCoinCollect",(function(){return c.a}));var l=i(211);i.d(e,"QuickSearch",(function(){return l.d})),i.d(e,"AutoTakeVipPrivilege",(function(){return l.a})),i.d(e,"Cat",(function(){return l.b})),i.d(e,"Omnibox",(function(){return l.c}));var h=i(209);i.d(e,"CvImageDownload",(function(){return h.a})),i.d(e,"RemoveSelectionLimit",(function(){return h.b}));var u=i(226);for(var d in u)["Popup","PopupMain","PopupMenu","PopupSearcher","MainHome","MainAnime","MainFavlist","MainLive","MainManga","SpecialAttention","SubscriptionDynamic","BilibiliLiveBroadcast","MESSAGE_TYPE_STRING","BilibiliMessage","VideoShortcuts","AutoSignIn","Silver2coin","ChatFilter","LiveReplayDownload","VideoWiden","VideoHideDanmu","WatchLater","VideoDownload","VideoDanmu","VideoSubtitleDownload","VideoAutoQuality","VideoAutoPlaySpeed","AutoLikeCoinCollect","QuickSearch","AutoTakeVipPrivilege","Cat","Omnibox","CvImageDownload","RemoveSelectionLimit","default"].indexOf(d)<0&&function(t){i.d(e,t,(function(){return u[t]}))}(d);var p=i(208);i.d(e,"DarkMode",(function(){return p.a}));var g=i(207);i.d(e,"RenameDownloadFile",(function(){return g.a}))},207:function(t,e,i){"use strict";var n=i(1),s=i.n(n),o=i(46),a=i.n(o),r=i(9),c=i(67),l=i.n(c),h=i(41),u=i.n(h),d=i(7);const p={TITLE:t=>t.title,AID:t=>t.aid,CID:t=>t.cid,BVID:t=>t.bvid,QUALITY:t=>t.quality,UPPER:t=>t.owner.name,UID:t=>t.owner.mid,FORMAT:t=>t.format,DATE:t=>t.pubdate?l()(new Date(Number(t.pubdate+"000"))).format("YYYY-MM-DD"):"",TIME:t=>t.pubdate?l()(new Date(Number(t.pubdate+"000"))).format("HH:mm:ss"):"",NOW_DATE:t=>l()().format("YYYY-MM-DD"),NOW_TIME:t=>l()().format("HH:mm:ss"),ROOM_ID:t=>t.roomId,LANG:t=>t.lang};class g extends r.a{constructor(t,e){super(t,e,"renameDownloadFile",{settings:{on:!0,videoFilename:"__TITLE__.__CID__.__FORMAT__",videoCoverFilename:"videoCover-__TITLE__.__CID__.__FORMAT__",videoScreenshotFilename:"screenshot-__TITLE__.__CID__.__NOW_DATE__ __NOW_TIME__.__FORMAT__",videoDanmuFilename:"__TITLE__.__CID__.__FORMAT__",audioFilename:"__TITLE__.__CID__.__FORMAT__",liveScreenshotFilename:"liveScreenshot-__TITLE__.__NOW_DATE__ __NOW_TIME__.__FORMAT__",subtitleFilename:"__TITLE__.__CID__.__LANG__.__FORMAT__"}}),s()(this,"downloadFilenames",{}),s()(this,"flvRenameCallback",Object(d.webRequestCallbackWrapper)(t=>{const{initiator:e,responseHeaders:i,url:n}=t;if(/^chrome-extension:\/\//.test(e))return;const s=new u.a(n,"",!0),{query:o}=n;if(o&&o.requestFrom)return{responseHeaders:i};const r=this.downloadFilenames[s.pathname];if(r){const t=this.generateFilename("video",r),e=a()(i,t=>"content-disposition"===t.name.toLowerCase()),n=`attachment; filename="${t}"; filename*="utf-8' '${t}"`.replace("/","%2f");e?e.value=n:i.push({name:"Content-Disposition",value:n})}return{responseHeaders:i}})),s()(this,"audioRenameCallback",Object(d.webRequestCallbackWrapper)(t=>{const{initiator:e,responseHeaders:i,url:n}=t;if(/^chrome-extension:\/\//.test(e))return;const s=new u.a(n,"",!0),{query:o}=n;if(o&&o.requestFrom)return{responseHeaders:i};const r=this.downloadFilenames[s.pathname];if(r){const t=this.generateFilename("audio",r),e=a()(i,t=>"content-disposition"===t.name.toLowerCase()),n=`attachment; filename="${t}"; filename*="utf-8' '${t}"`;e?e.value=n:i.push({name:"Content-Disposition",value:n})}return{responseHeaders:i}})),s()(this,"generateFilename",(t,e)=>{let i,n=this.settings[t+"Filename"];const s=/__(.+?)__/;do{if(i=s.exec(n),i&&p[i[1]]){const t=p[i[1]](e);n=n.replace(new RegExp(`__${i[1]}__`),t||"")}}while(i);return n.replace(/\s/g,"_").replace(/[\\/:*?"<>|]/g,"_")}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:r.a.simplifyConfig(this.settings)})})}onAfterSetSetting(t,e){this.emit("*","renameSettingChange",this.settings)}async onBeforeLaunch(){this.addListener("sendVideoFilename",(t,e,i)=>{const n=new u.a(t.url,"",!0);this.downloadFilenames[n.pathname]=t,i()}),this.addListener("renameFileName",(t,e,i)=>{if(this.settings[t.type+"Filename"]){i(this.generateFilename(t.type,t.data))}else i(!1)})}async onLaunch(){this.emit("webRequestController","create",{name:"videoDownloadFlvRenameFilename",eventName:"onHeadersReceived",filter:{urls:["*://*.bilivideo.com/**/*.flv?*"]},options:["responseHeaders","blocking"],callback:this.flvRenameCallback}),this.emit("webRequestController","create",{name:"videoDownloadAudioRenameFilename",eventName:"onHeadersReceived",filter:{urls:["*://*.bilivideo.com/**/*.m4s?*"]},options:["responseHeaders","blocking"],callback:this.audioRenameCallback})}}i.d(e,"a",(function(){return g}))},208:function(t,e,i){"use strict";var n=i(1),s=i.n(n),o=i(9);class a extends o.a{constructor(t,e){super(t,e,"darkMode",{settings:{on:!1,followSystem:!0}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}}i.d(e,"a",(function(){return a}))},209:function(t,e,i){"use strict";var n=i(40),s=i.n(n),o=i(6),a=i.n(o),r=i(1),c=i.n(r),l=i(9);class h extends l.a{constructor(t,e){super(t,e,"cvImageDownload",{settings:{on:!0}}),c()(this,"getMineStr",t=>{switch(t){case"jpg":case"jpeg":case"webp":return"image/jpeg";case"gif":return"image/gif"}}),c()(this,"getData",(t,e)=>new a.a(i=>{const n=this;this.imageMap[t]?i(this.imageMap[t]):this.image.onload=function(){n.canvas.width=this.width,n.canvas.height=this.height,n.canvas.getContext("2d").drawImage(this,0,0),n.imageMap[t]=n.canvas.toDataURL(e),i(n.imageMap[t])}})),c()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:l.a.simplifyConfig(this.settings)})}),this.imageMap={},this.canvas=document.createElement("canvas"),this.image=new Image}async onLaunch(){this.addListener("cvDownloadImage",t=>(console.log(t),this.image.src=t.src,chrome.downloads.download({saveAs:!0,url:t.src,filename:(t.filename||s()())+"."+t.extension}),!0))}}class u extends l.a{constructor(t,e){super(t,e,"removeSelectionLimit",{settings:{on:!0}}),c()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:l.a.simplifyConfig(this.settings)})})}}i.d(e,"a",(function(){return h})),i.d(e,"b",(function(){return u}))},210:function(t,e,i){"use strict";var n=i(28),s=i.n(n),o=i(29),a=i.n(o),r=i(15),c=i.n(r),l=i(14),h=i.n(l),u=i(12),d=i.n(u),p=i(11),g=i.n(p),m=i(6),f=i.n(m),b=i(31),y=i.n(b),w=i(16),v=i.n(w),L=i(1),S=i.n(L),C=i(17),k=i.n(C),_=i(9),O=i(7);function A(t,e){var i=g()(t);if(d.a){var n=d()(t);e&&(n=n.filter((function(e){return h()(t,e).enumerable}))),i.push.apply(i,n)}return i}function x(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?A(Object(i),!0).forEach((function(e){S()(t,e,i[e])})):c.a?a()(t,c()(i)):A(Object(i)).forEach((function(e){s()(t,e,h()(i,e))}))}return t}const D=(t="")=>(t=(t=((t="")=>{const e=new RegExp(/(\[.*?\])/g),i=[];let n=null,s=0;for(;null!==(n=e.exec(t));){const{index:e}=n,o=n[0];i.push(t.substr(s,e-s)),s=e+o.length;const a=window.emojis.get(o);a&&i.push(`<img class="bilibili-emoji" src="${a}"/>`)}return t.substr(s)&&i.push(t.substr(s)),0===i.length&&i.push(t),i.join("")})(t=t.replace(/((https?:\/\/)|(www\.))(?:\S+)/gi,t=>`<a class="bilibili-link" target="_blank" href="${t}">网页链接</a>`))).replace(/#(.+?)#/gi,t=>`<a class="bilibili-topic-link" target="_blank" href="${encodeURI(`https://t.bilibili.com/topic/name/${t.slice(1,-1)}/feed`)}">${t}</a>`)).trim(),I=t=>{const{extend_json:e}=t;return x(x({},k()(t,["extend_json"])),{},{card:(()=>{const e=JSON.parse(t.card),{origin:i,origin_extend_json:n,item:s,intro:o}=e;return o&&(e.parsedIntro=D(o)),i&&(e.origin=JSON.parse(i),e.origin.desc&&(e.origin.parsedDescription=D(e.origin.desc)),e.origin.item&&e.origin.item.description&&(e.origin.parsedDescription=D(e.origin.item.description)),e.origin.item&&e.origin.item.content&&(e.origin.parsedContent=D(e.origin.item.content))),n&&(e.origin_extend_json=JSON.parse(n)),s?(s.description&&(e.parsedDescription=D(s.description)),s.content&&(e.parsedContent=D(s.content))):e.dynamic&&(e.parsedDescription=D(e.dynamic)),e.duration=Object(O.parseTime)(1e3*e.duration),e.publishTime=1e3*e.pubdate,e.publishDateDesc=Object(O.videoPublishDescription)(e.publishTime),e.cover=e.pic,e})(),extend_json:JSON.parse(e)})};class T extends _.a{constructor(t,e){super(t,e,"subscriptionDynamic",{dependencies:["specialAttention"],settings:{on:!1,rangeType:"all",numberType:"theLatestThree",useWhiteList:!1,useBlackList:!1,duration:10,showCover:!1,showBadge:!0},cache:{dataType:"object"}}),S()(this,"hasLogin",!1),S()(this,"bilibiliAccount",null),S()(this,"notificationControllerOn",!1),S()(this,"specialAttentionList",[]),S()(this,"typeList",[8]),S()(this,"offsetDynamicId",0),S()(this,"list",[]),S()(this,"newList",[]),S()(this,"newCardsIdList",[]),S()(this,"needRecreatedClock",!1),S()(this,"onBeforeLaunch",async()=>{this.addListener("accountChanged",({hasLogin:t,bilibiliAccount:e},i,n)=>{this.hasLogin=t,this.bilibiliAccount=e,this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.notificationControllerOn&&this.settings.on&&this.createVideoDynamicClock():this.pause(),n instanceof Function&&n()}),this.addListener("updateSpecialAttentionList",t=>{this.specialAttentionList=t.list||[]}),this.addListener("getDynamic",(t,e,i)=>{this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.getDynamic(this.bilibiliAccount.uid,[8],void 0===t.offsetDynamicId?this.offsetDynamicId:t.offsetDynamicId).then(i):i(!1)}),this.addListener("notificationControllerStateChange",t=>{t.on&&"off"!==this.settings.rangeType&&this.createVideoDynamicClock(),this.notificationControllerOn=t.on}),this.addListener("getBlackList",(t,e,i)=>{i(v()(this.blackList))}),this.addListener("setBlackList",(t,e,i)=>{this.blackList=new y.a(t.blackList),this.setStore("blackList",v()(this.blackList)),i(!0)}),this.addListener("getWhiteList",(t,e,i)=>{i(v()(this.whiteList))}),this.addListener("setWhiteList",(t,e,i)=>{this.whiteList=new y.a(t.whiteList),this.setStore("whiteList",v()(this.whiteList)),i(!0)}),this.addListener("clearNewList",(t,e,i)=>{this.newCardsIdList=[],chrome.browserAction.setBadgeText({text:""}),i(!0)}),await this.emit("bilibiliHelperAccountController","getStatus",null,({hasLogin:t,bilibiliAccount:e})=>{this.hasLogin=t,this.bilibiliAccount=e})}),S()(this,"getLocalAccount",()=>new f.a(t=>{this.emit("bilibiliAccountController","getLocalAccount",null,t)})),S()(this,"createVideoDynamicClock",async()=>{this.emit("clockController","create",{name:"dynamic",alarmInfo:{periodInMinutes:this.hasLogin&&Object(O.isVIP)(this.bhAccount)?this.settings.duration:10},focus:!0,callback:()=>{this.checkNewCallback()}})}),S()(this,"checkNewCallback",()=>{navigator.onLine&&this.getLocalAccount().then(({uid:t})=>this.offsetDynamicId?this.checkNew(t,this.typeList,this.offsetDynamicId,this.offsetDynamicId).then(t=>{if(0===t.code)return t.data.new_num;console.error(t)}).then(e=>{if(!e)return;const i=e;return this.getNew(t,this.typeList).then(t=>{if(0===t.code){if(t.data.cards.length>0&&i>0){this.newCardsIdList=[];const e=t.data.cards.slice(0,i).map(I);this.newCardsIdList.push(...e.map(t=>t.desc.dynamic_id_str)),this.logger.log("type: "+this.typeList,"new count: "+i,this.newCardsIdList),e[0]&&e[0].desc?(this.logger.log("checkNewCallback",Number(e[0].desc.dynamic_id_str)),this.offsetDynamicId=Number(e[0].desc.dynamic_id_str),this.sendNotificationByList(e),this.list=t.data.cards):this.logger.error("card has no desc"),this.settings.showBadge&&chrome.browserAction.setBadgeText({text:String(this.newCardsIdList.length)})}}else console.error(t)})}):this.getNew(t,this.typeList).then(t=>{t&&0===t.code?t.data.cards&&t.data.cards.length>0&&(t.data.cards[0]&&t.data.cards[0].desc?(this.logger.log("getNew",t.data.cards[0].desc.dynamic_id_str),this.offsetDynamicId=t.data.cards[0].desc.dynamic_id_str,this.list=t.data.cards):this.logger.error("card has no desc")):this.logger.error(t)}))}),S()(this,"getDynamic",(t,e,i)=>new f.a(n=>{(i?this.getHistory(t,i,e):this.getNew(t,e)).then(t=>new f.a((e,i)=>{const{code:n,data:s}=t;0===n?e(s):i()})).then(t=>{const{cards:e,has_more:s}=t,o=e.slice(-1),a=void 0===s||!!s;if(o&&o[0]){const t=Number(o[0].desc.dynamic_id_str),i=e.map(I);n({hasMore:a,offsetDynamicId:t,cards:i})}else n({hasMore:!1,cards:[],offsetDynamicId:i})}).catch(t=>{n({hasMore:!1,cards:[],offsetDynamicId:i})})})),S()(this,"checkNew",(t,e,i,n)=>{const s={uid:t,type:e,rsp_type:1,current_dynamic_id:i||n};return new f.a(t=>this.emit("requestController","create",{url:Object(O.generateURLByParams)("https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/dynamic_num",s),options:{contentType:"json"}},t))}),S()(this,"getHistory",(t,e,i)=>{const n={uid:t,offset_dynamic_id:e,type:i};return new f.a(t=>this.emit("requestController","create",{url:Object(O.generateURLByParams)("https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/dynamic_history",n),options:{contentType:"json"}},t)).then(t=>t)}),S()(this,"getNew",(t,e)=>{const i={uid:t,type_list:e};return new f.a(t=>this.emit("requestController","create",{url:Object(O.generateURLByParams)("https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/dynamic_new",i),options:{contentType:"json"}},t)).then(t=>!1===t?(this.emit("notificationController","post",{title:"最新投稿检测失败",tag:"subscriptionDynamic"}),f.a.reject()):t)}),S()(this,"sendNotificationByList",t=>{const{on:e,rangeType:i,numberType:n,useBlackList:s,useWhiteList:o}=this.settings;if(!e||"off"===i||t&&0===t.length)return;let a=[...t];if(this.hasLogin&&Object(O.isVIP)(this.bhAccount)&&(o?a=a.filter(t=>this.whiteList.has(t.card.owner.mid)):("specialAttention"===i&&(a=t.filter(t=>this.specialAttentionList.includes(t.card.owner.mid))),s&&(a=a.filter(t=>!this.blackList.has(t.card.owner.mid))))),this.hasLogin&&"merge"===n&&Object(O.isVIP)(this.bhAccount)){const t=Object(O.__)("subscriptionDynamic_videoNumberType_merge",[a.length]);this.emit("notificationController","post",{title:t,icon:chrome.runtime.getURL("statics/images/bilibili-cat-256.png"),data:{url:"https://t.bilibili.com/?tab=8"},actions:[{action:"watch",title:"立即查看"}],autoCloseInterval:1e4})}else{let t=a;this.hasLogin&&"theLatestThree"===n&&Object(O.isVIP)(this.bhAccount)&&(t=t.slice(-3)),t.forEach(t=>{const{title:e,pic:i,aid:n,owner:s}=t.card;this.emit("notificationController","post",{title:`UP主「${s.name}」投稿了新视频！`,body:e,icon:s.face,image:this.settings.showCover?i:null,data:{url:"https://www.bilibili.com/video/"+Object(O.av2bv)(+n)},actions:[{action:"watch",title:"立即查看"}],autoCloseInterval:1e4})})}}),S()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:_.a.simplifyConfig(this.settings),stores:{blackList:this.getStore("blackList")}})}),this.cache.remove()}async onInitStore(){const t=this.getStore("blackList");void 0===t?(this.blackList=new y.a([]),this.setStore("blackList",v()(this.blackList))):this.blackList=new y.a(t);const e=this.getStore("whiteList");void 0===e?(this.whiteList=new y.a([]),this.setStore("whiteList",v()(this.whiteList))):this.whiteList=new y.a(e)}async onAfterSetSetting(t,e){this.emit("clockController","query",{name:"dynamic"},t=>{!e.on&&t?this.pause():t||this.createVideoDynamicClock()})}async onLaunch(){this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&this.settings.on&&f.a.all([this.emit("notificationController","getSetting",null,({on:t})=>t),this.emit("specialAttention","getSpecialAttentionList",{},t=>t||[])]).then(([t,e])=>{this.notificationControllerOn=t,this.specialAttentionList=e}).then(()=>{this.notificationControllerOn&&"off"!==this.settings.rangeType&&this.createVideoDynamicClock()})}async onPause(){this.emit("clockController","clear",{name:"dynamic"},null)}}var P=i(40),N=i.n(P);class E extends _.a{constructor(t,e){super(t,e,"bilibiliLiveBroadcast",{dependencies:["specialAttention"],settings:{on:!1,rangeType:"all",useBlackList:!1,useWhiteList:!1,duration:10,showCover:!1},cache:{type:"local",dataType:"object"}}),S()(this,"hasLogin",!1),S()(this,"bilibiliAccount",null),S()(this,"notificationControllerOn",!1),S()(this,"specialAttentionList",[]),S()(this,"currentList",[]),S()(this,"lastList",[]),S()(this,"needRecreatedClock",!1),S()(this,"onBeforeLaunch",async()=>{this.addListener("accountChanged",({hasLogin:t,bilibiliAccount:e},i,n)=>{this.hasLogin=t,this.bilibiliAccount=e,this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&t?this.notificationControllerOn&&this.settings.on&&this.createLiveClock():this.pause(),n instanceof Function&&n()}),this.addListener("updateSpecialAttentionList",t=>{this.specialAttentionList=t.list||[]}),this.addListener("getLiveFeedList",(t,e,i)=>{const{pn:n,ps:s}=t;this.getLiveFeedBroadcastingList(n,s).then(t=>i(t))}),this.addListener("getFullSimpleLiveList",(t,e,i)=>{this.getSimpleLiveFeedBroadcastingList([],1,29,!0).then(t=>{i(t)})}),this.addListener("notificationControllerStateChange",t=>{t.on&&"off"!==this.settings.rangeType&&this.createLiveClock(),this.notificationControllerOn=t.on}),this.addListener("getBlackList",(t,e,i)=>{i(v()(this.blackList))}),this.addListener("setBlackList",(t,e,i)=>{this.blackList=new y.a(t.blackList),this.setStore("blackList",v()(this.blackList)),i(!0)}),this.addListener("getWhiteList",(t,e,i)=>{i(v()(this.whiteList))}),this.addListener("setWhiteList",(t,e,i)=>{this.whiteList=new y.a(t.whiteList),this.setStore("whiteList",v()(this.whiteList)),i(!0)}),await this.emit("bilibiliHelperAccountController","getStatus",null,({hasLogin:t,bilibiliAccount:e})=>{this.hasLogin=t,this.bilibiliAccount=e})}),S()(this,"createLiveClock",()=>{this.emit("clockController","create",{name:"live",alarmInfo:{periodInMinutes:this.hasLogin&&Object(O.isVIP)(this.bhAccount)?this.settings.duration:10},focus:!0,callback:()=>{this.checkNew()}})}),S()(this,"getLocalUserId",()=>new f.a(t=>{this.emit("cookieController","message",{command:"getLocalUserId"},t)})),S()(this,"checkNew",async()=>{if(navigator.onLine&&this.hasLogin)return await this.getSimpleLiveFeedBroadcastingList([],1,29,!0).then(t=>{let e=!1;this.currentList&&0!==this.currentList.length||(e=!0);const{current:i,list:n,count:s}=this.getDifferent(this.currentList,t);return this.currentList=i,s>0&&!e?n:[]}).then(t=>{0!==t.length&&this.sendNotificationByList(t)})}),S()(this,"getDifferent",(t,e)=>{const i=[];let n=0;return e.forEach(({owner:s},o)=>{let a=!1;t.forEach(({owner:t})=>{s.mid===t.mid&&(a=!0)}),a||(i.push(e[o]),n+=1)}),{current:e,list:i,count:n}}),S()(this,"getSimpleLiveFollowList",(t=1,e=29,i=!1)=>new f.a(i=>{setTimeout(()=>{this.emit("requestController","create",{url:`https://api.live.bilibili.com/xlive/web-ucenter/user/following?page=${t}&page_size=${e}&_=`+N()(),options:{contentType:"json"}},i)},500)}).then(t=>{if(!1===t)return this.emit("notificationController","post",{title:"开播检测失败",tag:"bilibiliLiveBroadcast"}),f.a.reject();if(0===t.code){let e=!1,n=t.data.list.map(({face:t,title:i,uname:n,uid:s,roomid:o,live_status:a})=>(a||(e=!0),{title:i,owner:{name:n,mid:s,face:t},roomId:o,living:!!a}));return i&&(n=n.filter(({living:t})=>t)),{rooms:n,count:t.data.count,toEnd:i?e:i}}return f.a.reject()})),S()(this,"getSimpleLiveFeedBroadcastingList",async(t=[],e=1,i=29,n=!1)=>await this.getSimpleLiveFollowList(e,i,n).then(({rooms:s,count:o,toEnd:a})=>a?(s=s.filter(t=>!!t.living),t.push(...s),t):(t.push(...s),t.length<=o&&e<4?this.getSimpleLiveFeedBroadcastingList(t,e+1,i,n):t))),S()(this,"getLiveFeedBroadcastingList",(t=1,e=10)=>new f.a(i=>this.emit("requestController","create",{url:`https://api.live.bilibili.com/xlive/web-ucenter/v1/xfetter/GetWebList?page=${t}&page_size=${e}0&_=1616494848160`+N()(),options:{contentType:"json"}},i)).then(t=>{if(0===t.code)return{rooms:t.data.rooms.map(({keyframe:t,cover_from_user:e,title:i,nickname:n,uid:s,face:o,roomid:a,link:r})=>({cover:e||t,title:i,owner:{name:n,mid:s,face:o},roomId:a,link:r})),count:t.data.count}})),S()(this,"sendNotificationByList",t=>{const{on:e,rangeType:i,useBlackList:n,useWhiteList:s}=this.settings;if(!e||"off"===i||!this.hasLogin)return;let o=[...t];Object(O.isVIP)(this.bhAccount)&&(s?o=o.filter(t=>this.whiteList.has(t.owner.mid)):("specialAttention"===i&&(o=t.filter(t=>this.specialAttentionList.includes(t.owner.mid))),n&&(o=o.filter(t=>!this.blackList.has(t.owner.mid))))),o.forEach(t=>{const{title:e,roomId:i,owner:n}=t;this.getRoomInfo(n.mid).then(t=>{this.emit("notificationController","post",{title:`主播「${n.name}」开播啦! `,icon:n.face,image:this.settings.showCover?t:null,body:e,data:{url:"https://live.bilibili.com/"+i},actions:[{action:"watch",title:"立即查看"}],autoCloseInterval:1e4})})})}),S()(this,"getRoomInfo",t=>new f.a(e=>{this.emit("requestController","create",{url:"https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByRoom?room_id="+t,options:{contentType:"json"}},t=>{t&&0===t.code&&t.data.room_info?e(t.data.room_info.cover||t.data.room_info.keyframe||null):e(null)})})),S()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:_.a.simplifyConfig(this.settings),stores:{whiteList:this.getStore("whiteList"),blackList:this.getStore("blackList")}})})}async onInitStore(){const t=this.getStoreByCompleteName("subscriptionLiveBroadcast-config");t&&(await this.setSetting(t),this.deleteStoreByCompleteName("subscriptionLiveBroadcast-config"));let e=this.getStore("blackList");const i=this.getStoreByCompleteName("subscriptionLiveBroadcast-data_blackList");i&&(this.deleteStoreByCompleteName("subscriptionLiveBroadcast-data_blackList"),e=v()(new y.a([...i,...e||[]]))),void 0===e?(this.blackList=new y.a([]),this.setStore("blackList",v()(this.blackList))):this.blackList=new y.a(e);let n=this.getStore("whiteList");const s=this.getStoreByCompleteName("subscriptionLiveBroadcast-data_whiteList");s&&(this.deleteStoreByCompleteName("subscriptionLiveBroadcast-data_whiteList"),n=v()(new y.a([...s,...n||[]]))),void 0===n?(this.whiteList=new y.a([]),this.setStore("whiteList",v()(this.whiteList))):this.whiteList=new y.a(n)}async onAfterSetSetting(t,e){this.emit("clockController","query",{name:"live"},t=>{!e.on&&t?this.pause():t||this.createLiveClock()})}async onLaunch(){this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&this.hasLogin&&this.settings.on&&f.a.all([this.emit("notificationController","getSetting",null,({on:t})=>t),this.emit("specialAttention","getSpecialAttentionList",{},t=>t||[])]).then(([t,e])=>{this.notificationControllerOn=t,this.specialAttentionList=e}).then(()=>{const t=this.cache.get(),{currentList:e=[],lastList:i=[]}=t;this.currentList=e,this.lastList=i,this.notificationControllerOn&&"off"!==this.settings.rangeType&&this.createLiveClock()})}async onPause(){this.emit("clockController","clear",{name:"live"},null)}}function M(t,e){var i=g()(t);if(d.a){var n=d()(t);e&&(n=n.filter((function(e){return h()(t,e).enumerable}))),i.push.apply(i,n)}return i}function F(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?M(Object(i),!0).forEach((function(e){S()(t,e,i[e])})):c.a?a()(t,c()(i)):M(Object(i)).forEach((function(e){s()(t,e,h()(i,e))}))}return t}const j={at:0,like:0,reply:0,sys_msg:0,follow_unread:0,unfollow_unread:0},R={at:"@我的",like:"点赞",reply:"回复",sys_msg:"系统消息",unread:"私信"},B={at:"at",like:"love",reply:"reply",sys_msg:"system",unread:"whisper"};class q extends _.a{constructor(t,e){super(t,e,"bilibiliMessage",{settings:{on:!1,rangeType:{at:!0,like:!0,reply:!0,sys_msg:!0,unread:!0},useBlackList:!1,duration:5},cache:{type:"local",dataType:"object"}}),S()(this,"hasLogin",!1),S()(this,"bilibiliAccount",null),S()(this,"bhAccount",null),S()(this,"notificationControllerOn",!1),S()(this,"latestList",[]),S()(this,"newList",F({},j)),S()(this,"needRecreatedClock",!1),S()(this,"onBeforeLaunch",async()=>{this.addListener("accountChanged",({bhAccount:t,hasLogin:e,bilibiliAccount:i},n,s)=>{this.hasLogin=e,this.bhAccount=t,this.bilibiliAccount=i,this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&e?this.notificationControllerOn&&this.settings.on&&this.createBilibiliMessageClock():this.pause(),s instanceof Function&&s()}),this.addListener("notificationControllerStateChange",t=>{t.on?this.settings.on&&this.createBilibiliMessageClock():this.pause(),this.notificationControllerOn=t.on}),this.addListener("getUnreadInfo",(t,e,i)=>{this.update().then(t=>i(t))}),await this.emit("bilibiliHelperAccountController","getStatus",null,({hasLogin:t,bilibiliAccount:e})=>{this.hasLogin=t,this.bilibiliAccount=e})}),S()(this,"createBilibiliMessageClock",()=>{Object(O.isVIP)(this.bhAccount)&&(this.emit("clockController","create",{name:"bilibiliMessage",alarmInfo:{periodInMinutes:this.hasLogin&&Object(O.isVIP)(this.bhAccount)?this.settings.duration:5},focus:!0,callback:()=>{this.update().then(this.sendNotification)}}),this.update())}),S()(this,"update",()=>this.getLatestData().then(t=>{const e=F({},j);let i=["at","like","reply","sys_msg","follow_unread","unfollow_unread"].reduce((i,n)=>(void 0!==t[n]&&void 0!==this.latestList[n]&&t[n]!==this.latestList[n]&&(t[n]<this.latestList[n]?e[n]=0:(e[n]=t[n]-this.latestList[n],i+=1)),i),0);return this.newList=i?e:F({},j),this.latestList=t,{newList:this.newList,hasNew:i,latestList:this.latestList}})),S()(this,"getLatestData",()=>f.a.all([this.getUnreadInfo(),this.getSingleUnread()]).then(([t,e])=>F(F({},t),e))),S()(this,"getUnreadInfo",()=>this.bilibiliAccount&&this.bilibiliAccount.hasLogin?new f.a(t=>{this.emit("requestController","create",{url:"https://api.bilibili.com/x/msgfeed/unread?build=0&mobi_app=web",options:{contentType:"json"}},e=>{e&&0===e.code&&e.data?t(e.data||null):t(null)})}):f.a.resolve(null)),S()(this,"getSingleUnread",(t=!0)=>this.bilibiliAccount&&this.bilibiliAccount.hasLogin?new f.a(e=>{this.emit("requestController","create",{url:`https://api.vc.bilibili.com/session_svr/v1/session_svr/single_unread?unread_type=${t?0:1}&build=0&mobi_app=web`,options:{contentType:"json"}},t=>{t&&0===t.code&&t.data?e(t.data||null):e(null)})}):f.a.resolve(null)),S()(this,"sendNotification",({newList:t,hasNew:e})=>{const{on:i,rangeType:n}=this.settings;if(!i||!e)return;const{follow_unread:s,unfollow_unread:o}=t,a=k()(t,["follow_unread","unfollow_unread"]);a.unread=s+o;const r=g()(a).map(t=>!(!a[t]||!n[t])&&t).filter(Boolean),c=r.map(t=>!!a[t]&&R[t]+":"+a[t]).filter(Boolean).join(", ");if(r.length>0){const t=B[r[0]];this.emit("notificationController","post",{title:"您有新的消息，请其注意查收",icon:chrome.runtime.getURL("statics/images/bilibili-cat-256.png"),body:c,data:{url:"https://message.bilibili.com/#/"+t||"https://message.bilibili.com/#/reply"},actions:[{action:"watch",title:"立即查看"}],autoCloseInterval:1e4})}}),S()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:_.a.simplifyConfig(this.settings)})})}async onInitStore(){const t=this.getStore("blackList");void 0===t?(this.blackList=new y.a([]),this.setStore("blackList",v()(this.blackList))):this.blackList=new y.a(t)}async onAfterSetSetting(t,e){this.emit("clockController","query",{name:"bilibiliMessage"},t=>{!e.on&&t?this.pause():t||this.createBilibiliMessageClock()})}async onLaunch(){this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&this.settings.on&&this.emit("notificationController","getSetting",null,({on:t})=>{this.notificationControllerOn=t,this.notificationControllerOn&&this.settings.on&&this.createBilibiliMessageClock()})}async onPause(){this.emit("clockController","clear",{name:"bilibiliMessage"},null)}}i.d(e,"d",(function(){return T})),i.d(e,"a",(function(){return E})),i.d(e,"c",(function(){return R})),i.d(e,"b",(function(){return q}))},211:function(t,e,i){"use strict";var n=i(1),s=i.n(n),o=i(9),a=i(7);class r extends o.a{constructor(t,e){super(t,e,"quickSearch",{dependencies:["tabController"],settings:{on:!0}}),s()(this,"onLaunch",async()=>{if(this.settings.on)try{chrome.contextMenus.create({id:"bilibili-searchBili",title:Object(a.__)("quickSearch_menuTitle"),contexts:["selection"],onclick:t=>{chrome.runtime.sendMessage({command:"setGAEvent",action:"click",category:"quickSearch",label:"quickSearch"}),/^(av\d+|bv.+)/i.test(t.selectionText)?this.emit("tabController","create",{url:"https://www.bilibili.com/video/"+t.selectionText,strict:!1}):this.emit("tabController","create",{url:"https://search.bilibili.com/all?keyword="+encodeURIComponent(t.selectionText)})}})}catch(t){}}),s()(this,"onPause",()=>{chrome.contextMenus.remove("bilibili-searchBili",null)}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}async onAfterSetSetting(t,e){e.on?this.launch():this.pause()}}var c=i(6),l=i.n(c),h=i(46),u=i.n(h),d=(i(41),"https://api.bilibili.com/x/vip/privilege/my"),p="https://api.bilibili.com/x/vip/privilege/receive";class g extends o.a{constructor(t,e){super(t,e,"autoTakeVipPrivilege",{settings:{on:!1,pushNotification:!0},cache:{type:"local",dataType:"number"}}),s()(this,"hasLogin",!1),s()(this,"bilibiliAccount",null),s()(this,"notificationControllerOn",!1),s()(this,"onBeforeLaunch",async()=>{this.addListener("accountChanged",({hasLogin:t,bilibiliAccount:e},i,n)=>{this.hasLogin=t,this.bilibiliAccount=e,this.hasLogin&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.notificationControllerOn&&this.settings.on&&this.hasLogin&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&this.createClock():this.pause(),n instanceof Function&&n()}),await this.emit("bilibiliHelperAccountController","getStatus",null,({hasLogin:t,bilibiliAccount:e})=>{this.hasLogin=t,this.bilibiliAccount=e}),await this.emit("notificationController","getSetting",null,({on:t})=>{this.notificationControllerOn=t}),this.emit("webRequestController","create",{name:"autoTakeVipPrivilegeModifyHeader",eventName:"onBeforeSendHeaders",filter:{urls:["*://api.bilibili.com/x/vip/privilege/receive*"]},options:["blocking","requestHeaders","extraHeaders"],callback:this.modifyHeaders})}),s()(this,"onLaunch",async()=>{this.notificationControllerOn&&this.settings.on&&this.hasLogin&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&(this.createClock(),this.request())}),s()(this,"onPause",async()=>{this.clearClock()}),s()(this,"createClock",()=>{this.emit("clockController","create",{name:"autoTakeVipPrivilege",alarmInfo:{periodInMinutes:1},focus:!0,callback:this.request})}),s()(this,"clearClock",()=>{this.emit("clockController","pause",{name:"autoTakeVipPrivilege"})}),s()(this,"modifyHeaders",Object(a.webRequestCallbackWrapper)(t=>{const{requestHeaders:e,url:i}=t,{query:n}=i;if(n&&n.requestFrom)return;const s=u()(e,t=>"origin"===t.name.toLowerCase());return s?s.value="https://www.bilibili.com/":e.push({name:"Origin",value:"https://www.bilibili.com/"}),{requestHeaders:e}})),s()(this,"checkout",()=>new l.a((t,e)=>{this.cache.set((new Date).getMonth()),Object(a.fetchFromHelper)(d,{credentials:"include",mode:"cors"}).then(t=>t.json()).then(i=>{0===i.code&&i.data&&i.data.list?t(i.data.list.map(t=>1!==t.state?t.type:-1).reduce((t,e)=>(-1!==e&&t.push(e),t),[])):e("获取会员福利状态数据失败")})})),s()(this,"request",()=>{if(navigator.onLine){if(chrome.extension.inIncognitoContext)return l.a.reject(this.name+": 请退出隐私模式");if(this.settings.on)return!(this.thisMonthPassed||!this.hasLogin||!this.bilibiliAccount||!this.bilibiliAccount.hasLogin)&&this.emit("cookieController","get",{url:"http://www.bilibili.com",name:"bili_jct"},t=>this.checkout().then(e=>this.get(e,t)))}}),s()(this,"get",async(t,e)=>l.a.all(t.map(t=>this.emit("requestController","create",{url:p+"?passWrapper=true",options:{method:"post",body:`type=${t}&csrf=${e}`,credentials:"include",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded"},contentType:"json"}},t=>0===t.code))).then(e=>{e.filter(Boolean).length===t.length&&(this.cache.set((new Date).getMonth()),this.settings.pushNotification&&this.emit("notificationController","post",{title:"已经自动大会员福利成功",tag:"autoTakeVipPrivilege"}))})),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}get thisMonthPassed(){return this.cache.get()===(new Date).getMonth()}async onAfterSetSetting(t,e){this.notificationControllerOn&&e.on&&!this.__launched&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.launch():e.on&&this.hasLogin&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin||!this.__launched||this.pause()}}class m extends o.a{constructor(t,e){super(t,e,"cat",{settings:{on:!0,catType:"default",showWhenFullWiden:!1,showInInjectPlayer:!1}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}}class f extends o.a{constructor(t,e){super(t,e,"omnibox",{settings:{on:!0}}),s()(this,"onInputEnteredCallback",(t,e)=>{this.emit("tabController","create",{url:"https://search.bilibili.com/all?keyword="+t})}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}async onLaunch(){chrome.omnibox.setDefaultSuggestion({description:"使用 哔哩哔哩助手 搜索"}),chrome.omnibox.onInputEntered.addListener(this.onInputEnteredCallback)}async onPause(){chrome.omnibox.onInputEntered.removeListener(this.onInputEnteredCallback)}}i.d(e,"d",(function(){return r})),i.d(e,"a",(function(){return g})),i.d(e,"b",(function(){return m})),i.d(e,"c",(function(){return f}))},212:function(t,e,i){"use strict";var n=i(1),s=i.n(n),o=i(9),a="https://api.live.bilibili.com/sign/doSign";class r extends o.a{constructor(t,e){super(t,e,"autoSignIn",{settings:{on:!1,pushNotification:!0},cache:{type:"local",dataType:"number"}}),s()(this,"online",!1),s()(this,"bilibiliAccount",null),s()(this,"notificationControllerOn",!1),s()(this,"onBeforeLaunch",async()=>{this.addListener("networkOnlineChange",t=>this.online=t),this.addListener("accountChanged",({bilibiliAccount:t},e,i)=>{this.bilibiliAccount=t,this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.notificationControllerOn&&this.settings.on&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&(this.createClock(),this.request()):this.pause(),i instanceof Function&&i()}),await this.emit("bilibiliHelperAccountController","getStatus",null,({bilibiliAccount:t})=>{this.bilibiliAccount=t}),await this.emit("notificationController","getSetting",null,({on:t})=>{this.notificationControllerOn=t}),this.emit("networkController","getOnline",null,t=>this.online=t)}),s()(this,"onLaunch",async()=>{this.notificationControllerOn&&this.settings.on&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&(this.createClock(),this.request())}),s()(this,"onPause",async()=>{this.clearClock()}),s()(this,"createClock",()=>{this.emit("clockController","create",{name:"autoSignIn",alarmInfo:{periodInMinutes:5},focus:!0,callback:this.request})}),s()(this,"clearClock",()=>{this.emit("clockController","pause",{name:"autoSignIn"})}),s()(this,"request",async()=>{if(this.online&&!chrome.extension.inIncognitoContext&&this.settings.on)return!this.todayPassed&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.emit("requestController","create",{url:""+a,options:{contentType:"json"}},async t=>{!1===t?this.settings.pushNotification&&this.emit("notificationController","post",{title:"自动签到失败",tag:"autoSignIn"}):0===t.code?(this.cache.set((new Date).getDate()),this.settings.pushNotification&&this.emit("notificationController","post",{title:"自动签到成功",tag:"autoSignIn"})):1011040===t.code?this.cache.set((new Date).getDate()):this.settings.pushNotification&&this.emit("notificationController","post",{title:"自动签到失败",tag:"autoSignIn"})}):void 0}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}get todayPassed(){return this.cache.get()===(new Date).getDate()}async onAfterSetSetting(t,e){e.on&&!this.__launched&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.launch():e.on&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin||!this.__launched||this.pause()}}var c="https://api.live.bilibili.com/pay/v1/Exchange/silver2coin";class l extends o.a{constructor(t,e){super(t,e,"silver2coin",{settings:{on:!1,pushNotification:!0},cache:{type:"local",dataType:"number"}}),s()(this,"online",!1),s()(this,"bilibiliAccount",null),s()(this,"notificationControllerOn",!1),s()(this,"onBeforeLaunch",async()=>{this.addListener("networkOnlineChange",t=>this.online=t),this.addListener("accountChanged",({bilibiliAccount:t},e,i)=>{this.bilibiliAccount=t,this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.notificationControllerOn&&this.settings.on&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&this.createClock():this.pause(),i instanceof Function&&i()}),await this.emit("bilibiliHelperAccountController","getStatus",null,({bilibiliAccount:t})=>{this.bilibiliAccount=t}),await this.emit("notificationController","getSetting",null,({on:t})=>{this.notificationControllerOn=t}),this.emit("networkController","getOnline",null,t=>this.online=t)}),s()(this,"onPause",async()=>{this.clearClock()}),s()(this,"createClock",()=>{this.emit("clockController","create",{name:"silver2coin",alarmInfo:{periodInMinutes:5},focus:!0,callback:this.request})}),s()(this,"clearClock",()=>{this.emit("clockController","pause",{name:"silver2coin"})}),s()(this,"getJCT",async()=>await this.emit("cookieController","get",{url:"http://www.bilibili.com",name:"bili_jct"},t=>t)),s()(this,"request",async()=>{if(this.online&&!chrome.extension.inIncognitoContext&&this.settings.on&&!this.todayPassed&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin){const t=await this.getJCT();if(!t)return!1;this.emit("requestController","create",{url:c,platform:"pc",csrf_token:t,requestFrom:"bilibili-helper",options:{contentType:"json"}},async t=>{!1===t&&this.settings.pushNotification&&this.emit("notificationController","post",{title:"银瓜子自动兑换失败",tag:"silver2coin"}),0===t.code?(this.cache.set((new Date).getDate()),this.settings.pushNotification&&this.emit("notificationController","post",{title:"银瓜子自动兑换成功",tag:"silver2coin"})):403===t.code&&this.cache.set((new Date).getDate())})}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}get todayPassed(){return this.cache.get()===(new Date).getDate()}async onAfterSetSetting(t,e){this.notificationControllerOn&&e.on&&!this.__launched&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin?this.launch():e.on&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin||!this.__launched||this.pause()}async onLaunch(){this.notificationControllerOn&&this.settings.on&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin&&(this.createClock(),this.request())}}class h extends o.a{constructor(t,e){super(t,e,"chatFilter",{settings:{on:!0,options:{chat:!1,small:!0,gift:!0,enterMsg:!0,medal:!0,achievement:!0,level:!0,n2233:!0,pk:!1,announcement:!1}}}),s()(this,"filterMap",{}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings),stores:{filterMap:this.getStore("filterMap")}})})}async onInitStore(){const t=this.getStore("filterMap");void 0===t?(this.filterMap={},this.setStore("filterMap",this.filterMap)):this.filterMap=t}async onLaunch(){this.addListener("getFilterMap",(t,e,i)=>{i(this.filterMap)}),this.addListener("setFilterMap",(t,e,i)=>{this.filterMap=t.filterMap,this.setStore("filterMap",this.filterMap),i(!0)})}}var u=i(30),d=i.n(u),p=i(46),g=i.n(p),m=i(41),f=i.n(m),b="https://api.live.bilibili.com/xlive/web-room/v1/record/getLiveRecordUrl";class y extends o.a{constructor(t,e){super(t,e,"liveReplayDownload",{settings:{on:!0}}),s()(this,"renameListener",t=>{const{responseHeaders:e,initiator:i,url:n}=t;if(/^chrome-extension:\/\//.test(i))return;const s=new f.a(n,"",!0),{query:o}=n;if(o&&o.requestFrom)return;let a=this.downloadFilenames[s.pathname];if(a){a=a.replace(/[|"*?:<>]/g,"_");const t=g()(e,t=>"Content-Disposition"===t.name),i=`attachment; filename="${encodeURIComponent(a)}.flv"; filename*=utf-8' '${encodeURIComponent(a)}.flv`.replace("/","%2f");t?t.value=i:e.push({name:"Content-Disposition",value:i})}return{responseHeaders:e}}),s()(this,"getLiveRecord",(t,e,i)=>(t.rid&&(this.cache.has(t.rid)?i(this.cache.get(t.rid)):this.emit("requestController","create",{url:`${b}?rid=${t.rid}&platform=html5&requestFrom=BILIBILI_HELPER_2.1.4`,options:{contentType:"json"}}).then(e=>{0===e.code?(this.cache.set(t.rid,e.data),e.data.list.forEach((i,n)=>{const s=new f.a(i.url,"",!0);e.data.list.length>1?this.downloadFilenames[s.pathname]=`${t.title}_${n+1}`:this.downloadFilenames[s.pathname]=t.title}),i(e.data)):i(!1)})),!0)),this.cache=new d.a,this.downloadFilenames={}}async onLaunch(){this.emit("webRequestController","create",{name:"liveReplayDownloadRename",eventName:"onHeadersReceived",filter:{urls:["*://*.bilivideo.com/vlivexcode/*"]},options:["responseHeaders","blocking"],callback:this.renameListener}),this.addListener("getLiveRecord",this.getLiveRecord)}}i.d(e,"a",(function(){return r})),i.d(e,"d",(function(){return l})),i.d(e,"b",(function(){return h})),i.d(e,"c",(function(){return y}))},213:function(t,e,i){"use strict";var n=i(1),s=i.n(n),o=i(9),a=i(6),r=i.n(a),c=i(34),l=i.n(c),h=i(88);class u extends o.a{constructor(t,e){super(t,e,"mainHome",{dependencies:["bilibiliAccountController","ad"],settings:{on:!0,showCarousel:!0,contentType:"recentVideo",showLiveBar:!0,openMethod:"direct"},cache:{type:"local",dataType:"object",delayDuration:2e3,limit:{duration:18e4}}}),s()(this,"getHomePageData",async(t=!1)=>{const e=await this.emit("ad","getAds",null,t=>t&&t.popupHomeCarousel||[]);let i=this.cache.checkExpired().expired;const n=this.cache.get(t);return i||!n||l()(n)?new r.a(t=>{this.emit("requestController","create",{url:"https://www.bilibili.com/",options:{contentType:"text"}},t)}).then(t=>{const i={carousel:[],recommendList:[]},n=(new DOMParser).parseFromString(t,"text/html").querySelector("#reportFirst1 .ggc .item:first-child a");if(n){const e=n.getAttribute("data-loc-id"),s=/<script>window.__INITIAL_STATE__=(.+?});\S/.exec(t);e&&s&&(i.carousel=JSON.parse(s[1]).locsData[e].map((t,e)=>({id:t.id,src:t.pic,alt:t.name,isAD:t.is_ad,tags:[],active:!1,url:t.url})))}const s=/<script>window.__INITIAL_STATE__=(.+?});\S/.exec(t);s&&(i.recommendList=JSON.parse(s[1]).recommendData.item.map(t=>({aid:t.aid,cid:t.cid,bvid:t.bvid,cover:t.pic,duration:Object(h.a)(1e3*t.duration),publishDateDesc:t.pubdate?Object(h.b)(1e3*t.pubdate):"",title:t.title,stat:t.stat,owner:t.owner,description:t.desc,tag:t.tname,tid:t.tid,publishTime:t.pubdate?1e3*t.pubdate:0}))),i.carousel.sort(()=>Math.random()<.5?1:-1),i.recommendList.sort(()=>Math.random()<.5?1:-1),this.cache.set(i);const o=[...i.carousel];return o.unshift(...e),{expired:!0,data:{carousel:o,recommendList:i.recommendList}}}):(n.carousel.sort(()=>Math.random()<.5?1:-1),n.recommendList.sort(()=>Math.random()<.5?1:-1),n.carousel.unshift(...e),r.a.resolve({expired:i,data:n}))}),s()(this,"getHotVideos",(t=1,e=20)=>new r.a(i=>{this.emit("requestController","create",{url:`https://api.bilibili.com/x/web-interface/popular?ps=${e}&pn=${t}`,options:{contentType:"json"}},i)}).then(t=>{if(t&&0===t.code){const{list:e,no_more:i}=t.data;return{list:e.map(t=>({aid:t.aid,cid:t.cid,bvid:t.bvid,cover:t.pic,duration:Object(h.a)(1e3*t.duration),publishDateDesc:t.pubdate?Object(h.b)(1e3*t.pubdate):"",title:t.title,stat:t.stat,owner:t.owner,description:t.desc,tag:t.tname,tid:t.tid,publishTime:t.pubdate?1e3*t.pubdate:0})),hasMore:!i}}return!1})),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}async onLaunch(){this.addListener("getHomeData",(t,e,i)=>{this.getHomePageData(t.getCache).then(t=>i(t))}),this.addListener("getHotVideos",(t,e,i)=>{this.getHotVideos(t.pn,t.ps).then(t=>i(t))})}}var d=i(46),p=i.n(d),g=i(7);class m extends o.a{constructor(t,e){super(t,e,"mainAnime",{dependencies:["bilibiliAccountController"],settings:{on:!0,toggle:!1}}),s()(this,"getAnimaTimeline",()=>new r.a(t=>{this.emit("requestController","create",{url:"https://bangumi.bilibili.com/web_api/timeline_global",options:{contentType:"json"}},t)}).then(t=>(0===t.code&&t.result.forEach((e,i)=>{1===e.is_today&&(t.result[i-1].is_yesterday=1),e.seasons=e.seasons.sort((t,e)=>t.follow>e.follow?-1:1)}),t.result))),s()(this,"getAnimaTimelineCN",()=>new r.a(t=>{this.emit("requestController","create",{url:"https://bangumi.bilibili.com/web_api/timeline_cn",options:{contentType:"json"}},t)}).then(t=>(0===t.code&&t.result.forEach((e,i)=>{1===e.is_today&&(t.result[i-1].is_yesterday=1),e.seasons=e.seasons.sort((t,e)=>t.follow>e.follow?-1:1)}),t.result))),s()(this,"onBeforeSendHeadersCallback",Object(g.webRequestCallbackWrapper)(t=>{const{requestHeaders:e,url:i}=t,{query:n}=i;if(n&&n.requestFrom)return;const s=p()(e,t=>"referer"===t.name.toLowerCase());return s?s.value="https://www.bilibili.com/":e.push({name:"referer",value:"https://www.bilibili.com/"}),{requestHeaders:e}})),s()(this,"getFeedData",(t=1,e=1,i=20)=>new r.a(n=>this.emit("requestController","create",{url:`https://api.bilibili.com/pgc/web/follow/list?season_type=${t}&pn=${e}&ps=${i}&passWrapper=true`,options:{contentType:"json"}},n)).then(t=>0===t.code&&t.result))}async onBeforeLaunch(){this.addListener("getAnimaTimeline",(t,e,i)=>{this.getAnimaTimeline().then(t=>i(t))}),this.addListener("getAnimaTimelineCN",(t,e,i)=>{this.getAnimaTimelineCN().then(t=>i(t))}),this.addListener("getFeedData",(t,e,i)=>{this.getFeedData(t.type,t.pn,t.ps).then(t=>i(t))}),this.emit("webRequestController","create",{name:"animeFollowList",eventName:"onBeforeSendHeaders",filter:{urls:["*://api.bilibili.com/pgc/web/follow/list?*"]},options:["blocking","requestHeaders","extraHeaders"],callback:this.onBeforeSendHeadersCallback})}async onLaunch(){}}class f extends o.a{constructor(t,e){super(t,e,"mainFavlist",{dependencies:["bilibiliAccountController"],settings:{on:!0,openMethod:"direct"}}),s()(this,"onBeforeLaunch",async()=>{this.addListener("accountChanged",({hasLogin:t,bilibiliAccount:e},i,n)=>{this.hasLogin=t,this.bilibiliAccount=e,n instanceof Function&&n()}),this.addListener("getMediaList",(t,e,i)=>{this.getMediaList().then(t=>i(t))}),this.addListener("getVideoList",(t,e,i)=>{this.getVideoList(t.id,t.pn).then(t=>i(t))}),await this.emit("bilibiliHelperAccountController","getStatus",null,({hasLogin:t,bilibiliAccount:e})=>{this.hasLogin=t,this.bilibiliAccount=e})}),s()(this,"getMediaList",()=>new r.a(t=>{this.emit("requestController","create",{url:"https://api.bilibili.com/x/v3/fav/folder/created/list-all?up_mid="+this.bilibiliAccount.uid,options:{contentType:"json"}},e=>{e&&e.data&&(e.data.list=e.data.list.map((t,e)=>(t.videos=[],t.pn=1,t.hasMore=!0,t)),t(e.data.list),console.log("favlist",e.data.list))})})),s()(this,"getVideoList",(t,e=1)=>new r.a(i=>{this.emit("requestController","create",{url:`https://api.bilibili.com/x/v3/fav/resource/list?media_id=${t}&pn=${e}&ps=20&keyword=&order=mtime&type=0&tid=0`,options:{contentType:"json"}},t=>{t&&t.data&&(t.data.medias.forEach(t=>{t.duration=Object(g.parseTime)(1e3*t.duration),t.publishDateDesc=t.pubtime?Object(g.videoPublishDescription)(1e3*t.pubtime):""}),i(t.data))})})),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}async onLaunch(){}}class b extends o.a{constructor(t,e){super(t,e,"mainLive",{dependencies:["bilibiliAccountController","bilibiliLiveBroadcast"],settings:{on:!0,openMethod:"direct"},cache:{type:"local",dataType:"object",delayDuration:2e3,limit:{duration:18e4}}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}async onLaunch(){this.addListener("getLiveFeedList",(t,e,i)=>{this.emit("bilibiliLiveBroadcast","getLiveFeedList",t,i)})}}class y extends o.a{constructor(t,e){super(t,e,"mainManga",{dependencies:["bilibiliAccountController"],settings:{on:!0,openMethod:"direct"}}),s()(this,"modifyOrigin",t=>{const{initiator:e,requestHeaders:i}=t,n=!l()(p()(i,({name:t})=>t.match("bilibili-helper-header-action"))),s=[...i];if(n){const t=s.findIndex(({name:t})=>"bilibili-helper-header-action-set-origin"===t);t>-1&&(s.push({name:"Origin",value:s[t].value}),s.splice(t,1))}return{requestHeaders:s}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}async onLaunch(){this.emit("webRequestController","create",{name:"mainMangaSetOrigin",eventName:"onBeforeSendHeaders",filter:{urls:["*://manga.bilibili.com/*"]},options:["blocking","requestHeaders","extraHeaders"],callback:this.modifyOrigin})}}const w=[{key:"animeTimeTable",on:!0},{key:"anime",on:!0},{key:"live",on:!0},{key:"favlist",on:!0},{key:"watchLater",on:!0},{key:"manga",on:!0}];class v extends o.a{constructor(t,e){super(t,e,"popupMain",{dependencies:["bilibiliAccountController"],settings:{on:!0,columns:1,videoCardType:"old",videoOpenMethod:"direct",sectionShow:[]}}),s()(this,"requireSection",()=>{this.getStore("requireSections")||(this.settings.sectionShow=w,this.setStore("requireSections",!0),this.setSetting(this.settings))}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}async onLaunch(){this.requireSection()}}var L=i(28),S=i.n(L),C=i(29),k=i.n(C),_=i(15),O=i.n(_),A=i(14),x=i.n(A),D=i(12),I=i.n(D),T=i(11),P=i.n(T),N=i(70),E=i.n(N),M=i(58),F=i.n(M),j=i(55);function R(t,e){var i=P()(t);if(I.a){var n=I()(t);e&&(n=n.filter((function(e){return x()(t,e).enumerable}))),i.push.apply(i,n)}return i}function B(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?R(Object(i),!0).forEach((function(e){s()(t,e,i[e])})):O.a?k()(t,O()(i)):R(Object(i)).forEach((function(e){S()(t,e,x()(i,e))}))}return t}const q=[{key:"home",on:!0,toggle:!0,needLogin:!1},{key:"live",on:!0,toggle:!0,needLogin:!1},{key:"dynamic",on:!0,toggle:!0,needLogin:!0},{key:"favourite",on:!0,toggle:!0,needLogin:!0},{key:"history",on:!0,toggle:!0,needLogin:!0},{key:"article",on:!0,toggle:!0,needLogin:!1},{key:"anime",on:!0,toggle:!0,needLogin:!1},{key:"audio",on:!0,toggle:!0,needLogin:!1}],U=[{title:"稍后",url:"https://www.bilibili.com/watchlater/#/list"},{title:"漫画",url:"https://manga.bilibili.com/"},{title:"频道",url:"https://www.bilibili.com/v/channel/"}],H=[];class $ extends o.a{constructor(t,e){super(t,e,"popupMenu",{dependencies:["bilibiliAccountController"],settings:{on:!0,menuOptions:q}}),s()(this,"hasPermission",!0),s()(this,"defaultTabMap",{home:()=>"https://www.bilibili.com/",live:()=>"https://live.bilibili.com/",dynamic:()=>"https://t.bilibili.com/",favourite:async()=>await this.emit("bilibiliAccountController","getLocalUID",null,t=>`https://space.bilibili.com/${t}/favlist`),history:()=>"https://www.bilibili.com/account/history",article:()=>"https://www.bilibili.com/read/home",anime:()=>"https://www.bilibili.com/anime",audio:()=>"https://www.bilibili.com/v/music"}),s()(this,"onBeforeSetSettingsFromCloud",async({settings:t})=>{E()(t.menuOptions)?t.menuOptions=t.menuOptions.map(t=>B(B({},t),{},{title:Object(j.a)("popupMenu_kinds_"+t.key)})):F()(t.menuOptions)&&(t.menuOptions=P()(t.menuOptions).map(e=>({key:e,title:Object(j.a)("popupMenu_kinds_"+e),on:t.menuOptions[e].on,needLogin:t.menuOptions[e].needLogin,toggle:t.menuOptions[e].toggle})))}),s()(this,"openNewTab",async(t,e,i)=>{const{url:n,key:s}=t;let o=!1;if(this.hasPermission){let t;if(s&&!this.defaultTabMap[s])return void this.logger.warn("undefined popup menu key",s);t=s?await this.defaultTabMap[s]():n,"home"!==s&&"live"!==s||(o=!0),this.emit("tabController","create",{url:t,strict:o},()=>{i(!0)})}else i(!1)}),s()(this,"initNewCustomMenu",()=>this.getStore("hasSetNewCustomMenu")?[]:(this.setStore("newCustomMenuList",H),this.setStore("hasSetNewCustomMenu",!0),H)),s()(this,"onAfterSetSettingsFromCloud",async()=>{this.customMenuStore=this.getStore("customMenu")}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings),stores:{customMenu:this.customMenuStore}})})}async onInitStore(){this.customMenuStore=this.getStore("customMenu");const t=this.initNewCustomMenu(),e=U;this.customMenuStore?this.customMenuStore=[...this.customMenuStore,...t]:(this.setStore("customMenu",e),this.customMenuStore=e),F()(this.settings.menuOptions)&&(this.settings.menuOptions=P()(this.settings.menuOptions).map(t=>({key:t,title:Object(j.a)("popupMenu_kinds_"+t),on:this.settings.menuOptions[t].on,needLogin:this.settings.menuOptions[t].needLogin,toggle:this.settings.menuOptions[t].toggle})),this.setSetting(this.settings)),this.settings.menuOptions.forEach(t=>{t.title=Object(j.a)("popupMenu_kinds_"+t.key)})}async onBeforeSetSetting(t){return F()(t.menuOptions)&&(t.menuOptions=P()(t.menuOptions).map(e=>({key:e,title:Object(j.a)("popupMenu_kinds_"+e),on:t.menuOptions[e].on,needLogin:t.menuOptions[e].needLogin,toggle:t.menuOptions[e].toggle}))),t}async onBeforeLaunch(){this.addListener("setSystemMenuState",(t,e,i)=>{if(t.key&&void 0!==t.on){console.log(t);const e=this.settings.menuOptions.find(({key:e})=>e===t.key);console.log(e),e&&(e.on=t.on),console.log(this.settings),this.setSetting(this.settings)}i(!0)}),this.addListener("setOptionsMenuList",(t,e,i)=>{this.settings.menuOptions=t.list,this.setSetting(this.settings),i(!0)}),this.addListener("setCustomMenuList",(t,e,i)=>{this.customMenuStore=t.list,this.setStore("customMenu",this.customMenuStore),i(!0)}),this.addListener("updateCustomMenu",(t,e,i)=>{console.log(t),void 0!==t.index&&void 0!==t.title&&void 0!==t.url?(this.customMenuStore[t.index]={title:t.title,url:t.url},this.setStore("customMenu",this.customMenuStore),i(!0)):i(!1)}),this.addListener("deleteCustomMenu",(t,e,i)=>{this.customMenuStore[t.index]?(this.customMenuStore.splice(t.index,1),this.setStore("customMenu",this.customMenuStore),i(!0)):i(!1)}),this.addListener("getMenuList",(t,e,i)=>{i({options:this.settings.menuOptions,custom:this.customMenuStore})}),this.addListener("openNewTab",this.openNewTab)}}class W extends o.a{constructor(t,e){super(t,e,"popupSearcher",{dependencies:["bilibiliAccountController"],settings:{on:!0}}),s()(this,"search",(t,e,i)=>{this.emit("tabController","create",{url:"https://search.bilibili.com/all?keyword="+t.keyword},()=>{const e=this.store.indexOf(t.keyword);e>=0&&this.store.splice(e,1),this.store.push(t.keyword),this.store=this.store.slice(-10),this.setStore("searchHistory",this.store)}),i(!0)}),s()(this,"getHistory",(t,e,i)=>{i(this.store)}),s()(this,"clearAll",(t,e,i)=>{this.store=[],this.setStore("searchHistory",this.store),i(!0)}),s()(this,"clearKeywordByIndex",(t,e,i)=>{this.store.splice(t.index,1),this.setStore("searchHistory",this.store),i(this.store)})}async onInitStore(){const t=this.getStore("searchHistory");void 0===t?(this.store=[],this.setStore("searchHistory",this.store)):this.store=t}async onLaunch(){this.addListener("go2Search",this.search),this.addListener("getSearchHistory",this.getHistory),this.addListener("clearAll",this.clearAll),this.addListener("clearKeywordByIndex",this.clearKeywordByIndex)}}i.d(e,"f",(function(){return V})),i.d(e,"g",(function(){return v})),i.d(e,"c",(function(){return u})),i.d(e,"a",(function(){return m})),i.d(e,"b",(function(){return f})),i.d(e,"d",(function(){return b})),i.d(e,"e",(function(){return y})),i.d(e,"h",(function(){return $})),i.d(e,"i",(function(){return W}));class V extends o.a{constructor(t,e){super(t,e,"popup",{settings:{on:!0,resizeRate:1}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}}},214:function(t,e,i){"use strict";var n=i(1),s=i.n(n),o=i(9);class a extends o.a{constructor(t,e){super(t,e,"videoWiden",{settings:{on:!1,widenType:"default"}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}}class r extends o.a{constructor(t,e){super(t,e,"videoHideDanmu",{settings:{on:!1}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}}var c=i(28),l=i.n(c),h=i(29),u=i.n(h),d=i(15),p=i.n(d),g=i(14),m=i.n(g),f=i(12),b=i.n(f),y=i(11),w=i.n(y),v=i(30),L=i.n(v),S=i(86),C=i.n(S),k=i(46),_=i.n(k),O=i(34),A=i.n(O),x=i(7);function D(t,e){var i=w()(t);if(b.a){var n=b()(t);e&&(n=n.filter((function(e){return m()(t,e).enumerable}))),i.push.apply(i,n)}return i}function I(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?D(Object(i),!0).forEach((function(e){s()(t,e,i[e])})):p.a?u()(t,p()(i)):D(Object(i)).forEach((function(e){l()(t,e,m()(i,e))}))}return t}class T extends o.a{constructor(t,e){super(t,e,"watchLater",{settings:{on:!0}}),s()(this,"csrf",null),s()(this,"currentList",new L.a),s()(this,"hasLogin",!1),s()(this,"bilibiliAccount",null),s()(this,"onBeforeSendHeadersCallback",t=>{const{initiator:e,requestHeaders:i,tabId:n}=t,s=!A()(_()(i,({name:t,value:e})=>"from"===t.toLowerCase()&&e.toLowerCase().includes("bilibili_helper_2"))),o=!A()(_()(i,({name:t})=>t.match("bilibili-helper-header-action")));if((/^chrome-extension:\/\//.test(e)||-1===n)&&s&&"https://www.bilibili.com"!==e&&o){const t=[...i],e=t.findIndex(({name:t})=>"bilibili-helper-header-action-set-origin"===t.toLowerCase());if(e>-1){const i=t.find(({name:t})=>"origin"===t.toLowerCase());i?i.value="https://www.bilibili.com":t.push({name:"Origin",value:t[e].value}),t.splice(e,1)}return{requestHeaders:t}}return{requestHeaders:i}}),s()(this,"bilibiliWatchLaterWatcher",Object(x.webRequestCallbackWrapper)(t=>{this.updateWatchLaterList()})),s()(this,"getList",(t,e,i)=>{this.emit("requestController","create",{url:"https://api.bilibili.com/x/v2/history/toview/web",options:{contentType:"json",controlPassword:"updateWatchLater"}},t=>{0===t.code&&(t.data.list&&t.data.list.length>0?(t.data.list.map(t=>{this.currentList.set(t.aid,t)}),console.log(t.data.list),t.data.list=t.data.list.map(t=>I(I({},t),{},{cover:t.pic,duration:Object(x.parseTime)(1e3*t.duration),publishDateDesc:t.pubdate?Object(x.videoPublishDescription)(1e3*t.pubdate):""})),i(t.data.list)):(this.currentList.clear(),i(!1)))})}),s()(this,"queryVideoInWatchLaterList",(t,e,i)=>{t.aid?i(this.currentList.has(t.aid)):i(!1)}),s()(this,"setWatchLater",(t,e,i)=>{const{aid:n}=t;this.currentList.has(n)&&i(!0);const s=new FormData;s.append("csrf",this.csrf),s.append("aid",n);const o=new Headers;o.append("bilibili-helper-header-action-set-origin","https://www.bilibili.com"),this.emit("requestController","create",{url:"https://api.bilibili.com/x/v2/history/toview/add",options:{method:"post",credential:"include",headers:o,body:s,contentType:"json"}},async t=>{t&&0===t.code?(this.updateWatchLaterList(),i(!0)):t&&90005===t.code?i("notSupport"):i(!1)})}),s()(this,"removeWatchLater",(t,e,i)=>{const{aid:n}=t;this.currentList.has(n)&&i(!0);const s=new FormData;s.append("csrf",this.csrf),s.append("aid",n);const o=new Headers;o.append("bilibili-helper-header-action-set-origin","https://www.bilibili.com"),this.emit("requestController","create",{url:"https://api.bilibili.com/x/v2/history/toview/del",options:{method:"post",credential:"include",headers:o,body:s,contentType:"json"}},async t=>{t&&0===t.code?(this.updateWatchLaterList(),i(!0)):i(!1)})}),s()(this,"updateWatchLaterList",C()(()=>{this.emit("requestController","cancel",{controlPassword:"updateWatchLater"}),this.emit("requestController","create",{url:"https://api.bilibili.com/x/v2/history/toview/web",options:{contentType:"json",controlPassword:"updateWatchLater"}},t=>{0===t.code&&(t.data.list&&t.data.list.length>0?t.data.list.map(t=>{this.currentList.set(t.aid,t)}):this.currentList.clear())})},1e3))}async onBeforeLaunch(){this.addListener("accountChanged",({hasLogin:t,bilibiliAccount:e},i,n)=>{this.hasLogin=t,this.bilibiliAccount=e,this.hasLogin&&this.bilibiliAccount&&this.bilibiliAccount.hasLogin||this.pause(),n instanceof Function&&n()}),this.addListener("update",this.updateWatchLaterList),this.addListener("set",this.setWatchLater),this.addListener("remove",this.removeWatchLater),this.addListener("query",this.queryVideoInWatchLaterList),this.addListener("getList",this.getList)}async onLaunch(){let t=navigator.userAgent;const e=["blocking","requestHeaders"];-1!==t.indexOf("Chrome/")&&t.split("Chrome/")[1].substr(0,2)>72&&e.push("extraHeaders"),this.updateWatchLaterList(),this.emit("webRequestController","create",{name:"watchLater",eventName:"onBeforeSendHeaders",filter:{urls:["*://api.bilibili.com/x/v2/history/toview/add?*","*://api.bilibili.com/x/v2/history/toview/del?*"]},options:["blocking","requestHeaders","extraHeaders"],callback:this.onBeforeSendHeadersCallback}),this.emit("webRequestController","create",{name:"watchLaterFromBilibili",eventName:"onBeforeSendHeaders",filter:{urls:["*://api.bilibili.com/x/v2/history/toview*"]},options:["requestHeaders"],callback:this.bilibiliWatchLaterWatcher}),this.emit("cookieController","get",{url:"http://www.bilibili.com",name:"bili_jct"},t=>{this.csrf=t})}}var P=i(40),N=i.n(P),E=i(6),M=i.n(E),F=i(41),j=i.n(F);class R{constructor(t){s()(this,"selfId",void 0),s()(this,"addListener",()=>{chrome.runtime.onMessage.addListener((t,e)=>{const i=e.tab&&e.tab.id||e.id;if(this.selfId=i,t.command===this.initializedName){let t=this.createData(i);0===t.state?t.state=1:console.warn("This store is already in state:",t.state),this.dealWith(i)}return!0}),chrome.tabs.onRemoved.addListener((t,e)=>{this.has(t)&&e.isWindowClosing&&this.delete(t)}),chrome.tabs.onUpdated.addListener((t,e)=>{const{status:i,url:n}=e;this.has(t)&&"loading"===i&&void 0===n?this.delete(t):this.has(t)&&"complete"===i&&this.createData(t)})}),s()(this,"createData",t=>this.has(t)?this.store[t]:this.store[t]={state:0,queue:[],data:{id:t}}),s()(this,"has",t=>!!this.store[t]),s()(this,"get",t=>this.store[t]),s()(this,"delete",t=>delete this.store[t]),s()(this,"dealWith",t=>{if(!1===this.has[t])return console.error("Invalid tab id "+t);const{state:e,queue:i}=this.store[t];e&&i.length>0&&((t,e)=>e?new M.a((i,n)=>{chrome.tabs.sendMessage(t,e,s=>{void 0!==s?i():n(`No result from tab[${t}] - command[${e.command}]`)})}):M.a.resolve())(t,i.shift()).then(()=>{i.length>0&&this.dealWith(t)},t=>console.error(t))}),this.store={},this.initializedName=t,this.addListener()}}var B=i(48);class q extends o.a{constructor(t,e){super(t,e,"videoDownload",{dependencies:["renameDownloadFile"],settings:{on:!0,showFLVSegment:!0}}),s()(this,"messageStore",new R("videoDownloadDOMInitialized")),s()(this,"fetchingSignalMap",{}),s()(this,"modifyReferer",t=>{const{initiator:e,requestHeaders:i}=t,n=!A()(_()(i,({name:t})=>t.match("bilibili-helper-header-action"))),s=[...i];if(n){const t=s.findIndex(({name:t})=>"bilibili-helper-header-action-set-referer"===t);t>-1&&(s.push({name:"Referer",value:s[t].value}),s.splice(t,1))}return{requestHeaders:s}}),s()(this,"videoWatcherCallback",Object(B.n)(t=>{const{tabId:e}=t,i=new j.a(t.url,"",!0),{pathname:n,query:s}=i;if(s.passWrapper)return;if(s&&s.requestFrom)return;const o=this.messageStore.createData(e);if("/x/player/v2"===n||"/x/player/playurl"===n||"/player.html"===n){let{cid:t,aid:i,bvid:n}=s;i&&!n?n=Object(B.a)(+i):n&&!i&&(i=Object(B.b)(n)),o.queue.length>0&&(o.queue=[]),o.queue.push({command:"initNewVideoIds",type:"init",data:{cid:t,aid:i,bvid:n}}),this.messageStore.dealWith(e),this.cancelFetchPlayUrl(t).then(()=>{this.fetchPlayUrl(t,i,n).then(t=>{o.queue.push({command:"initNewVideoPlayInfo",type:"initVideoData",data:!(!t||0!==t.code)&&t.data}),this.messageStore.dealWith(e)})})}else if("/pgc/player/web/playurl"===n){let{cid:i}=s;o.queue.length>0&&(o.queue=[]),this.messageStore.dealWith(e),this.cancelFetchPlayUrl(i+"dash").then(()=>{this.fetchPlayDashUrl(i+"dash",t.url).then(t=>{o.queue.push({command:"initDashVideoPlayInfo",type:"initVideoData",data:!(!t||0!==t.code)&&t.result}),this.messageStore.dealWith(e)})})}})),s()(this,"getPlayUrl",async(t,e,i)=>this.fetchPlayUrl(t.cid,t.aid,t.bvid,t.quality).then(t=>{console.log(t,t&&0===t.code&&t.data.durl),t&&0===t.code&&t.data.durl&&t.data.durl.length>0?i(t.data.durl):i(!1)})),s()(this,"fetchPlayDashUrl",async(t,e)=>new M.a(i=>{this.fetchingSignalMap[t]=t+N()(),this.emit("requestController","create",{url:e,options:{contentType:"json",credential:"include",headers:{"bilibili-helper-header-action-set-referer":e},controlPassword:this.fetchingSignalMap[t]}},i)})),s()(this,"fetchPlayUrl",async(t,e,i,n=120)=>new M.a(s=>{console.log(t,e,i,n);const o=`https://api.bilibili.com/x/player/playurl?cid=${t}&bvid=${i}&aid=${e}&qn=${n}&type=flv&fourk=1`;this.fetchingSignalMap[t]=t+N()(),this.emit("requestController","create",{url:o,options:{contentType:"json",credential:"include",headers:{"bilibili-helper-header-action-set-referer":o},controlPassword:this.fetchingSignalMap[t]}},s)})),s()(this,"cancelFetchPlayUrl",async t=>this.fetchingSignalMap[t]?new M.a(e=>{this.emit("requestController","cancel",{signal:this.fetchingSignalMap[t]},t=>e(t))}):M.a.resolve(!0)),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}async onLaunch(){this.emit("webRequestController","create",{name:"videoDownloadVideoWatcher",eventName:"onBeforeSendHeaders",filter:{urls:["*://api.bilibili.com/pgc/player/web/playurl*","*://player.bilibili.com/player.html*","*://api.bilibili.com/x/player/v2?*"]},options:["requestHeaders"],callback:this.videoWatcherCallback}),this.emit("webRequestController","create",{name:"videoDownloadVideoFetchAgain",eventName:"onBeforeSendHeaders",filter:{urls:["*://api.bilibili.com/x/player/playurl*","*://*.bilivideo.com/upgcxcode/*"]},options:["blocking","requestHeaders","extraHeaders"],callback:this.modifyReferer}),this.addListener("getPlayUrl",this.getPlayUrl),this.addListener("fetchPlayUrl",(t,e,i)=>{this.fetchPlayUrl(t.cid,t.aid,t.bvid,t.quality).then(t=>{i(!!t&&t.data)})})}}var U=i(16),H=i.n(U),$=i(45),W=i.n($);let V={playResX:560,playResY:420,fontlist:["PingFang SC","Source Han Sans CN","Microsoft YaHei UI","Microsoft YaHei","文泉驿正黑","STHeitiSC","黑体"],font_size:1,r2ltime:8,fixtime:4,opacity:.6,space:0,max_delay:6,bottom:50,use_canvas:null,debug:!1},z=V.debug?console.log.bind(console):function(){},G=function(t){let e=Number(t).toString(16).toUpperCase();return e.length>6&&(e=e.substr(1)),Array(7-e.length).join("0")+e},Q=function(t){let e=Math.round(255*(1-t)).toString(16).toUpperCase();return Array(3-e.length).join("0")+e},J=Math.hypot?Math.hypot.bind(Math):function(){return Math.sqrt([0].concat(Array.apply(Array,arguments)).reduce((function(t,e){return t+e*e})))},Y=(null===V.use_canvas&&navigator.platform.match(/linux/i)&&!navigator.userAgent.match(/chrome/i)&&(V.use_canvas=!1),z("use canvas: %o",!1!==V.use_canvas),!1===V.use_canvas?function(){let t=document.createElement("div");t.setAttribute("style",["all: unset","top: -10000px","left: -10000px","width: auto","height: auto","position: absolute",""].join(" !important; "));let e=function(){document.body.parentNode.appendChild(t)};return document.body?e():document.addEventListener("DOMContentLoaded",e),function(e,i,n){return t.textContent=i,t.style.font="bold "+n+"px "+e,t.clientWidth+V.space}}():function(){let t=document.createElement("canvas").getContext("2d");return function(e,i,n){return t.font="bold "+n+"px "+e,Math.ceil(t.measureText(i).width+V.space)}}()),K=function(t){let e="The quick brown fox jumps over the lazy dog7531902468,.!-，。：！天地玄黄則近道矣",i=["monospace","sans-serif","sans","Symbol","Arial","Comic Sans MS","Fixed","Terminal","Times","Times New Roman","宋体","黑体","文泉驿正黑","Microsoft YaHei","PingFang SC"],n=t[t.length-1];return t=t.filter((function(t){let n=i.some((function(i){return function(t,i){return Y(t,e,72)!==Y(i+","+t,e,72)}(i,t)}));return z("font %s: %o",t,n),n})),z("fontlist: %o",t),t[0]||n},X=function(){let t=!1;return function(){t||(t=!0,Y=Y.bind(window,V.font=K(V.fontlist)))}}(),Z=function(t,e){let i=function(t){let e=Array.apply(Array,arguments);return t.replace(/{{([^}]+)}}/g,(function(t,i){let n;return e.some((function(t){return n=t[i]})),n||""}))}("[Script Info]\nTitle: {{title}}\nOriginal Script: 根据 {{ori}} 的弹幕信息，由 https://github.com/tiansh/us-danmaku 生成\nScriptType: v4.00+\nCollisions: Normal\nPlayResX: {{playResX}}\nPlayResY: {{playResY}}\nTimer: 10.0000\n\n[V4+ Styles]\nFormat: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\nStyle: Fix,{{font}},25,&H{{alpha}}FFFFFF,&H{{alpha}}FFFFFF,&H{{alpha}}000000,&H{{alpha}}000000,1,0,0,0,100,100,0,0,1,2,0,2,20,20,2,0\nStyle: R2L,{{font}},25,&H{{alpha}}FFFFFF,&H{{alpha}}FFFFFF,&H{{alpha}}000000,&H{{alpha}}000000,1,0,0,0,100,100,0,0,1,2,0,2,20,20,2,0\n\n[Events]\nFormat: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text\n",V,e,{alpha:Q(V.opacity)}),n=function(t){t=100*t^0;let e=[[100,2],[60,2],[60,2],[1/0,0]].map((function(e){let i=t%e[0];return t=(t-i)/e[0],function(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}(i,e[1])})).reverse();return e.slice(0,-1).join(":")+"."+e[3]},s=function(){let t=function(t){return function(e){return t(e)+function(t){let e="",i=t.color.split(/(..)/).filter((function(t){return t})).map((function(t){return W()(t,16)}));return"FFFFFF"!==t.color&&(e+="\\c&H"+t.color.split(/(..)/).reverse().join("")),.299*i[0]+.587*i[1]+.114*i[2]<48&&(e+="\\3c&HFFFFFF"),25!==t.size&&(e+="\\fs"+t.size),e}(e)}};return{R2L:t((function(t){return"\\move("+[t.poss.x,t.poss.y,t.posd.x,t.posd.y].join(",")+")"})),Fix:t((function(t){return"\\pos("+[t.poss.x,t.poss.y].join(",")+")"}))}}();return i+t.map((function(t){return"Dialogue: "+[0,n(t.stime),n(t.dtime),t.type,",20,20,2,,"].join(",")+"{"+s[t.type](t)+"}"+t.text.replace(/{/g,"｛").replace(/}/g,"｝").replace(/\r|\n/g,"")})).filter((function(t){return t})).join("\n")},tt=(et=V.playResX,it=V.playResY,nt=V.bottom,st=V.r2ltime,ot=V.max_delay,function(){let t=[{p:-1/0,m:0,tf:1/0,td:1/0,b:!1},{p:it,m:1/0,tf:1/0,td:1/0,b:!1},{p:it-nt,m:it,tf:1/0,td:1/0,b:!0}],e=function(t){return t.r>ot?-1/0:1-J(t.r/ot,t.p/it)*Math.SQRT1_2};return function(i,n,s,o){let a=et/(n+et)*st+i;!function(e,i){t=t.filter((function(t){return t.tf>e||t.td>i}))}(i,a);let r=function(e,i,n,s){let o=[];t.forEach((function(a){if(a.m>it)return;let r=a.m,c=r+e,l=i,h=n;t.forEach((function(t){t.p>=c||t.m<=r||t.b&&s||(l=Math.max(l,t.tf),h=Math.max(h,t.td))})),o.push({p:r,r:Math.max(l-i,h-n)})})),o.sort((function(t,e){return t.p-e.p}));let a=ot;return o=o.filter((function(t){return!(t.r>=a||(a=t.r,0))})),o}(s,i,a,o);if(!r.length)return null;let c=r.map((function(t){return[e(t),t]})).reduce((function(t,e){return t[0]>e[0]?t:e}))[1],l=i+c.r,h=n/(n+et)*st+l,u=st+l;return function(e,i,n,s){t.push({p:e,m:i,tf:n,td:s,b:!1})}(c.p,c.p+s,h,u),{top:c.p,time:l}}});var et,it,nt,st,ot;let at=function(t,e,i,n){return function(){let s=[{p:-1/0,m:0,td:1/0,b:!1},{p:t,m:1/0,td:1/0,b:!1},{p:t-e,m:t,td:1/0,b:!0}],o=function(t,e,i,n){let o=i;return s.forEach((function(i){i.p>=e||i.m<=t||i.b&&n||(o=Math.max(o,i.td))})),{r:o-i,p:t,m:e}},a=function(e,i,n){let a=[];return s.forEach((function(s){s.m>t||a.push(o(s.m,s.m+e,i,n))})),a},r=function(t,e,i){let n=[];return s.forEach((function(s){s.p<0||n.push(o(s.p-t,s.p,e,i))})),n},c=function(e,i){if(e.r>n)return-1/0;return 1-(e.r/n*(31/32)+(s=e.p,(i?s:t-s)/t*(1/32)));var s};return function(t,e,n,o){!function(t){s=s.filter((function(e){return e.td>t}))}(t);let l=(n?a:r)(e,t,o);if(!l.length)return null;let h=l.map((function(t){return[c(t,n),t]})).reduce((function(t,e){return t[0]>e[0]?t:e}))[1];var u,d,p;return u=h.p,d=h.m,p=h.r+t+i,s.push({p:u,m:d,td:p,b:!1}),{top:h.p,time:h.r+t}}}}(V.playResY,V.bottom,V.fixtime,V.max_delay),rt=function(t){let e=tt(),i=at();return t.sort((function(t,e){return t.time-e.time})).map((function(t){let n=Math.round(t.size*V.font_size),s=Y(t.text,n);switch(t.mode){case"R2L":return function(){let i=e(t.time,s,n,t.bottom);return i?(t.type="R2L",t.stime=i.time,t.poss={x:V.playResX+s/2,y:i.top+n},t.posd={x:-s/2,y:i.top+n},t.dtime=V.r2ltime+t.stime,t):null}();case"TOP":case"BOTTOM":return function(e){let s=i(t.time,n,e,t.bottom);return s?(t.type="Fix",t.stime=s.time,t.posd=t.poss={x:Math.round(V.playResX/2),y:s.top+n},t.dtime=V.fixtime+t.stime,t):null}("TOP"===t.mode);default:return null}})).filter((function(t){return t})).sort((function(t,e){return t.stime-e.stime}))};function ct(t,e){return Z(rt(function(t){return t.map(t=>{let{danmu:e,progress:i,mode:n,fontsize:s,color:o,weight:a}=t;return n=[void 0,"R2L","R2L","R2L","BOTTOM","TOP"][n],o=G(o),{text:e,time:(i||0)/1e3,mode:n,size:s,color:o,bottom:a>0}})}(t)),e)}X();var lt,ht,ut,dt,pt,gt,mt,ft,bt,yt,wt=i(70),vt=i.n(wt),Lt=i(296),St=(lt=i.n(Lt).a,mt=lt.Reader,ft=lt.Writer,bt=lt.util,(yt=lt.roots.default||(lt.roots.default={})).bilibili=((gt={}).community=((pt={}).service=((dt={}).dm=((ut={}).v1=((ht={}).DmWebViewReply=function(){function t(t){if(this.specialDms=[],this.commandDms=[],t)for(var e=w()(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.state=0,t.prototype.text="",t.prototype.textSide="",t.prototype.dmSge=null,t.prototype.flag=null,t.prototype.specialDms=bt.emptyArray,t.prototype.checkBox=!1,t.prototype.count=bt.Long?bt.Long.fromBits(0,0,!1):0,t.prototype.commandDms=bt.emptyArray,t.prototype.dmSetting=null,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=ft.create()),null!=t.state&&Object.hasOwnProperty.call(t,"state")&&e.uint32(8).int32(t.state),null!=t.text&&Object.hasOwnProperty.call(t,"text")&&e.uint32(18).string(t.text),null!=t.textSide&&Object.hasOwnProperty.call(t,"textSide")&&e.uint32(26).string(t.textSide),null!=t.dmSge&&Object.hasOwnProperty.call(t,"dmSge")&&yt.bilibili.community.service.dm.v1.DmSegConfig.encode(t.dmSge,e.uint32(34).fork()).ldelim(),null!=t.flag&&Object.hasOwnProperty.call(t,"flag")&&yt.bilibili.community.service.dm.v1.DanmakuFlagConfig.encode(t.flag,e.uint32(42).fork()).ldelim(),null!=t.specialDms&&t.specialDms.length)for(var i=0;i<t.specialDms.length;++i)e.uint32(50).string(t.specialDms[i]);if(null!=t.checkBox&&Object.hasOwnProperty.call(t,"checkBox")&&e.uint32(56).bool(t.checkBox),null!=t.count&&Object.hasOwnProperty.call(t,"count")&&e.uint32(64).int64(t.count),null!=t.commandDms&&t.commandDms.length)for(i=0;i<t.commandDms.length;++i)yt.bilibili.community.service.dm.v1.CommandDm.encode(t.commandDms[i],e.uint32(74).fork()).ldelim();return null!=t.dmSetting&&Object.hasOwnProperty.call(t,"dmSetting")&&yt.bilibili.community.service.dm.v1.DanmuWebPlayerConfig.encode(t.dmSetting,e.uint32(82).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof mt||(t=mt.create(t));for(var i=void 0===e?t.len:t.pos+e,n=new yt.bilibili.community.service.dm.v1.DmWebViewReply;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:n.state=t.int32();break;case 2:n.text=t.string();break;case 3:n.textSide=t.string();break;case 4:n.dmSge=yt.bilibili.community.service.dm.v1.DmSegConfig.decode(t,t.uint32());break;case 5:n.flag=yt.bilibili.community.service.dm.v1.DanmakuFlagConfig.decode(t,t.uint32());break;case 6:n.specialDms&&n.specialDms.length||(n.specialDms=[]),n.specialDms.push(t.string());break;case 7:n.checkBox=t.bool();break;case 8:n.count=t.int64();break;case 9:n.commandDms&&n.commandDms.length||(n.commandDms=[]),n.commandDms.push(yt.bilibili.community.service.dm.v1.CommandDm.decode(t,t.uint32()));break;case 10:n.dmSetting=yt.bilibili.community.service.dm.v1.DanmuWebPlayerConfig.decode(t,t.uint32());break;default:t.skipType(7&s)}}return n},t.decodeDelimited=function(t){return t instanceof mt||(t=new mt(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.state&&t.hasOwnProperty("state")&&!bt.isInteger(t.state))return"state: integer expected";if(null!=t.text&&t.hasOwnProperty("text")&&!bt.isString(t.text))return"text: string expected";if(null!=t.textSide&&t.hasOwnProperty("textSide")&&!bt.isString(t.textSide))return"textSide: string expected";if(null!=t.dmSge&&t.hasOwnProperty("dmSge")&&(i=yt.bilibili.community.service.dm.v1.DmSegConfig.verify(t.dmSge)))return"dmSge."+i;if(null!=t.flag&&t.hasOwnProperty("flag")&&(i=yt.bilibili.community.service.dm.v1.DanmakuFlagConfig.verify(t.flag)))return"flag."+i;if(null!=t.specialDms&&t.hasOwnProperty("specialDms")){if(!vt()(t.specialDms))return"specialDms: array expected";for(var e=0;e<t.specialDms.length;++e)if(!bt.isString(t.specialDms[e]))return"specialDms: string[] expected"}if(null!=t.checkBox&&t.hasOwnProperty("checkBox")&&"boolean"!=typeof t.checkBox)return"checkBox: boolean expected";if(null!=t.count&&t.hasOwnProperty("count")&&!(bt.isInteger(t.count)||t.count&&bt.isInteger(t.count.low)&&bt.isInteger(t.count.high)))return"count: integer|Long expected";if(null!=t.commandDms&&t.hasOwnProperty("commandDms")){if(!vt()(t.commandDms))return"commandDms: array expected";for(e=0;e<t.commandDms.length;++e){var i;if(i=yt.bilibili.community.service.dm.v1.CommandDm.verify(t.commandDms[e]))return"commandDms."+i}}return null!=t.dmSetting&&t.hasOwnProperty("dmSetting")&&(i=yt.bilibili.community.service.dm.v1.DanmuWebPlayerConfig.verify(t.dmSetting))?"dmSetting."+i:null},t.fromObject=function(t){if(t instanceof yt.bilibili.community.service.dm.v1.DmWebViewReply)return t;var e=new yt.bilibili.community.service.dm.v1.DmWebViewReply;if(null!=t.state&&(e.state=0|t.state),null!=t.text&&(e.text=String(t.text)),null!=t.textSide&&(e.textSide=String(t.textSide)),null!=t.dmSge){if("object"!=typeof t.dmSge)throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.dmSge: object expected");e.dmSge=yt.bilibili.community.service.dm.v1.DmSegConfig.fromObject(t.dmSge)}if(null!=t.flag){if("object"!=typeof t.flag)throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.flag: object expected");e.flag=yt.bilibili.community.service.dm.v1.DanmakuFlagConfig.fromObject(t.flag)}if(t.specialDms){if(!vt()(t.specialDms))throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.specialDms: array expected");e.specialDms=[];for(var i=0;i<t.specialDms.length;++i)e.specialDms[i]=String(t.specialDms[i])}if(null!=t.checkBox&&(e.checkBox=Boolean(t.checkBox)),null!=t.count&&(bt.Long?(e.count=bt.Long.fromValue(t.count)).unsigned=!1:"string"==typeof t.count?e.count=W()(t.count,10):"number"==typeof t.count?e.count=t.count:"object"==typeof t.count&&(e.count=new bt.LongBits(t.count.low>>>0,t.count.high>>>0).toNumber())),t.commandDms){if(!vt()(t.commandDms))throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.commandDms: array expected");for(e.commandDms=[],i=0;i<t.commandDms.length;++i){if("object"!=typeof t.commandDms[i])throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.commandDms: object expected");e.commandDms[i]=yt.bilibili.community.service.dm.v1.CommandDm.fromObject(t.commandDms[i])}}if(null!=t.dmSetting){if("object"!=typeof t.dmSetting)throw TypeError(".bilibili.community.service.dm.v1.DmWebViewReply.dmSetting: object expected");e.dmSetting=yt.bilibili.community.service.dm.v1.DanmuWebPlayerConfig.fromObject(t.dmSetting)}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.specialDms=[],i.commandDms=[]),e.defaults){if(i.state=0,i.text="",i.textSide="",i.dmSge=null,i.flag=null,i.checkBox=!1,bt.Long){var n=new bt.Long(0,0,!1);i.count=e.longs===String?n.toString():e.longs===Number?n.toNumber():n}else i.count=e.longs===String?"0":0;i.dmSetting=null}if(null!=t.state&&t.hasOwnProperty("state")&&(i.state=t.state),null!=t.text&&t.hasOwnProperty("text")&&(i.text=t.text),null!=t.textSide&&t.hasOwnProperty("textSide")&&(i.textSide=t.textSide),null!=t.dmSge&&t.hasOwnProperty("dmSge")&&(i.dmSge=yt.bilibili.community.service.dm.v1.DmSegConfig.toObject(t.dmSge,e)),null!=t.flag&&t.hasOwnProperty("flag")&&(i.flag=yt.bilibili.community.service.dm.v1.DanmakuFlagConfig.toObject(t.flag,e)),t.specialDms&&t.specialDms.length){i.specialDms=[];for(var s=0;s<t.specialDms.length;++s)i.specialDms[s]=t.specialDms[s]}if(null!=t.checkBox&&t.hasOwnProperty("checkBox")&&(i.checkBox=t.checkBox),null!=t.count&&t.hasOwnProperty("count")&&("number"==typeof t.count?i.count=e.longs===String?String(t.count):t.count:i.count=e.longs===String?bt.Long.prototype.toString.call(t.count):e.longs===Number?new bt.LongBits(t.count.low>>>0,t.count.high>>>0).toNumber():t.count),t.commandDms&&t.commandDms.length)for(i.commandDms=[],s=0;s<t.commandDms.length;++s)i.commandDms[s]=yt.bilibili.community.service.dm.v1.CommandDm.toObject(t.commandDms[s],e);return null!=t.dmSetting&&t.hasOwnProperty("dmSetting")&&(i.dmSetting=yt.bilibili.community.service.dm.v1.DanmuWebPlayerConfig.toObject(t.dmSetting,e)),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},t}(),ht.CommandDm=function(){function t(t){if(t)for(var e=w()(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id=bt.Long?bt.Long.fromBits(0,0,!1):0,t.prototype.oid=bt.Long?bt.Long.fromBits(0,0,!1):0,t.prototype.mid=bt.Long?bt.Long.fromBits(0,0,!1):0,t.prototype.command="",t.prototype.content="",t.prototype.progress=0,t.prototype.ctime="",t.prototype.mtime="",t.prototype.extra="",t.prototype.idStr="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ft.create()),null!=t.id&&Object.hasOwnProperty.call(t,"id")&&e.uint32(8).int64(t.id),null!=t.oid&&Object.hasOwnProperty.call(t,"oid")&&e.uint32(16).int64(t.oid),null!=t.mid&&Object.hasOwnProperty.call(t,"mid")&&e.uint32(24).int64(t.mid),null!=t.command&&Object.hasOwnProperty.call(t,"command")&&e.uint32(34).string(t.command),null!=t.content&&Object.hasOwnProperty.call(t,"content")&&e.uint32(42).string(t.content),null!=t.progress&&Object.hasOwnProperty.call(t,"progress")&&e.uint32(48).int32(t.progress),null!=t.ctime&&Object.hasOwnProperty.call(t,"ctime")&&e.uint32(58).string(t.ctime),null!=t.mtime&&Object.hasOwnProperty.call(t,"mtime")&&e.uint32(66).string(t.mtime),null!=t.extra&&Object.hasOwnProperty.call(t,"extra")&&e.uint32(74).string(t.extra),null!=t.idStr&&Object.hasOwnProperty.call(t,"idStr")&&e.uint32(82).string(t.idStr),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof mt||(t=mt.create(t));for(var i=void 0===e?t.len:t.pos+e,n=new yt.bilibili.community.service.dm.v1.CommandDm;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:n.id=t.int64();break;case 2:n.oid=t.int64();break;case 3:n.mid=t.int64();break;case 4:n.command=t.string();break;case 5:n.content=t.string();break;case 6:n.progress=t.int32();break;case 7:n.ctime=t.string();break;case 8:n.mtime=t.string();break;case 9:n.extra=t.string();break;case 10:n.idStr=t.string();break;default:t.skipType(7&s)}}return n},t.decodeDelimited=function(t){return t instanceof mt||(t=new mt(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.id&&t.hasOwnProperty("id")&&!(bt.isInteger(t.id)||t.id&&bt.isInteger(t.id.low)&&bt.isInteger(t.id.high))?"id: integer|Long expected":null!=t.oid&&t.hasOwnProperty("oid")&&!(bt.isInteger(t.oid)||t.oid&&bt.isInteger(t.oid.low)&&bt.isInteger(t.oid.high))?"oid: integer|Long expected":null!=t.mid&&t.hasOwnProperty("mid")&&!(bt.isInteger(t.mid)||t.mid&&bt.isInteger(t.mid.low)&&bt.isInteger(t.mid.high))?"mid: integer|Long expected":null!=t.command&&t.hasOwnProperty("command")&&!bt.isString(t.command)?"command: string expected":null!=t.content&&t.hasOwnProperty("content")&&!bt.isString(t.content)?"content: string expected":null!=t.progress&&t.hasOwnProperty("progress")&&!bt.isInteger(t.progress)?"progress: integer expected":null!=t.ctime&&t.hasOwnProperty("ctime")&&!bt.isString(t.ctime)?"ctime: string expected":null!=t.mtime&&t.hasOwnProperty("mtime")&&!bt.isString(t.mtime)?"mtime: string expected":null!=t.extra&&t.hasOwnProperty("extra")&&!bt.isString(t.extra)?"extra: string expected":null!=t.idStr&&t.hasOwnProperty("idStr")&&!bt.isString(t.idStr)?"idStr: string expected":null},t.fromObject=function(t){if(t instanceof yt.bilibili.community.service.dm.v1.CommandDm)return t;var e=new yt.bilibili.community.service.dm.v1.CommandDm;return null!=t.id&&(bt.Long?(e.id=bt.Long.fromValue(t.id)).unsigned=!1:"string"==typeof t.id?e.id=W()(t.id,10):"number"==typeof t.id?e.id=t.id:"object"==typeof t.id&&(e.id=new bt.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber())),null!=t.oid&&(bt.Long?(e.oid=bt.Long.fromValue(t.oid)).unsigned=!1:"string"==typeof t.oid?e.oid=W()(t.oid,10):"number"==typeof t.oid?e.oid=t.oid:"object"==typeof t.oid&&(e.oid=new bt.LongBits(t.oid.low>>>0,t.oid.high>>>0).toNumber())),null!=t.mid&&(bt.Long?(e.mid=bt.Long.fromValue(t.mid)).unsigned=!1:"string"==typeof t.mid?e.mid=W()(t.mid,10):"number"==typeof t.mid?e.mid=t.mid:"object"==typeof t.mid&&(e.mid=new bt.LongBits(t.mid.low>>>0,t.mid.high>>>0).toNumber())),null!=t.command&&(e.command=String(t.command)),null!=t.content&&(e.content=String(t.content)),null!=t.progress&&(e.progress=0|t.progress),null!=t.ctime&&(e.ctime=String(t.ctime)),null!=t.mtime&&(e.mtime=String(t.mtime)),null!=t.extra&&(e.extra=String(t.extra)),null!=t.idStr&&(e.idStr=String(t.idStr)),e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(bt.Long){var n=new bt.Long(0,0,!1);i.id=e.longs===String?n.toString():e.longs===Number?n.toNumber():n}else i.id=e.longs===String?"0":0;bt.Long?(n=new bt.Long(0,0,!1),i.oid=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.oid=e.longs===String?"0":0,bt.Long?(n=new bt.Long(0,0,!1),i.mid=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.mid=e.longs===String?"0":0,i.command="",i.content="",i.progress=0,i.ctime="",i.mtime="",i.extra="",i.idStr=""}return null!=t.id&&t.hasOwnProperty("id")&&("number"==typeof t.id?i.id=e.longs===String?String(t.id):t.id:i.id=e.longs===String?bt.Long.prototype.toString.call(t.id):e.longs===Number?new bt.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber():t.id),null!=t.oid&&t.hasOwnProperty("oid")&&("number"==typeof t.oid?i.oid=e.longs===String?String(t.oid):t.oid:i.oid=e.longs===String?bt.Long.prototype.toString.call(t.oid):e.longs===Number?new bt.LongBits(t.oid.low>>>0,t.oid.high>>>0).toNumber():t.oid),null!=t.mid&&t.hasOwnProperty("mid")&&("number"==typeof t.mid?i.mid=e.longs===String?String(t.mid):t.mid:i.mid=e.longs===String?bt.Long.prototype.toString.call(t.mid):e.longs===Number?new bt.LongBits(t.mid.low>>>0,t.mid.high>>>0).toNumber():t.mid),null!=t.command&&t.hasOwnProperty("command")&&(i.command=t.command),null!=t.content&&t.hasOwnProperty("content")&&(i.content=t.content),null!=t.progress&&t.hasOwnProperty("progress")&&(i.progress=t.progress),null!=t.ctime&&t.hasOwnProperty("ctime")&&(i.ctime=t.ctime),null!=t.mtime&&t.hasOwnProperty("mtime")&&(i.mtime=t.mtime),null!=t.extra&&t.hasOwnProperty("extra")&&(i.extra=t.extra),null!=t.idStr&&t.hasOwnProperty("idStr")&&(i.idStr=t.idStr),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},t}(),ht.DmSegConfig=function(){function t(t){if(t)for(var e=w()(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.pageSize=bt.Long?bt.Long.fromBits(0,0,!1):0,t.prototype.total=bt.Long?bt.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ft.create()),null!=t.pageSize&&Object.hasOwnProperty.call(t,"pageSize")&&e.uint32(8).int64(t.pageSize),null!=t.total&&Object.hasOwnProperty.call(t,"total")&&e.uint32(16).int64(t.total),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof mt||(t=mt.create(t));for(var i=void 0===e?t.len:t.pos+e,n=new yt.bilibili.community.service.dm.v1.DmSegConfig;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:n.pageSize=t.int64();break;case 2:n.total=t.int64();break;default:t.skipType(7&s)}}return n},t.decodeDelimited=function(t){return t instanceof mt||(t=new mt(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.pageSize&&t.hasOwnProperty("pageSize")&&!(bt.isInteger(t.pageSize)||t.pageSize&&bt.isInteger(t.pageSize.low)&&bt.isInteger(t.pageSize.high))?"pageSize: integer|Long expected":null!=t.total&&t.hasOwnProperty("total")&&!(bt.isInteger(t.total)||t.total&&bt.isInteger(t.total.low)&&bt.isInteger(t.total.high))?"total: integer|Long expected":null},t.fromObject=function(t){if(t instanceof yt.bilibili.community.service.dm.v1.DmSegConfig)return t;var e=new yt.bilibili.community.service.dm.v1.DmSegConfig;return null!=t.pageSize&&(bt.Long?(e.pageSize=bt.Long.fromValue(t.pageSize)).unsigned=!1:"string"==typeof t.pageSize?e.pageSize=W()(t.pageSize,10):"number"==typeof t.pageSize?e.pageSize=t.pageSize:"object"==typeof t.pageSize&&(e.pageSize=new bt.LongBits(t.pageSize.low>>>0,t.pageSize.high>>>0).toNumber())),null!=t.total&&(bt.Long?(e.total=bt.Long.fromValue(t.total)).unsigned=!1:"string"==typeof t.total?e.total=W()(t.total,10):"number"==typeof t.total?e.total=t.total:"object"==typeof t.total&&(e.total=new bt.LongBits(t.total.low>>>0,t.total.high>>>0).toNumber())),e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(bt.Long){var n=new bt.Long(0,0,!1);i.pageSize=e.longs===String?n.toString():e.longs===Number?n.toNumber():n}else i.pageSize=e.longs===String?"0":0;bt.Long?(n=new bt.Long(0,0,!1),i.total=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.total=e.longs===String?"0":0}return null!=t.pageSize&&t.hasOwnProperty("pageSize")&&("number"==typeof t.pageSize?i.pageSize=e.longs===String?String(t.pageSize):t.pageSize:i.pageSize=e.longs===String?bt.Long.prototype.toString.call(t.pageSize):e.longs===Number?new bt.LongBits(t.pageSize.low>>>0,t.pageSize.high>>>0).toNumber():t.pageSize),null!=t.total&&t.hasOwnProperty("total")&&("number"==typeof t.total?i.total=e.longs===String?String(t.total):t.total:i.total=e.longs===String?bt.Long.prototype.toString.call(t.total):e.longs===Number?new bt.LongBits(t.total.low>>>0,t.total.high>>>0).toNumber():t.total),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},t}(),ht.DanmakuFlagConfig=function(){function t(t){if(t)for(var e=w()(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.recFlag=0,t.prototype.recText="",t.prototype.recSwitch=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ft.create()),null!=t.recFlag&&Object.hasOwnProperty.call(t,"recFlag")&&e.uint32(8).int32(t.recFlag),null!=t.recText&&Object.hasOwnProperty.call(t,"recText")&&e.uint32(18).string(t.recText),null!=t.recSwitch&&Object.hasOwnProperty.call(t,"recSwitch")&&e.uint32(24).int32(t.recSwitch),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof mt||(t=mt.create(t));for(var i=void 0===e?t.len:t.pos+e,n=new yt.bilibili.community.service.dm.v1.DanmakuFlagConfig;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:n.recFlag=t.int32();break;case 2:n.recText=t.string();break;case 3:n.recSwitch=t.int32();break;default:t.skipType(7&s)}}return n},t.decodeDelimited=function(t){return t instanceof mt||(t=new mt(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.recFlag&&t.hasOwnProperty("recFlag")&&!bt.isInteger(t.recFlag)?"recFlag: integer expected":null!=t.recText&&t.hasOwnProperty("recText")&&!bt.isString(t.recText)?"recText: string expected":null!=t.recSwitch&&t.hasOwnProperty("recSwitch")&&!bt.isInteger(t.recSwitch)?"recSwitch: integer expected":null},t.fromObject=function(t){if(t instanceof yt.bilibili.community.service.dm.v1.DanmakuFlagConfig)return t;var e=new yt.bilibili.community.service.dm.v1.DanmakuFlagConfig;return null!=t.recFlag&&(e.recFlag=0|t.recFlag),null!=t.recText&&(e.recText=String(t.recText)),null!=t.recSwitch&&(e.recSwitch=0|t.recSwitch),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.recFlag=0,i.recText="",i.recSwitch=0),null!=t.recFlag&&t.hasOwnProperty("recFlag")&&(i.recFlag=t.recFlag),null!=t.recText&&t.hasOwnProperty("recText")&&(i.recText=t.recText),null!=t.recSwitch&&t.hasOwnProperty("recSwitch")&&(i.recSwitch=t.recSwitch),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},t}(),ht.DmSegMobileReply=function(){function t(t){if(this.elems=[],t)for(var e=w()(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.elems=bt.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=ft.create()),null!=t.elems&&t.elems.length)for(var i=0;i<t.elems.length;++i)yt.bilibili.community.service.dm.v1.DanmakuElem.encode(t.elems[i],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof mt||(t=mt.create(t));for(var i=void 0===e?t.len:t.pos+e,n=new yt.bilibili.community.service.dm.v1.DmSegMobileReply;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:n.elems&&n.elems.length||(n.elems=[]),n.elems.push(yt.bilibili.community.service.dm.v1.DanmakuElem.decode(t,t.uint32()));break;default:t.skipType(7&s)}}return n},t.decodeDelimited=function(t){return t instanceof mt||(t=new mt(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.elems&&t.hasOwnProperty("elems")){if(!vt()(t.elems))return"elems: array expected";for(var e=0;e<t.elems.length;++e){var i=yt.bilibili.community.service.dm.v1.DanmakuElem.verify(t.elems[e]);if(i)return"elems."+i}}return null},t.fromObject=function(t){if(t instanceof yt.bilibili.community.service.dm.v1.DmSegMobileReply)return t;var e=new yt.bilibili.community.service.dm.v1.DmSegMobileReply;if(t.elems){if(!vt()(t.elems))throw TypeError(".bilibili.community.service.dm.v1.DmSegMobileReply.elems: array expected");e.elems=[];for(var i=0;i<t.elems.length;++i){if("object"!=typeof t.elems[i])throw TypeError(".bilibili.community.service.dm.v1.DmSegMobileReply.elems: object expected");e.elems[i]=yt.bilibili.community.service.dm.v1.DanmakuElem.fromObject(t.elems[i])}}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.elems=[]),t.elems&&t.elems.length){i.elems=[];for(var n=0;n<t.elems.length;++n)i.elems[n]=yt.bilibili.community.service.dm.v1.DanmakuElem.toObject(t.elems[n],e)}return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},t}(),ht.DanmakuElem=function(){function t(t){if(t)for(var e=w()(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id=bt.Long?bt.Long.fromBits(0,0,!1):0,t.prototype.progress=0,t.prototype.mode=0,t.prototype.fontsize=0,t.prototype.color=0,t.prototype.midHash="",t.prototype.content="",t.prototype.ctime=bt.Long?bt.Long.fromBits(0,0,!1):0,t.prototype.weight=0,t.prototype.action="",t.prototype.pool=0,t.prototype.idStr="",t.prototype.attr=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ft.create()),null!=t.id&&Object.hasOwnProperty.call(t,"id")&&e.uint32(8).int64(t.id),null!=t.progress&&Object.hasOwnProperty.call(t,"progress")&&e.uint32(16).int32(t.progress),null!=t.mode&&Object.hasOwnProperty.call(t,"mode")&&e.uint32(24).int32(t.mode),null!=t.fontsize&&Object.hasOwnProperty.call(t,"fontsize")&&e.uint32(32).int32(t.fontsize),null!=t.color&&Object.hasOwnProperty.call(t,"color")&&e.uint32(40).uint32(t.color),null!=t.midHash&&Object.hasOwnProperty.call(t,"midHash")&&e.uint32(50).string(t.midHash),null!=t.content&&Object.hasOwnProperty.call(t,"content")&&e.uint32(58).string(t.content),null!=t.ctime&&Object.hasOwnProperty.call(t,"ctime")&&e.uint32(64).int64(t.ctime),null!=t.weight&&Object.hasOwnProperty.call(t,"weight")&&e.uint32(72).int32(t.weight),null!=t.action&&Object.hasOwnProperty.call(t,"action")&&e.uint32(82).string(t.action),null!=t.pool&&Object.hasOwnProperty.call(t,"pool")&&e.uint32(88).int32(t.pool),null!=t.idStr&&Object.hasOwnProperty.call(t,"idStr")&&e.uint32(98).string(t.idStr),null!=t.attr&&Object.hasOwnProperty.call(t,"attr")&&e.uint32(104).int32(t.attr),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof mt||(t=mt.create(t));for(var i=void 0===e?t.len:t.pos+e,n=new yt.bilibili.community.service.dm.v1.DanmakuElem;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:n.id=t.int64();break;case 2:n.progress=t.int32();break;case 3:n.mode=t.int32();break;case 4:n.fontsize=t.int32();break;case 5:n.color=t.uint32();break;case 6:n.midHash=t.string();break;case 7:n.content=t.string();break;case 8:n.ctime=t.int64();break;case 9:n.weight=t.int32();break;case 10:n.action=t.string();break;case 11:n.pool=t.int32();break;case 12:n.idStr=t.string();break;case 13:n.attr=t.int32();break;default:t.skipType(7&s)}}return n},t.decodeDelimited=function(t){return t instanceof mt||(t=new mt(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.id&&t.hasOwnProperty("id")&&!(bt.isInteger(t.id)||t.id&&bt.isInteger(t.id.low)&&bt.isInteger(t.id.high))?"id: integer|Long expected":null!=t.progress&&t.hasOwnProperty("progress")&&!bt.isInteger(t.progress)?"progress: integer expected":null!=t.mode&&t.hasOwnProperty("mode")&&!bt.isInteger(t.mode)?"mode: integer expected":null!=t.fontsize&&t.hasOwnProperty("fontsize")&&!bt.isInteger(t.fontsize)?"fontsize: integer expected":null!=t.color&&t.hasOwnProperty("color")&&!bt.isInteger(t.color)?"color: integer expected":null!=t.midHash&&t.hasOwnProperty("midHash")&&!bt.isString(t.midHash)?"midHash: string expected":null!=t.content&&t.hasOwnProperty("content")&&!bt.isString(t.content)?"content: string expected":null!=t.ctime&&t.hasOwnProperty("ctime")&&!(bt.isInteger(t.ctime)||t.ctime&&bt.isInteger(t.ctime.low)&&bt.isInteger(t.ctime.high))?"ctime: integer|Long expected":null!=t.weight&&t.hasOwnProperty("weight")&&!bt.isInteger(t.weight)?"weight: integer expected":null!=t.action&&t.hasOwnProperty("action")&&!bt.isString(t.action)?"action: string expected":null!=t.pool&&t.hasOwnProperty("pool")&&!bt.isInteger(t.pool)?"pool: integer expected":null!=t.idStr&&t.hasOwnProperty("idStr")&&!bt.isString(t.idStr)?"idStr: string expected":null!=t.attr&&t.hasOwnProperty("attr")&&!bt.isInteger(t.attr)?"attr: integer expected":null},t.fromObject=function(t){if(t instanceof yt.bilibili.community.service.dm.v1.DanmakuElem)return t;var e=new yt.bilibili.community.service.dm.v1.DanmakuElem;return null!=t.id&&(bt.Long?(e.id=bt.Long.fromValue(t.id)).unsigned=!1:"string"==typeof t.id?e.id=W()(t.id,10):"number"==typeof t.id?e.id=t.id:"object"==typeof t.id&&(e.id=new bt.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber())),null!=t.progress&&(e.progress=0|t.progress),null!=t.mode&&(e.mode=0|t.mode),null!=t.fontsize&&(e.fontsize=0|t.fontsize),null!=t.color&&(e.color=t.color>>>0),null!=t.midHash&&(e.midHash=String(t.midHash)),null!=t.content&&(e.content=String(t.content)),null!=t.ctime&&(bt.Long?(e.ctime=bt.Long.fromValue(t.ctime)).unsigned=!1:"string"==typeof t.ctime?e.ctime=W()(t.ctime,10):"number"==typeof t.ctime?e.ctime=t.ctime:"object"==typeof t.ctime&&(e.ctime=new bt.LongBits(t.ctime.low>>>0,t.ctime.high>>>0).toNumber())),null!=t.weight&&(e.weight=0|t.weight),null!=t.action&&(e.action=String(t.action)),null!=t.pool&&(e.pool=0|t.pool),null!=t.idStr&&(e.idStr=String(t.idStr)),null!=t.attr&&(e.attr=0|t.attr),e},t.toObject=function(t,e){e||(e={});var i={};if(e.defaults){if(bt.Long){var n=new bt.Long(0,0,!1);i.id=e.longs===String?n.toString():e.longs===Number?n.toNumber():n}else i.id=e.longs===String?"0":0;i.progress=0,i.mode=0,i.fontsize=0,i.color=0,i.midHash="",i.content="",bt.Long?(n=new bt.Long(0,0,!1),i.ctime=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.ctime=e.longs===String?"0":0,i.weight=0,i.action="",i.pool=0,i.idStr="",i.attr=0}return null!=t.id&&t.hasOwnProperty("id")&&("number"==typeof t.id?i.id=e.longs===String?String(t.id):t.id:i.id=e.longs===String?bt.Long.prototype.toString.call(t.id):e.longs===Number?new bt.LongBits(t.id.low>>>0,t.id.high>>>0).toNumber():t.id),null!=t.progress&&t.hasOwnProperty("progress")&&(i.progress=t.progress),null!=t.mode&&t.hasOwnProperty("mode")&&(i.mode=t.mode),null!=t.fontsize&&t.hasOwnProperty("fontsize")&&(i.fontsize=t.fontsize),null!=t.color&&t.hasOwnProperty("color")&&(i.color=t.color),null!=t.midHash&&t.hasOwnProperty("midHash")&&(i.midHash=t.midHash),null!=t.content&&t.hasOwnProperty("content")&&(i.content=t.content),null!=t.ctime&&t.hasOwnProperty("ctime")&&("number"==typeof t.ctime?i.ctime=e.longs===String?String(t.ctime):t.ctime:i.ctime=e.longs===String?bt.Long.prototype.toString.call(t.ctime):e.longs===Number?new bt.LongBits(t.ctime.low>>>0,t.ctime.high>>>0).toNumber():t.ctime),null!=t.weight&&t.hasOwnProperty("weight")&&(i.weight=t.weight),null!=t.action&&t.hasOwnProperty("action")&&(i.action=t.action),null!=t.pool&&t.hasOwnProperty("pool")&&(i.pool=t.pool),null!=t.idStr&&t.hasOwnProperty("idStr")&&(i.idStr=t.idStr),null!=t.attr&&t.hasOwnProperty("attr")&&(i.attr=t.attr),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},t}(),ht.DanmuWebPlayerConfig=function(){function t(t){if(t)for(var e=w()(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.dmSwitch=!1,t.prototype.aiSwitch=!1,t.prototype.aiLevel=0,t.prototype.blocktop=!1,t.prototype.blockscroll=!1,t.prototype.blockbottom=!1,t.prototype.blockcolor=!1,t.prototype.blockspecial=!1,t.prototype.preventshade=!1,t.prototype.dmask=!1,t.prototype.opacity=0,t.prototype.dmarea=0,t.prototype.speedplus=0,t.prototype.fontsize=0,t.prototype.screensync=!1,t.prototype.speedsync=!1,t.prototype.fontfamily="",t.prototype.bold=!1,t.prototype.fontborder=0,t.prototype.drawType="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ft.create()),null!=t.dmSwitch&&Object.hasOwnProperty.call(t,"dmSwitch")&&e.uint32(8).bool(t.dmSwitch),null!=t.aiSwitch&&Object.hasOwnProperty.call(t,"aiSwitch")&&e.uint32(16).bool(t.aiSwitch),null!=t.aiLevel&&Object.hasOwnProperty.call(t,"aiLevel")&&e.uint32(24).int32(t.aiLevel),null!=t.blocktop&&Object.hasOwnProperty.call(t,"blocktop")&&e.uint32(32).bool(t.blocktop),null!=t.blockscroll&&Object.hasOwnProperty.call(t,"blockscroll")&&e.uint32(40).bool(t.blockscroll),null!=t.blockbottom&&Object.hasOwnProperty.call(t,"blockbottom")&&e.uint32(48).bool(t.blockbottom),null!=t.blockcolor&&Object.hasOwnProperty.call(t,"blockcolor")&&e.uint32(56).bool(t.blockcolor),null!=t.blockspecial&&Object.hasOwnProperty.call(t,"blockspecial")&&e.uint32(64).bool(t.blockspecial),null!=t.preventshade&&Object.hasOwnProperty.call(t,"preventshade")&&e.uint32(72).bool(t.preventshade),null!=t.dmask&&Object.hasOwnProperty.call(t,"dmask")&&e.uint32(80).bool(t.dmask),null!=t.opacity&&Object.hasOwnProperty.call(t,"opacity")&&e.uint32(93).float(t.opacity),null!=t.dmarea&&Object.hasOwnProperty.call(t,"dmarea")&&e.uint32(96).int32(t.dmarea),null!=t.speedplus&&Object.hasOwnProperty.call(t,"speedplus")&&e.uint32(109).float(t.speedplus),null!=t.fontsize&&Object.hasOwnProperty.call(t,"fontsize")&&e.uint32(117).float(t.fontsize),null!=t.screensync&&Object.hasOwnProperty.call(t,"screensync")&&e.uint32(120).bool(t.screensync),null!=t.speedsync&&Object.hasOwnProperty.call(t,"speedsync")&&e.uint32(128).bool(t.speedsync),null!=t.fontfamily&&Object.hasOwnProperty.call(t,"fontfamily")&&e.uint32(138).string(t.fontfamily),null!=t.bold&&Object.hasOwnProperty.call(t,"bold")&&e.uint32(144).bool(t.bold),null!=t.fontborder&&Object.hasOwnProperty.call(t,"fontborder")&&e.uint32(152).int32(t.fontborder),null!=t.drawType&&Object.hasOwnProperty.call(t,"drawType")&&e.uint32(162).string(t.drawType),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof mt||(t=mt.create(t));for(var i=void 0===e?t.len:t.pos+e,n=new yt.bilibili.community.service.dm.v1.DanmuWebPlayerConfig;t.pos<i;){var s=t.uint32();switch(s>>>3){case 1:n.dmSwitch=t.bool();break;case 2:n.aiSwitch=t.bool();break;case 3:n.aiLevel=t.int32();break;case 4:n.blocktop=t.bool();break;case 5:n.blockscroll=t.bool();break;case 6:n.blockbottom=t.bool();break;case 7:n.blockcolor=t.bool();break;case 8:n.blockspecial=t.bool();break;case 9:n.preventshade=t.bool();break;case 10:n.dmask=t.bool();break;case 11:n.opacity=t.float();break;case 12:n.dmarea=t.int32();break;case 13:n.speedplus=t.float();break;case 14:n.fontsize=t.float();break;case 15:n.screensync=t.bool();break;case 16:n.speedsync=t.bool();break;case 17:n.fontfamily=t.string();break;case 18:n.bold=t.bool();break;case 19:n.fontborder=t.int32();break;case 20:n.drawType=t.string();break;default:t.skipType(7&s)}}return n},t.decodeDelimited=function(t){return t instanceof mt||(t=new mt(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.dmSwitch&&t.hasOwnProperty("dmSwitch")&&"boolean"!=typeof t.dmSwitch?"dmSwitch: boolean expected":null!=t.aiSwitch&&t.hasOwnProperty("aiSwitch")&&"boolean"!=typeof t.aiSwitch?"aiSwitch: boolean expected":null!=t.aiLevel&&t.hasOwnProperty("aiLevel")&&!bt.isInteger(t.aiLevel)?"aiLevel: integer expected":null!=t.blocktop&&t.hasOwnProperty("blocktop")&&"boolean"!=typeof t.blocktop?"blocktop: boolean expected":null!=t.blockscroll&&t.hasOwnProperty("blockscroll")&&"boolean"!=typeof t.blockscroll?"blockscroll: boolean expected":null!=t.blockbottom&&t.hasOwnProperty("blockbottom")&&"boolean"!=typeof t.blockbottom?"blockbottom: boolean expected":null!=t.blockcolor&&t.hasOwnProperty("blockcolor")&&"boolean"!=typeof t.blockcolor?"blockcolor: boolean expected":null!=t.blockspecial&&t.hasOwnProperty("blockspecial")&&"boolean"!=typeof t.blockspecial?"blockspecial: boolean expected":null!=t.preventshade&&t.hasOwnProperty("preventshade")&&"boolean"!=typeof t.preventshade?"preventshade: boolean expected":null!=t.dmask&&t.hasOwnProperty("dmask")&&"boolean"!=typeof t.dmask?"dmask: boolean expected":null!=t.opacity&&t.hasOwnProperty("opacity")&&"number"!=typeof t.opacity?"opacity: number expected":null!=t.dmarea&&t.hasOwnProperty("dmarea")&&!bt.isInteger(t.dmarea)?"dmarea: integer expected":null!=t.speedplus&&t.hasOwnProperty("speedplus")&&"number"!=typeof t.speedplus?"speedplus: number expected":null!=t.fontsize&&t.hasOwnProperty("fontsize")&&"number"!=typeof t.fontsize?"fontsize: number expected":null!=t.screensync&&t.hasOwnProperty("screensync")&&"boolean"!=typeof t.screensync?"screensync: boolean expected":null!=t.speedsync&&t.hasOwnProperty("speedsync")&&"boolean"!=typeof t.speedsync?"speedsync: boolean expected":null!=t.fontfamily&&t.hasOwnProperty("fontfamily")&&!bt.isString(t.fontfamily)?"fontfamily: string expected":null!=t.bold&&t.hasOwnProperty("bold")&&"boolean"!=typeof t.bold?"bold: boolean expected":null!=t.fontborder&&t.hasOwnProperty("fontborder")&&!bt.isInteger(t.fontborder)?"fontborder: integer expected":null!=t.drawType&&t.hasOwnProperty("drawType")&&!bt.isString(t.drawType)?"drawType: string expected":null},t.fromObject=function(t){if(t instanceof yt.bilibili.community.service.dm.v1.DanmuWebPlayerConfig)return t;var e=new yt.bilibili.community.service.dm.v1.DanmuWebPlayerConfig;return null!=t.dmSwitch&&(e.dmSwitch=Boolean(t.dmSwitch)),null!=t.aiSwitch&&(e.aiSwitch=Boolean(t.aiSwitch)),null!=t.aiLevel&&(e.aiLevel=0|t.aiLevel),null!=t.blocktop&&(e.blocktop=Boolean(t.blocktop)),null!=t.blockscroll&&(e.blockscroll=Boolean(t.blockscroll)),null!=t.blockbottom&&(e.blockbottom=Boolean(t.blockbottom)),null!=t.blockcolor&&(e.blockcolor=Boolean(t.blockcolor)),null!=t.blockspecial&&(e.blockspecial=Boolean(t.blockspecial)),null!=t.preventshade&&(e.preventshade=Boolean(t.preventshade)),null!=t.dmask&&(e.dmask=Boolean(t.dmask)),null!=t.opacity&&(e.opacity=Number(t.opacity)),null!=t.dmarea&&(e.dmarea=0|t.dmarea),null!=t.speedplus&&(e.speedplus=Number(t.speedplus)),null!=t.fontsize&&(e.fontsize=Number(t.fontsize)),null!=t.screensync&&(e.screensync=Boolean(t.screensync)),null!=t.speedsync&&(e.speedsync=Boolean(t.speedsync)),null!=t.fontfamily&&(e.fontfamily=String(t.fontfamily)),null!=t.bold&&(e.bold=Boolean(t.bold)),null!=t.fontborder&&(e.fontborder=0|t.fontborder),null!=t.drawType&&(e.drawType=String(t.drawType)),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.dmSwitch=!1,i.aiSwitch=!1,i.aiLevel=0,i.blocktop=!1,i.blockscroll=!1,i.blockbottom=!1,i.blockcolor=!1,i.blockspecial=!1,i.preventshade=!1,i.dmask=!1,i.opacity=0,i.dmarea=0,i.speedplus=0,i.fontsize=0,i.screensync=!1,i.speedsync=!1,i.fontfamily="",i.bold=!1,i.fontborder=0,i.drawType=""),null!=t.dmSwitch&&t.hasOwnProperty("dmSwitch")&&(i.dmSwitch=t.dmSwitch),null!=t.aiSwitch&&t.hasOwnProperty("aiSwitch")&&(i.aiSwitch=t.aiSwitch),null!=t.aiLevel&&t.hasOwnProperty("aiLevel")&&(i.aiLevel=t.aiLevel),null!=t.blocktop&&t.hasOwnProperty("blocktop")&&(i.blocktop=t.blocktop),null!=t.blockscroll&&t.hasOwnProperty("blockscroll")&&(i.blockscroll=t.blockscroll),null!=t.blockbottom&&t.hasOwnProperty("blockbottom")&&(i.blockbottom=t.blockbottom),null!=t.blockcolor&&t.hasOwnProperty("blockcolor")&&(i.blockcolor=t.blockcolor),null!=t.blockspecial&&t.hasOwnProperty("blockspecial")&&(i.blockspecial=t.blockspecial),null!=t.preventshade&&t.hasOwnProperty("preventshade")&&(i.preventshade=t.preventshade),null!=t.dmask&&t.hasOwnProperty("dmask")&&(i.dmask=t.dmask),null!=t.opacity&&t.hasOwnProperty("opacity")&&(i.opacity=e.json&&!isFinite(t.opacity)?String(t.opacity):t.opacity),null!=t.dmarea&&t.hasOwnProperty("dmarea")&&(i.dmarea=t.dmarea),null!=t.speedplus&&t.hasOwnProperty("speedplus")&&(i.speedplus=e.json&&!isFinite(t.speedplus)?String(t.speedplus):t.speedplus),null!=t.fontsize&&t.hasOwnProperty("fontsize")&&(i.fontsize=e.json&&!isFinite(t.fontsize)?String(t.fontsize):t.fontsize),null!=t.screensync&&t.hasOwnProperty("screensync")&&(i.screensync=t.screensync),null!=t.speedsync&&t.hasOwnProperty("speedsync")&&(i.speedsync=t.speedsync),null!=t.fontfamily&&t.hasOwnProperty("fontfamily")&&(i.fontfamily=t.fontfamily),null!=t.bold&&t.hasOwnProperty("bold")&&(i.bold=t.bold),null!=t.fontborder&&t.hasOwnProperty("fontborder")&&(i.fontborder=t.fontborder),null!=t.drawType&&t.hasOwnProperty("drawType")&&(i.drawType=t.drawType),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,lt.util.toJSONOptions)},t}(),ht),ut),dt),pt),gt),yt);const Ct=St.bilibili.community.service.dm.v1.DmSegMobileReply,kt=St.bilibili.community.service.dm.v1.DmWebViewReply;class _t extends o.a{constructor(t,e){super(t,e,"videoDanmu",{dependencies:["renameDownloadFile"],settings:{on:!0}}),s()(this,"messageStore",new R("danmuDOMInitialized")),s()(this,"onMessageReceived",(t,e,i)=>{if("fetchCardInfo"===t.command&&t.url&&this.emit("requestController","create",{url:t.url,options:{contentType:"json"}},t=>{t||console.error(t),i(t)}),"fetchNewTypeDanmuOption"===t.command&&t.url)this.emit("requestController","create",{url:t.url,options:{contentType:"arrayBuffer"}},t=>{const e=(t=>{const e=kt.decode(new Uint8Array(t));return kt.toObject(e)})(t);console.log(e),i(e.dmSge)});else if("fetchNewTypeDanmu"===t.command&&t.url)this.emit("requestController","create",{url:t.url,options:{contentType:"arrayBuffer"}},t=>{if(t){const e=(t=>{const e=Ct.decode(new Uint8Array(t));return Ct.toObject(e)})(t);i(e.elems||[])}else console.error(t),i(t)});else if("fetchDanmu"===t.command&&t.url)this.emit("requestController","create",{url:t.url,options:{contentType:"text"}},t=>{i(t),t||console.error(t)});else if("downloadDanmuXML"===t.command&&t.cid){const e=(window.URL?URL:window.webkitURL).createObjectURL(new Blob([t.danmuDocumentStr],{type:"application/xml"})),i=t.renamedFilename||`${t.filename?t.filename+".":""}${t.cid}.${t.date}.xml`;chrome.downloads.download({saveAs:!0,url:e,filename:i.replace(/\s/g,"").replace(/[|"*?:<>\s~/]/g,"_"),headers:[{name:"Content-Disposition",value:`attachment; filename="${i}"; filename*="utf-8' '${i}"`.replace("/","%2f")}]})}else if("downloadDanmuASS"===t.command&&t.cid){const e="\ufeff"+ct(t.danmuJSON.list,{title:t.filename,ori:t.origin}),i=(window.URL?URL:window.webkitURL).createObjectURL(new Blob([e],{type:"application/octet-stream"})),n=t.renamedFilename||`${t.filename?t.filename+".":""}${t.cid}.${t.date}.ass`;chrome.downloads.download({saveAs:!0,url:i,filename:n.replace(/\s/g,"").replace(/[|"*?:<>\s~/]/g,"_"),headers:[{name:"Content-Disposition",value:`attachment; filename="${n}"; filename*="utf-8' '${n}"`.replace("/","%2f")}]})}else if("pakkuGetHistoryDanmu"===t.command){const i=this.messageStore.createData(e.id),n=new j.a(t.url,"",!0);i.queue.push({command:"loadHistoryDanmu",cid:i.data.cid,date:n.query.date}),this.messageStore.dealWith(e.id)}return!0}),s()(this,"watcher",Object(x.webRequestCallbackWrapper)(t=>{const{tabId:e}=t,i=new j.a(t.url,"",!0),{pathname:n,query:s}=i;if(!s||!s.requestFrom)if("/x/v2/dm/web/view"===n){const t=this.messageStore.createData(e);t.data.cid=s.oid,t.queue.push({command:"loadNewTypeDanmu",oid:s.oid,pid:s.pid,type:s.type}),this.messageStore.dealWith(e)}else if("/x/v2/dm/web/seg.so"===n){const t=this.messageStore.createData(e);t.data.cid=s.oid,t.queue.push({command:"loadNewTypeDanmu",oid:s.oid,pid:s.pid,segmentIndex:s.segment_index}),this.messageStore.dealWith(e)}else if("/x/v2/dm/web/history/seg.so"===n){const t=this.messageStore.createData(e);t.data.cid=s.oid,t.queue.push({command:"loadNewTypeHistoryDanmu",oid:s.oid,date:s.date}),this.messageStore.dealWith(e)}else if("/x/player.so"===n||"/player"===n){const t=this.messageStore.createData(e);t.data.cid=s.id.slice(4),t.queue.push({command:"loadCurrentDanmu",cid:t.data.cid}),this.messageStore.dealWith(e)}else if("/x/v1/dm/list.so"===n){const t=this.messageStore.createData(e);t.data.cid=s.oid,t.queue.push({command:"loadCurrentDanmu",cid:t.data.cid}),this.messageStore.dealWith(e)}else if("/x/v2/dm/history"===n&&s.date){const t=this.messageStore.createData(e);t.queue.push({command:"loadHistoryDanmu",cid:t.data.cid,date:s.date}),this.messageStore.dealWith(e)}})),s()(this,"postReport",async(t,e,i)=>{const n=await this.updateCSRF(),{cid:s,dmid:o,reason:a,content:r}=t,c={cid:s,dmid:o,reason:a,content:r,csrf:n},l=new FormData;for(let t in c)l.append(t,c[t]);n?this.emit("requestController","create",{url:"https://api.bilibili.com/x/dm/report/add",options:{method:"post",contentType:"json",body:H()(l.entries()).map(([t,e])=>`${t}=${e}`).join("&"),headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"}}},()=>{i(!0)}):i(!1)}),s()(this,"updateCSRF",async()=>new M.a(t=>{this.emit("cookieController","get",{url:"http://www.bilibili.com",name:"bili_jct"},e=>{t(e)})}))}async onLaunch(){this.emit("webRequestController","create",{name:"videoDanmuWatcher",eventName:"onSendHeaders",filter:{urls:["*://api.bilibili.com/x/v2/dm/history?type=*","*://api.bilibili.com/x/v1/dm/list.so?oid=*","*://api.bilibili.com/x/player.so?id=cid:*","*://interface.bilibili.com/player?id=cid:*","*://api.bilibili.com/x/v2/dm/web/view?*","*://api.bilibili.com/x/v2/dm/web/seg.so?*","*://api.bilibili.com/x/v2/dm/web/history/seg.so*"]},options:["requestHeaders"],callback:this.watcher}),this.addListener("postReport",this.postReport),this.updateCSRF()}}const Ot=t=>{const[e=0,i=0]=String(t).split(".");let n=Math.trunc(e/3600),s=Math.trunc((e-3600*n)/60),o=Math.trunc((e-3600*n-60*s)%60),a=String(i).padEnd(3,"0");return`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")},${a}`},At=t=>{const{body:e,font_size:i,font_color:n,background_alpha:s,background_color:o,Stroke:a}=t;return e.map((t,e)=>`${e}\n${((t,e,i,n,s)=>{const{from:o,to:a,location:r,content:c}=s;return`${Ot(o)} --\x3e ${Ot(a)}\n<font color="${e}" size="${40*t}">${c}</font>\n `})(i,n,0,0,t)}`).join("\n\n")};function xt(t,e){var i=w()(t);if(b.a){var n=b()(t);e&&(n=n.filter((function(e){return m()(t,e).enumerable}))),i.push.apply(i,n)}return i}function Dt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?xt(Object(i),!0).forEach((function(e){s()(t,e,i[e])})):p.a?u()(t,p()(i)):xt(Object(i)).forEach((function(e){l()(t,e,m()(i,e))}))}return t}class It extends o.a{constructor(t,e){super(t,e,"videoSubtitleDownload",{dependencies:["webRequestController","requestController"],settings:{on:!0}}),s()(this,"messageStore",new R("videoSubtitleDownloadDOMInitialized")),s()(this,"subtitleWatcher",Object(x.webRequestCallbackWrapper)(t=>{const{tabId:e}=t,i=new j.a(t.url,"",!0),{pathname:n,query:s}=i;"/x/player/v2"===n&&this.getSubtitle(t.url).then(t=>{const i=this.messageStore.createData(e),{queue:n}=i;i.data.cid=s.cid,n.push({command:"loadSubtitle",subtitles:t.subtitles}),this.messageStore.dealWith(e)})})),s()(this,"getSubtitle",async(t,e)=>this.emit("requestController","create",{url:t,options:Dt(Dt({},e),{},{contentType:"json"})},t=>t&&0===t.code?t.data.subtitle:[])),s()(this,"downloadSubtitle",(t,e,i)=>{"srt"===t.type?this.downloadSRT(t,e,i):"json"===t.type&&this.downloadJSON(t,e,i)}),s()(this,"downloadSRT",(t,e,i)=>{const n=this.messageStore.createData(e.tab.id||e.id);if(n){const{filename:e,subtitleObject:s}=t,{lan:o,subtitle_url:a}=s,{cid:r}=n.data;this.getJSONSubtitle("https:"+a).then(t=>{const n=At(t),s=URL.createObjectURL(new Blob([n],{type:"text/srt"}));chrome.downloads.download({saveAs:!0,url:s,filename:e.replace(/[|"*?:<>\s~/]/g,"_"),headers:[{name:"Content-Disposition",value:`attachment; filename="${e}"; filename*="utf-8' '${e}"`.replace("/","%2f")}]}),i(!0)})}else i(!1)}),s()(this,"downloadJSON",(t,e,i)=>{const n=this.messageStore.createData(e.tab.id||e.id);if(n){const{filename:e,subtitleObject:s}=t,{lan:o,subtitle_url:a}=s,{cid:r}=n.data;chrome.downloads.download({saveAs:!0,url:"https:"+a,filename:e.replace(/[|"*?:<>\s~/]/g,"_"),headers:[{name:"Content-Disposition",value:`attachment; filename="${e}"; filename*="utf-8' '${e}"`.replace("/","%2f")}]}),i(!0)}else i(!1)}),s()(this,"getJSONSubtitle",t=>this.emit("requestController","create",{url:t,options:{contentType:"json"}}))}async onLaunch(){this.addListener("downloadSubtitle",this.downloadSubtitle),this.emit("webRequestController","create",{name:"videoSubtitleDownload",eventName:"onSendHeaders",filter:{urls:["*://api.bilibili.com/x/player/v2*"]},options:["requestHeaders"],callback:this.subtitleWatcher})}}class Tt extends o.a{constructor(t,e){super(t,e,"videoAutoQuality",{settings:{on:!1,quality:80}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}}class Pt extends o.a{constructor(t,e){super(t,e,"videoAutoPlaySpeed",{settings:{on:!0,speed:1}}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings)})})}}class Nt extends o.a{constructor(t,e){super(t,e,"autoLikeCoinCollect",{dependencies:["specialAttention"],settings:{on:!0,pushNotification:!0}}),s()(this,"hasLogin",!1),s()(this,"bilibiliAccount",void 0),s()(this,"featureConfigMap",new L.a),s()(this,"messageStore",new R("autoLikeCoinCollectDOMInitialized")),s()(this,"accountChanged",async({hasLogin:t,bhAccount:e,bilibiliAccount:i},n,s)=>{this.hasLogin=t,this.bhAccount=e,this.bilibiliAccount=i,s()}),s()(this,"setFeatureConfig",async(t,e,i)=>{const{uid:n,type:s,value:o,extraValue:a}=t;if(n){let t=this.featureConfigMap.get(n)||{};t[s]=o,o&&("coin"!==s||isNaN(a)?"collect"!==s||isNaN(a)||(t.collectionId=a):t.coinNumber=a>2?2:a),this.featureConfigMap.set(n,t),this.setStore("featureConfigMap",this.featureConfigMap),i(!0)}else i(!1)}),s()(this,"getFeatureConfig",async(t,e,i)=>{i(this.featureConfigMap)}),s()(this,"removeUserConfig",async(t,e,i)=>{const{uid:n}=t;this.featureConfigMap.has(n)?(this.featureConfigMap.delete(n),this.setStore("featureConfigMap",this.featureConfigMap),i(!0)):i(!1)}),s()(this,"fetchCollectionList",async(t,e,i)=>{this.emit("requestController","create",{url:"https://api.bilibili.com/x/v3/fav/folder/created/list-all?up_mid="+this.bilibiliAccount.uid,options:{contentType:"json"}},t=>{0===t.code&&i(t.data.list)})}),s()(this,"watcherCallback",Object(x.webRequestCallbackWrapper)(t=>{const{tabId:e}=t,i=new j.a(t.url,"",!0),{pathname:n,query:s}=i;if(s.passWrapper)return;if(s&&s.requestFrom)return;this.messageStore.createData(e).queue.push({command:"initAutoLikeCoinCollect",type:"init",data:s}),this.messageStore.dealWith(e)})),s()(this,"onAfterSetSettingsFromCloud",async()=>{const t=this.getStore("featureConfigMap");t&&(this.featureConfigMap=new L.a(t))}),s()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:o.a.simplifyConfig(this.settings),stores:{featureConfigMap:this.getStore("featureConfigMap")}})})}async onInitStore(){const t=this.getStore("featureConfigMap");void 0===t?(this.featureConfigMap=new L.a,this.setStore("featureConfigMap",[])):this.featureConfigMap=new L.a(t)}async onBeforeLaunch(){this.addListener("accountChanged",this.accountChanged),this.addListener("setFeatureConfig",this.setFeatureConfig),this.addListener("getFeatureConfig",this.getFeatureConfig),this.addListener("removeUserConfig",this.removeUserConfig),this.addListener("fetchCollectionList",this.fetchCollectionList),await this.emit("bilibiliHelperAccountController","getStatus",null,({hasLogin:t,bhAccount:e,bilibiliAccount:i})=>{this.hasLogin=t,this.bhAccount=e,this.bilibiliAccount=i})}async onLaunch(){this.emit("webRequestController","create",{name:"autoLikeCoinCollectVideoWatcher",eventName:"onBeforeSendHeaders",filter:{urls:["*://api.bilibili.com/x/web-interface/archive/relation?*"]},options:["requestHeaders"],callback:this.watcherCallback})}}i.d(e,"h",(function(){return a})),i.d(e,"f",(function(){return r})),i.d(e,"i",(function(){return T})),i.d(e,"e",(function(){return q})),i.d(e,"d",(function(){return _t})),i.d(e,"g",(function(){return It})),i.d(e,"c",(function(){return Tt})),i.d(e,"b",(function(){return Pt})),i.d(e,"a",(function(){return Nt}))},226:function(t,e){},237:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i(30),s=i.n(n),o=i(17),a=i.n(o),r=i(1),c=i.n(r),l=i(9);const h=[["normalWiden",["宽屏","t"]],["webWiden",["网页全屏","w"]],["fillWiden",["全屏","f"]],["mute",["静音","m"]],["danmuToggle",["弹幕开关","d"]],["mirrorToggle",["镜像开关","n"]],["pip",["画中画","p"]],["watchLater",["稍后再看","b"]],["previousFiveSeconds",["跳转到几秒前",","]],["nextFiveSeconds",["跳转到几秒后","."]],["resetPlaySpeed",["重置播放速度","x"]],["addPlaySpeed",["增加播放速度","Shift + ArrowUp"]],["minusPlaySpeed",["减小播放速度","Shift + ArrowDown"]],["previousFrame",["逐帧向前调整","Shift + ArrowLeft"]],["nextFrame",["逐帧向后调整","Shift + ArrowRight"]]];class u extends l.a{constructor(t,e){super(t,e,"videoShortcuts",{settings:{on:!0,playSpeedChangeRange:.25,playJumpChangeRange:5,useDefaultSpeedChangeRange:!1}}),c()(this,"states",{}),c()(this,"hasLogin",!1),c()(this,"bilibiliAccount",null),c()(this,"bhAccount",null),c()(this,"onBeforeLaunch",async()=>{this.addListener("accountChanged",({hasLogin:t,bilibiliAccount:e},i,n)=>{this.hasLogin=t,this.bilibiliAccount=e,this.settings.bilibiliAccount=this.bilibiliAccount,this.settings.bilibiliHelperAccountLogin=this.hasLogin,n instanceof Function&&n()}),this.addListener("getShortcuts",this.getShortcuts),this.addListener("setShortcut",this.setShortcut),await this.emit("bilibiliHelperAccountController","getStatus",null,({bhAccount:t,hasLogin:e,bilibiliAccount:i})=>{this.hasLogin=e,this.bhAccount=t,this.bilibiliAccount=i,this.settings.bhAccount=this.bhAccount,this.settings.bilibiliAccount=this.bilibiliAccount,this.settings.bilibiliHelperAccountLogin=this.hasLogin})}),c()(this,"getShortcuts",(t,e,i)=>{i(this.store)}),c()(this,"setShortcut",(t,e,i)=>{const{key:n,value:s}=t;if(this.store.has(n)){this.store.get(n)[1]=s,this.setStore("shortcuts",this.store)}i(!0)}),c()(this,"onAfterSetSettingsFromCloud",()=>{this.settings.bilibiliAccount=this.bilibiliAccount,this.settings.bilibiliHelperAccountLogin=this.hasLogin}),c()(this,"getSettingsForUpload",async(t,e,i)=>{const n=this.settings,{states:s,bhAccount:o,bilibiliAccount:r,bilibiliHelperAccountLogin:c}=n,h=a()(n,["states","bhAccount","bilibiliAccount","bilibiliHelperAccountLogin"]);i({settings:l.a.simplifyConfig(h),stores:{shortcuts:this.getStore("shortcuts")}})})}async onInitStore(){let t=this.getStore("shortcuts");t?(this.store=new s.a(h),t=t.filter(([t])=>!!h.find(([e])=>e===t)),t.forEach(([t,e])=>{this.store.set(t,e)}),this.setStore("shortcuts",this.store)):(this.store=new s.a(h),this.setStore("shortcuts",this.store))}async onLaunch(){}}},238:function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));var n=i(40),s=i.n(n),o=i(6),a=i.n(o),r=i(16),c=i.n(r),l=i(31),h=i.n(l),u=i(1),d=i.n(u),p=i(9),g=i(88);class m extends p.a{constructor(t,e){super(t,e,"specialAttention",{settings:{on:!0,toggle:!1},cache:{type:"local",dataType:"object",limit:{duration:6e4}}}),d()(this,"attentionList",new h.a),d()(this,"needRefresh",!1),d()(this,"hasLogin",!1),d()(this,"accountChanged",async({hasLogin:t,bilibiliAccount:e},i,n)=>{this.hasLogin=t,this.hasLogin||(this.attentionList=new h.a)}),d()(this,"setSpecialAttentionList",(t,e,i)=>{t.uidList&&t.uidList instanceof Array?(this.attentionList=new h.a(t.uidList),this.setStore("attentionList",c()(this.attentionList)),i(!0)):i(!1)}),d()(this,"getSpecialAttentionList",(t,e,i)=>{i(c()(this.attentionList))}),d()(this,"getSpecialAttentionAccountList",(t,e,i)=>{this.emit("bilibiliAccountController","getAccountList",{uidList:c()(this.attentionList)},i)}),d()(this,"addSpecialAttention",async(t,e,i)=>{if(t.uid){const{uid:e}=t;this.attentionList.has(e)?i(!1):(this.attentionList.add(e),this.setStore("attentionList",c()(this.attentionList)),await this.emit("bilibiliAccountController","create",{uid:e},t=>{this.needRefresh=!0,console.log(t),i(t)}))}else i(!1)}),d()(this,"removeSpecialAttention",(t,e,i)=>{t.uid?(this.attentionList.delete(t.uid),this.setStore("attentionList",c()(this.attentionList)),i(!0)):i(!1)}),d()(this,"fetchSpecialAccountVideoData",async(t,e,i)=>{if(t.uid){i(await this.getAccountVideos(t.uid,"publishDate",t.pn||1,t.ps||20))}else i(!1)}),d()(this,"fetchSpecialAccountLiveData",async(t,e,i)=>{t.uid?this.getAccountLiveStatus(t.uid).then(i):i(!1)}),d()(this,"getAccountVideos",(t,e="publishDate",i=1,n=25)=>new a.a(s=>{this.emit("requestController","create",{url:`https://api.bilibili.com/x/space/arc/search?mid=${t}&pn=${i}&ps=${n}&order=${e}`,options:{contentType:"json"}},s)}).then(({code:t,data:e})=>{if(0===t&&e.list){return{list:e.list.vlist.map(t=>({aid:t.aid,bvid:t.bvid,cover:t.pic.replace("http://","https://"),duration:t.length,title:t.title,owner:{name:t.author,mid:t.mid},isPay:t.is_pay,isInter:t.is_steins_gate,isCoop:t.is_union_video,publishTime:1e3*t.created,publishDateDesc:Object(g.b)(1e3*t.created),description:t.description,tid:t.typeid,isNew:s()()-1e3*t.created<864e5}))||[],page:e.page||!1}}return!1})),d()(this,"getAccountLiveStatus",t=>new a.a(e=>{this.emit("requestController","create",{url:"https://api.bilibili.com/x/space/acc/info?mid="+t,options:{contentType:"json"}},e)}).then(({code:t,data:e})=>!(0!==t||!e.live_room)&&(e.live_room||{}))),d()(this,"onAfterSetSettingsFromCloud",async()=>{const t=this.getStore("attentionList");t&&(this.attentionList=new h.a(t),this.emit("*","updateSpecialAttentionList",{list:c()(this.attentionList)}))}),d()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:p.a.simplifyConfig(this.settings,["on"]),stores:{attentionList:this.getStore("attentionList")}})})}async onInitStore(){const t=this.getStore("attentionList");void 0===t?(this.attentionList=new h.a,this.setStore("attentionList",[])):this.attentionList=new h.a(t)}async onBeforeLaunch(){this.addListener("setSpecialAttentionList",this.setSpecialAttentionList),this.addListener("getSpecialAttentionList",this.getSpecialAttentionList),this.addListener("getSpecialAttentionAccountList",this.getSpecialAttentionAccountList),this.addListener("addSpecialAttention",this.addSpecialAttention),this.addListener("removeSpecialAttention",this.removeSpecialAttention),this.addListener("fetchSpecialAccountVideoData",this.fetchSpecialAccountVideoData),this.addListener("fetchSpecialAccountLiveData",this.fetchSpecialAccountLiveData),this.addListener("accountChanged",this.accountChanged)}}},294:function(t){t.exports=["en","zh_CN","zh_TW"]},303:function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"TabController",(function(){return A})),i.d(n,"RequestController",(function(){return j})),i.d(n,"CookieController",(function(){return W})),i.d(n,"ClockController",(function(){return Q})),i.d(n,"NotificationController",(function(){return tt})),i.d(n,"WebRequestController",(function(){return it})),i.d(n,"DownloadController",(function(){return st})),i.d(n,"PermissionController",(function(){return rt})),i.d(n,"Network",(function(){return lt})),i.d(n,"GraphqlController",(function(){return Ct}));var s={};i.r(s),i.d(s,"BilibiliAccountController",(function(){return At})),i.d(s,"BilibiliHelperAccountController",(function(){return Ft}));var o={};i.r(o),i.d(o,"Emoji",(function(){return Rt})),i.d(o,"GoogleAnalytics",(function(){return Bt})),i.d(o,"ProxyForWebsite",(function(){return Vt})),i.d(o,"Language",(function(){return zt})),i.d(o,"Message",(function(){return Qt})),i.d(o,"States",(function(){return Kt})),i.d(o,"AD",(function(){return Xt}));var a=i(28),r=i.n(a),c=i(29),l=i.n(c),h=i(15),u=i.n(h),d=i(14),p=i.n(d),g=i(12),m=i.n(g),f=i(11),b=i.n(f),y=i(1),w=i.n(y),v=i(6),L=i.n(v),S=i(87);class C extends S.a{constructor(...t){super(...t),w()(this,"__itemType","controller"),w()(this,"tasks",[])}addTask(t,e){this.tasks.push({task:t,sendResponse:e})}async dealWithTaskList(t=!1){const e=await this.onBeforeDealWithTaskList();t?void 0!==e&&(await this.onDealWithTaskList(),await this.onAfterDealWithTaskList()):(await this.onDealWithTaskList(),await this.onAfterDealWithTaskList())}async onBeforeDealWithTaskList(){}async onDealWithTaskList(){}async onAfterDealWithTaskList(){}async dealWithTask(t){await this.onBeforeDealWithTask(t);const e=await this.onDealWithTask(t);return await this.onAfterDealWithTask(t),e}async onBeforeDealWithTask(t){}async onDealWithTask(t){}async onAfterDealWithTask(t){}}var k=i(30),_=i.n(k);class O{constructor(t){w()(this,"itemName",void 0),w()(this,"errorKeyMap",new _.a),w()(this,"errorCodeMap",new _.a),this.itemName=t}create(t,e=t,i=-(this.errorKeyMap.size+1)){const n={key:t,code:i,i18nKey:"error_"+e};if(this.errorKeyMap.has(t)||this.errorCodeMap.has(i))throw`exist error key or code: ${t}, ${i}`;return this.errorKeyMap.set(t,n),this.errorCodeMap.set(i,n),n}getByKey(t){return this.errorKeyMap.get(t)}getByCode(t){return this.errorCodeMap.get(t)}}new O("tabController").create("lackPermission");class A extends C{constructor(t,e){super(t,e,"tabController",{dependencies:["permissionController"],settings:{on:!0}}),w()(this,"hasPermission",!1),w()(this,"create",async(t,e,i)=>{if(this.hasPermission&&(t.url||t.queryURL)){let e,n,s,o,a,r,c,l;({url:e,redirect:n="",focus:s=!1,strict:o=!0,queryURL:a=t.url,queryPattern:r="*",windowType:c="normal",active:l=!0}=t||{}),void 0===e&&(e=a);let h=a;a&&!1===o&&(h=a+r),h=h.replace(/^https?/,"*"),s?chrome.tabs.create({url:n||e||a,active:l},()=>{i(!0)}):chrome.tabs.query({url:h,windowType:c,currentWindow:!0},t=>{if(t&&t.length>0){const s={active:l};n&&(s.url=n),void 0!==e&&t[0].url!==e&&(s.url=e),chrome.tabs.update(t[0].id,s,()=>{i(!0)})}else chrome.tabs.create({url:n||e||a,active:l},()=>{i(!0)})})}})}async onBeforeLaunch(){await this.emit("permissionController","containPermissions",["tabs"],async t=>{this.hasPermission=t}),this.addListener("permissionUpdated",t=>{const{command:e}=t;if("add"===e||"remove"===e){t.permissions.has("tabs")!==this.hasPermission&&(this.hasPermission=!this.hasPermission)}}),this.addListener("create",this.create)}}var x=i(66),D=i.n(x),I=i(16),T=i.n(I),P=i(58),N=i.n(P),E=i(155);class M{constructor(t,e={},i){w()(this,"abortTimer",0),w()(this,"abortController",new AbortController),this.url=t,this.options=e,this.sendResponse=i,e.signal=this.abortController.signal}get controlPassword(){return this.options.controlPassword}}class F{constructor(t,e,i,n,s,o){w()(this,"logger",new E.a("Request Queue")),w()(this,"list",[]),w()(this,"caughtMaxTimes",0),w()(this,"sleeping",!1),w()(this,"sleepTimer",0),w()(this,"suddenlyDuration",500),w()(this,"suddenlyTimer",0),w()(this,"suddenlyFetchCounter",0),w()(this,"locked",!1),w()(this,"pushTask",t=>!this.sleeping&&(this.suddenlyFetchCounter>=this.suddenlyQueueFetchMax&&(this.logger.log("Request Queue ~ Suddenly fetch counter: "+this.suddenlyFetchCounter),this.caughtMaxTimes+=1),this.suddenlyFetchCounter+=1,this.suddenlyTimer||(this.suddenlyTimer=setTimeout(()=>{this.suddenlyFetchCounter=0,this.suddenlyTimer=0},this.suddenlyDuration)),this.isSaturation&&(this.caughtMaxTimes+=1),this.needSleep?(this.sleepTimer||(this.sleeping=!0,this.logger.log("Request Queue ~ Go to sleep: "+this.url),this.sleepTimer=setTimeout(()=>{this.logger.log("Request Queue ~ Wake up: "+this.url),this.sleeping=!1,this.caughtMaxTimes=0,this.suddenlyFetchCounter=0},this.sleepDuration)),!1):(this.list.push(t),!0))),w()(this,"getTask",()=>this.list.shift()),this.url=t,this.queueMaxLength=e,this.fetchTimeout=i,this.maxCatchTimes=n,this.suddenlyQueueFetchMax=s,this.sleepDuration=o}get isSaturation(){return this.list.length>=this.queueMaxLength}get needSleep(){return this.caughtMaxTimes>=this.maxCatchTimes}}class j extends C{constructor(t,e){super(t,e,"requestController",{dependencies:["permissionController","networkController"],settings:{on:!0}}),w()(this,"queueMaxLength",3),w()(this,"suddenlyQueueFetchMax",10),w()(this,"fetchTimeout",3e4),w()(this,"maxCatchTimes",1),w()(this,"sleepTime",3e4),w()(this,"queues",new _.a),w()(this,"requestRegExp",new RegExp("requestFrom=$BILIBILI_HELPER_2.1.4")),w()(this,"clearQueueTimer",0),w()(this,"clearQueueDuration",3e4),w()(this,"fetchingList",new _.a),w()(this,"create",(t,e,i)=>{if(t.url){const e=new M(t.url,t.options,i);this.addTask(e)?this.dealWithTaskList(!0):i(!1)}else console.warn("error request params",t)}),w()(this,"createGraphQL",(t,e,i)=>this.emit("graphqlController","create",t,i)),w()(this,"cancel",(t,e,i)=>{if(t.controlPassword&&this.fetchingList.has(t.controlPassword)){this.fetchingList.get(t.controlPassword).abortController.abort(),i(!0)}else i(!0)}),w()(this,"onNetworkOnline",t=>{})}async onLaunch(){this.addListener("create",this.create),this.addListener("createGraphQL",this.createGraphQL),this.addListener("cancel",this.cancel),this.addListener("networkOnlineChange",this.onNetworkOnline)}addTask(t){if(this.queues.has(t.url)){return this.queues.get(t.url).pushTask(t)}{const e=new F(t.url,this.queueMaxLength,this.fetchTimeout,this.maxCatchTimes,this.suddenlyQueueFetchMax,this.sleepTime);return this.queues.set(t.url,e),e.pushTask(t)}}getTaskQueue(){const t=T()(this.queues.values()).filter(t=>t.list.length);if(t&&t.length>0)return t[0]}async onBeforeDealWithTaskList(){return this.queues.size>0}async onDealWithTaskList(){const t=this.getTaskQueue();if(t){const e=t.getTask();if(e){const t=await this.dealWithTask(e);await e.sendResponse(t)}clearTimeout(this.clearQueueTimer),this.clearQueueTimer=setTimeout(()=>{t&&0===t.list.length&&this.queues.delete(t.url)},this.clearQueueDuration)}}async onAfterDealWithTaskList(){this.getTaskQueue()&&await this.dealWithTaskList(!0)}async onBeforeDealWithTask(t){t.options||(t.options={}),t.abortController&&(t.abortTimer=setTimeout(()=>{t.abortController.abort()},this.fetchTimeout))}async onDealWithTask(t){return await this.fetch(t)}async onAfterDealWithTask(t){t.abortTimer&&clearTimeout(t.abortTimer)}async fetch(t){if(await this.onBeforeFetch(t)){const e=await this.onFetch(t);return await this.onAfterFetch(t,e)}}async onBeforeFetch(t){return!0}async onFetch(t){let{url:e,options:i}=t;const n=new Headers({From:"BILIBILI_HELPER_2.1.4"});i&&(i.headers instanceof Headers?T()(i.headers.entries()).forEach(([t,e])=>{n.append(t,e)}):N()(i.headers)&&T()(D()(i.headers)).forEach(([t,e])=>{n.append(t,e)})),i.headers=n;const s=new URL(e);this.requestRegExp.test(e)||(s.search&&"?"===s.search[0]?e+="&":e+="?",e+="requestFrom=BILIBILI_HELPER_2.1.4");const o=t.controlPassword;return o&&this.fetchingList.set(o,t),await fetch(decodeURIComponent(e),i).then(t=>(o&&this.fetchingList.delete(o),t)).catch(t=>{if(o&&this.fetchingList.delete(o),"The user aborted a request."===t.message)throw t})||!1}async onAfterFetch(t,e){let{options:i}=t;if(!e||!(i.contentType in e))return e;if(e.status>=400)return!1;switch(i.contentType.toLowerCase()){case"json":return await e.json();case"blob":return e.blob();case"text":return e.text();case"arraybuffer":return e.arrayBuffer();default:return e}}}var R=i(40),B=i.n(R);function q(t,e){var i=b()(t);if(m.a){var n=m()(t);e&&(n=n.filter((function(e){return p()(t,e).enumerable}))),i.push.apply(i,n)}return i}function U(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?q(Object(i),!0).forEach((function(e){w()(t,e,i[e])})):u.a?l()(t,u()(i)):q(Object(i)).forEach((function(e){r()(t,e,p()(i,e))}))}return t}class H{constructor(t,e,i,n,s){w()(this,"active",!1),w()(this,"runCallback",t=>{if(this.onBeforeRunCallback(t)&&this.active){const e=this.onRunCallBack(t);return this.onAfterCallback(e)}}),this.manager=t,this.name=e,this.data=i,this.callback=n,this.options=s}setDataMap(t){this.data=U(U({},this.data),t)}setData(t,e){this.data=U(U({},this.data),{},{[t]:e})}setCallback(t){this.callback=t}onBeforeRunCallback(...t){return!0}onRunCallBack(t){if(this.callback instanceof Function)return this.callback(t)}onAfterCallback(t){return t}async onBeforeLaunch(t){return t}async onLaunch(t){return t}async onAfterLaunch(t){return t}async launch(t){if(this.active)return!1;const e=await this.onBeforeLaunch(t),i=await this.onLaunch(e);return this.active=!0,await this.onAfterLaunch(i)}async onBeforePause(t){return t}async onPause(t){return t}async onAfterPause(t){return t}async pause(t){const e=await this.onBeforePause(t),i=await this.onPause(e);return this.active=!1,await this.onAfterPause(i)}async onBeforeClear(t){return t}async onClear(t){return t}async onAfterClear(t){return t}async clear(t){const e=await this.onBeforeClear(t),i=await this.onClear(e);return this.active=!1,await this.onAfterClear(i)}}class $ extends H{constructor(t,e,i,n,s){super(t,e,i,n,s)}onBeforeRunCallback({removed:t,cookie:e,cause:i}){if(this.data&&this.data.filter){const{name:i,domain:n}=e,s=!this.data.filter.removed||t,o=!this.data.filter.names||this.data.filter.names.includes(i),a=!this.data.filter.domain||this.data.filter.domain.match(n);return s&&o&&a&&this.active}return this.active}async onLaunch(){chrome.cookies.onChanged.addListener(this.runCallback)}async onPause(){this.active=!1}async onClear(){chrome.cookies.onChanged.removeListener(this.runCallback)}}class W extends C{constructor(t,e){super(t,e,"cookieController",{dependencies:["permissionController"],settings:{on:!0}}),w()(this,"hasPermission",!1),w()(this,"tasks",new _.a),w()(this,"onLaunch",async()=>{}),w()(this,"create",async(t,e,i)=>{const{name:n,data:s,callback:o,options:a}=t;if(n){const t=new $(this,n,s,o,a);this.tasks.set(n,t),await t.launch(),i(!0)}else i(!1)}),w()(this,"clear",async(t,e,i)=>{const{name:n}=t,s=this.tasks.get(n);s&&await s.clear(),i(!0)})}async onBeforeLaunch(){await this.emit("permissionController","containPermissions",["cookies"],async t=>{this.hasPermission=t}),this.addListener("permissionUpdated",t=>{const{command:e}=t;if("add"===e||"remove"===e){t.permissions.has("cookies")!==this.hasPermission&&(this.hasPermission=!this.hasPermission)}}),this.addListener("get",(t,e,i)=>{const{url:n,name:s}=t;this.getLocalCookie(n,s).then(t=>i(t))}),this.addListener("create",this.create),this.addListener("clear",this.clear),this.addListener("getLocalUId",(t,e,i)=>{this.hasPermission?this.getLocalUserId().then(i):i(!1)})}async getLocalUserId(){return this.getLocalCookie("https://www.bilibili.com/","DedeUserID")}async getLocalCookie(t,e){return new L.a(i=>{chrome.cookies.get({url:t,name:e},t=>{t&&1e3*t.expirationDate>B()()?i(t.value):i(!1)})})}}const V=new O("clockController"),z={LACK_OF_PERMISSION:V.create("lackPermission"),CREATE_FOCUS_FAILED:V.create("createFocusFailed")};class G extends H{constructor(t,e,i,n,s){super(t,e,i,n,s)}async onBeforeLaunch(){return new L.a(t=>{chrome.alarms.get(this.name,async e=>{if(e){const e=await this.clear();t(!e)}else t(!1)})})}async onLaunch(t){this.manager.logger.log("create clock",this.name,this.data),chrome.alarms.create(this.name,this.data)}async onPause(){await this.clear()}async onClear(){return new L.a(t=>{chrome.alarms.clear(this.name,e=>{this.manager.logger.log("clear clock",this.name,this.data),e&&(this.active=!1),t(e)})})}}class Q extends C{constructor(t,e){super(t,e,"clockController",{dependencies:["permissionController"],settings:{on:!0}}),w()(this,"hasPermission",!1),w()(this,"tasks",new _.a),w()(this,"create",async(t,e,i)=>{if(!this.hasPermission)return i(z.LACK_OF_PERMISSION);const{name:n,alarmInfo:s,tags:o=[],focus:a=!1,callback:r}=t,c=this.tasks.has(n)?this.tasks.get(n):null;if(c)if(c.active){if(a)return this.__clear(n).then(t=>{if(t){const t=new G(this,n,s,r,{tags:o});t.launch(),this.tasks.set(n,t)}i(t)}).catch(()=>{console.warn(z.CREATE_FOCUS_FAILED),i(z.CREATE_FOCUS_FAILED)});i(!1)}else console.log("exist clock task",c),c.setDataMap(s),c.setCallback(s),c.launch(),i(!0);else{const t=new G(this,n,s,r,{tags:o});t.launch(),this.tasks.set(n,t),i(!0)}}),w()(this,"query",async(t,e,i)=>{const{name:n,tags:s}=t,o=[];if(this.tasks.has(n)&&o.push(this.tasks.get(n)),s&&s.length>0){const t=T()(this.tasks.values()).filter(t=>{if(t.tags&&t.tags.length>0)return s.filter(e=>t.tags.includes(e)).length>0});o.push(...t)}o.length>0?i(o):i(!1)}),w()(this,"clear",async(t,e,i)=>this.__clear(t.name).then(t=>{i(t)})),w()(this,"pause",async(t,e,i)=>{const{filterTags:n=[],name:s}=t;s||n&&n.length>0?await this.query({name:s,tags:n},e,t=>{t&&t.length>0&&t.forEach(t=>t.pause()),i(!0)}):i(!1)}),w()(this,"relaunch",async(t,e,i)=>{if(!this.hasPermission)return i(z.LACK_OF_PERMISSION);let n=t.tags||[],s=t.name;n.length>0?await this.query({name:s,tags:n},e,t=>{t&&t.length>0&&t.forEach(t=>t.launch()),i(!0)}):(T()(this.tasks.values()).forEach(t=>{t.launch()}),i(!0))}),w()(this,"onAlarmCallback",t=>{const e=this.tasks.get(t.name);e&&e.active&&(this.logger.log(`clock controller's clock: ${t.name} is activated`,t),e.runCallback())}),w()(this,"__clear",async t=>{if(this.tasks.has(t)){const e=this.tasks.get(t);return this.tasks.delete(t),e.clear()}return!0})}async onBeforeLaunch(){await this.emit("permissionController","containPermissions",["alarms"],async t=>{this.hasPermission=t}),this.addListener("permissionUpdated",t=>{const{command:e}=t;if("add"===e||"remove"===e){t.permissions.has("alarms")!==this.hasPermission&&(this.hasPermission=!this.hasPermission)}}),this.addListener("create",this.create),this.addListener("query",this.query),this.addListener("clear",this.clear),this.addListener("pause",this.pause),this.addListener("relaunch",this.relaunch)}async onLaunch(){chrome.alarms.onAlarm.addListener(this.onAlarmCallback)}}var J=i(17),Y=i.n(J),K=i(47);const X=new O("notificationController"),Z={LACK_OF_PERMISSION:X.create("lackPermission"),SERVICE_WORKER_NOT_SUPPORT:X.create("swNotSupport"),SERVICE_WORKER_NOT_WORKING:X.create("swNotWorking")};class tt extends C{constructor(t,e){super(t,e,"notificationController",{dependencies:["permissionController"],settings:{on:!0,useActions:!1,autoClose:!1}}),w()(this,"currentList",[]),w()(this,"swOn",!1),w()(this,"onLaunch",async()=>{chrome.notifications.onButtonClicked.addListener((t,e)=>{this.currentList[t]&&0===e&&this.emit("tabController","create",{url:this.currentList[t],focus:!1},()=>{chrome.notifications.clear(t),delete this.currentList[t]})})}),w()(this,"postByNative",(t,e,i)=>{if(!this.swOn)return console.warn("service worker is not working"),i(Z.SERVICE_WORKER_NOT_WORKING);const{title:n,dir:s="auto",lang:o,badge:a,body:r,tag:c,icon:l,image:h,data:u={},vibrate:d,renotify:p=!1,requireInteraction:g=!1,actions:m,silent:f=!1,autoCloseInterval:b=0}=t;if(navigator.serviceWorker.controller){const t={type:"notification",title:n,dir:s,lang:o,badge:a,body:r,tag:c,icon:l,image:h,data:u,vibrate:d,renotify:p,requireInteraction:g,actions:m,silent:f,autoCloseInterval:b};u.useActions=this.settings.useActions,u.autoClose=this.settings.autoClose,navigator.serviceWorker.controller.postMessage(t),i(!0)}else console.warn("navigator.serviceWorker.controller is null"),i(!1)}),w()(this,"postByWeb",(t,e)=>{e.data=t;const i=new Notification(e.title,e);t.url&&(i.onclick=e=>{e.preventDefault(),this.emit("tabController","create",{url:t.url,strict:!1}),i.close(),this.emit("googleAnalytics","send",{event:"send",hitType:"event",category:"notification_by_web_api",action:"open_notification"})}),t.autoClose&&e.autoCloseInterval&&setTimeout(()=>{i.close()},e.autoCloseInterval)}),w()(this,"postByChrome",(t,e,i)=>{const{title:n,dir:s="auto",lang:o,badge:a,body:r,tag:c,icon:l,image:h,data:u={},vibrate:d,renotify:p=!1,requireInteraction:g=!1,actions:m,silent:f=!1,autoCloseInterval:b=0}=t,y={type:"notification",title:n,dir:s,lang:o,badge:a,body:r,tag:c,icon:l,image:h,data:u,vibrate:d,renotify:p,requireInteraction:g,actions:m,silent:f,autoCloseInterval:b},w=u.url?[{title:"查看"}]:null,v="bilibili-helper-dynamic-check"+Math.random();Object(K.a)(v,{type:"basic",iconUrl:y.picture||chrome.runtime.getURL("/statics/images/bilibili-cat-256.png"),title:"哔哩哔哩助手提醒您",message:y.title,buttons:w},t=>{w&&(this.currentList[t]=u.url),u.autoClose&&y.autoCloseInterval&&setTimeout(()=>{chrome.notifications.clear(t)},y.autoCloseInterval)})}),w()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:C.simplifyConfig(this.settings)})})}async onBeforeLaunch(){await this.emit("permissionController","containPermissions",["notifications"],async t=>{this.hasPermission=t}),this.addListener("permissionUpdated",t=>{const{command:e}=t;if("add"===e||"remove"===e){t.permissions.has("notifications")!==this.hasPermission&&(this.hasPermission=!this.hasPermission)}}),"serviceWorker"in navigator&&navigator.serviceWorker&&navigator.serviceWorker.register("../notification.sw.js",{scope:"/"}).then(()=>{this.swOn=!0}).then(()=>{navigator.serviceWorker.addEventListener("message",t=>{const{data:e={}}=t,{target:i,event:n}=e,s=Y()(e,["target","event"]);"tabController"===i?this.emit(i,n,{queryURL:s.url,strict:!1}):this.emit(i,n,s)})}),this.addListener("post",this.postByNative)}async onAfterSetSetting(t,e){}}class et extends H{constructor(t,e,i,n,s){super(t,e,i,n,s),w()(this,"active",!1),w()(this,"onLaunch",async()=>{const{eventName:t,filter:e,options:i}=this.data,n=i.findIndex(t=>"extraHeaders"===t);-1!==navigator.userAgent.indexOf("Chrome/")&&navigator.userAgent.split("Chrome/")[1].substr(0,2)>72?-1===n&&i.push("extraHeaders"):n>=0&&i.splice(n,1),this.manager.logger.log("create web request task",this.name,t,e,i),chrome.webRequest[t].addListener(this.runCallback,e,i)}),w()(this,"onPause",async()=>{await this.clear()});const{eventName:o,filter:a,options:r}=this.data;if(!(o in chrome.webRequest))throw"error event name "+o;if(!a||!r||!s)throw"error params in webRequest task: "+e}async onClear(t){const{eventName:e,filter:i,options:n}=this.data;this.manager.logger.log("clear web request task",this.name,e,i,n),chrome.webRequest[e].removeListener(this.runCallback)}}class it extends C{constructor(t,e){super(t,e,"webRequestController",{dependencies:["permissionController","networkController"],settings:{on:!0}}),w()(this,"hasPermission",!1),w()(this,"tasks",new _.a),w()(this,"onLaunch",async()=>{this.addListener("create",this.create),this.addListener("clear",this.clear)}),w()(this,"create",(t,e,i)=>{const{name:n,tags:s=[],eventName:o,filter:a,options:r,callback:c}=t,l=this.tasks.has(n)?this.tasks.get(n):null;if(l)this.logger.warn("exist webRequest task",l,t),l.active?i instanceof Function&&i(!1):(l.setDataMap({filter:a,options:r}),l.setCallback(c),l.launch(),i instanceof Function&&i(!0));else{const t=new et(this,n,{eventName:o,filter:a,options:r},c,{tags:s});t.launch(),this.tasks.set(n,t),i instanceof Function&&i(!0)}}),w()(this,"clear",async(t,e,i)=>{const{name:n}=t;return this.__clear(n).then(t=>{i(t)})}),w()(this,"__clear",async t=>{if(this.tasks.has(t)){const e=this.tasks.get(t);return this.tasks.delete(t),e.clear()}return!0})}async onBeforeLaunch(){await this.emit("permissionController","containPermissions",["webRequest"],async t=>{this.hasPermission=t}),this.addListener("permissionUpdated",t=>{const{command:e}=t;if("add"===e||"remove"===e){t.permissions.has("webRequest")!==this.hasPermission&&(this.hasPermission=!this.hasPermission)}})}}class nt extends H{constructor(t,e,i,n,s){super(t,e,i,n,s),w()(this,"downloadItemId",void 0),w()(this,"onLaunch",async()=>{chrome.downloads.download(this.data,t=>{this.downloadItemId=t,this.callback instanceof Function&&this.callback(t)})}),w()(this,"cancel",async()=>{chrome.downloads.cancel(this.downloadItemId,this.cancelCallback)}),this.cancelCallback=i.cancelCallback}}class st extends C{constructor(t,e){super(t,e,"downloadController",{dependencies:["permissionController"],settings:{on:!0}}),w()(this,"hasPermission",!1),w()(this,"tasks",new _.a),w()(this,"onLaunch",async()=>{chrome.downloads.onCreated.addListener(t=>{console.log(t)}),chrome.downloads.onChanged.addListener(t=>{console.log(t)})}),w()(this,"create",(t,e,i)=>{const{name:n,data:s,callback:o}=t;if(!this.tasks.get(n)){const t=new nt(this,n,s,o);this.tasks.set(n,t),i(!0),t.launch().then(()=>{this.tasks.delete(n)})}}),w()(this,"clear",async(t,e,i)=>{const{name:n}=t;return this.__clear(n).then(t=>{i(t)})}),w()(this,"__clear",async t=>{if(this.tasks.has(t)){const e=this.tasks.get(t);return this.tasks.delete(t),e.clear()}return!0})}async onBeforeLaunch(){await this.emit("permissionController","containPermissions",["downloads"],async t=>{this.hasPermission=t}),this.addListener("permissionUpdated",t=>{const{command:e}=t;if("add"===e||"remove"===e){t.permissions.has("downloads")!==this.hasPermission&&(this.hasPermission=!this.hasPermission)}}),this.addListener("create",this.create),this.addListener("clear",this.clear)}}var ot=i(31),at=i.n(ot);new O("permissionController").create("lackPermission");class rt extends C{constructor(t,e){super(t,e,"permissionController",{settings:{on:!0}}),w()(this,"initPermissions",new at.a),w()(this,"origins",new at.a),w()(this,"permissions",new at.a),w()(this,"lackOrigins",new at.a),w()(this,"lackPermissions",new at.a),w()(this,"onPermissionsChange",(t,{origins:e,permissions:i})=>{"remove"===t?(e.forEach(t=>{this.lackOrigins.add(t),this.origins.delete(t)}),i.forEach(t=>{this.lackPermissions.add(t),this.permissions.delete(t)})):(e.forEach(t=>{this.lackOrigins.delete(t),this.origins.add(t)}),i.forEach(t=>{this.lackPermissions.delete(t),this.permissions.add(t)})),this.emit("*","permissionUpdated",{command:t,permissions:this.permissions,origins:this.origins})}),w()(this,"contains",async(t,e)=>new L.a(i=>{chrome.permissions.contains({origins:t,permissions:e},t=>{i(t)})})),w()(this,"request",async(t,e)=>new L.a(i=>{chrome.permissions.request({origins:t,permissions:e},t=>{i(t)})})),w()(this,"remove",async(t,e)=>new L.a(i=>{chrome.permissions.remove({origins:t,permissions:e},t=>{i(t)})})),this.store=this.getStore("list-of-missing-permissions"),this.store||(this.setStore("list-of-missing-permissions",[]),this.store=[])}async onBeforeLaunch(){this.addListener("containOrigins",(t,e,i)=>{this.contains(t,null).then(i)}),this.addListener("containPermissions",(t,e,i)=>{this.contains(null,t).then(i)}),this.addListener("contains",({origins:t,permissions:e},i,n)=>{this.contains(t,e).then(n)}),this.addListener("request",({origins:t,permissions:e},i,n)=>{this.request(t,e).then(n)}),this.addListener("remove",({origins:t,permissions:e},i,n)=>{this.remove(t,e).then(n)}),chrome.permissions.onAdded.addListener(({origins:t,permissions:e})=>{this.onPermissionsChange("add",{origins:t,permissions:e})}),chrome.permissions.onRemoved.addListener(({origins:t,permissions:e})=>{this.onPermissionsChange("remove",{origins:t,permissions:e})})}async onLaunch(){await this.initOwnPermission(),await this.updateCurrentPermissions()}async initOwnPermission(){const{permissions:t}=chrome.runtime.getManifest();t.forEach(t=>{/^\*/.test(t)||this.initPermissions.add(t)})}async updateCurrentPermissions(){return new L.a(t=>{chrome.permissions.getAll(({origins:e,permissions:i})=>{e.forEach(t=>this.origins.add(t)),i.forEach(t=>this.permissions.add(t)),t(!0)})})}}var ct=i(7);class lt extends C{constructor(t,e){super(t,e,"networkController",{settings:{on:!0}}),w()(this,"online",navigator.onLine),w()(this,"onlineCallback",async()=>{this.online=navigator.onLine,await this.emit("*","networkOnlineChange",!0)}),w()(this,"offlineCallback",async()=>{this.online=navigator.onLine,await this.emit("*","networkOnlineChange",!1)})}async onBeforeLaunch(){this.addListener("getOnline",(t,e,i)=>i(this.online)),window.addEventListener("online",this.onlineCallback),window.addEventListener("offline",this.offlineCallback)}async onLaunch(){}}var ht=i(71),ut=i.n(ht),dt=i(18),pt=i.n(dt);function gt(t,e){var i=b()(t);if(m.a){var n=m()(t);e&&(n=n.filter((function(e){return p()(t,e).enumerable}))),i.push.apply(i,n)}return i}class mt{constructor(t,e){this.message=t,pt()(this,e)}toJSON(){return function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?gt(Object(i),!0).forEach((function(e){w()(t,e,i[e])})):u.a?l()(t,u()(i)):gt(Object(i)).forEach((function(e){r()(t,e,p()(i,e))}))}return t}({},this)}}class ft{constructor(t){this.moduleName=t,ft.map[t]={}}create(t,e,i){const n=new mt(i);return n.module=this.moduleName,n.type=t,n.code=e,ft.map[this.moduleName][t]=n,n}}w()(ft,"map",{});new ft("AD"),new ft("APP");const bt=new ft("BILIBILI_ACCOUNT");bt.create("ID_NOT_BINDED",-1,"未注册"),bt.create("ID_BINDED",-2,"已注册"),bt.create("BIND_ERROR",-4,"注册错误"),bt.create("COOKIE_ERROR",-5,"Cookie错误"),bt.create("REBIND_ERROR",-6,"重新注册失败"),bt.create("UNBIND_ERROR",-7,"解绑失败"),bt.create("ID_COOLIE_ARE_MISMATCH",-8,"UID与Cookie不匹配"),bt.create("NEED_SIGNOUT",-9,"未登出"),bt.create("NEED_SIGNIN",-10,"未登录"),bt.create("NEED_REBIND",-11,"需要重新绑定"),bt.create("LOGIN_ERROR",-12,"登录失败"),bt.create("WRONG_PASSWORD",-13,"密码错误"),bt.create("NEED_FILL_PASSWORD",-14,"需要补充密码");const yt=new ft("BILIBILI_HELPER_ACCOUNT");yt.create("ID_NOT_BOUND",-1,"未注册"),yt.create("ID_BOUND",-2,"已注册"),yt.create("BIND_ERROR",-4,"注册错误"),yt.create("COOKIE_ERROR",-5,"Cookie错误"),yt.create("REBIND_ERROR",-6,"重绑错误"),yt.create("UNBIND_ERROR",-7,"解绑错误"),yt.create("ID_COOLIE_ARE_MISMATCH",-8,"UID与Cookie不匹配"),yt.create("NEED_SIGNOUT",-9,"未登出"),yt.create("NEED_SIGNIN",-10,"未登录"),yt.create("NEED_REBIND",-11,"需重绑"),yt.create("LOGIN_ERROR",-12,"登录失败"),yt.create("WRONG_PASSWORD",-13,"密码错误"),yt.create("NO_ACCESS",-14,"无权限"),yt.create("NO_ACCESS_TO_RESET_PASSWORD",-15,"无权重置密码"),yt.create("REPEAT_EMAIL",-16,"该E-mail已被使用"),yt.create("NO_EMAIL",-17,"未设置E-mail"),yt.create("UNCHECKED_EMAIL",-18,"已设置E-mail未校验"),yt.create("HAS_BOUND_EMAIL",-19,"该账号已经绑定过E-mail"),yt.create("EMAIL_CHECK_FAILED",-20,"E-mail校验失败"),yt.create("SAVE_REDEEM_FAILED",-21,"保存兑换码失败"),yt.create("USE_REDEEM_FAILED",-22,"使用兑换码失败"),yt.create("NO_REDEEM",-23,"没有可以使用的序列号"),yt.create("INVALID_PRODUCT_NAME",-24,"错误的产品码");new ft("BILIBILI_HELPER_SETTING").create("INVALID_VALUE",-1,"非法的值");const wt=new ft("ACCOUNT");wt.create("INVALID_EMAIL",-1,"非法的 e-mail"),wt.create("INVALID_CAPTCHA",-2,"非法的验证码"),wt.create("WRONG_CAPTCHA",-3,"错误的验证码"),wt.create("NO_CAPTCHA",-4,"不存在验证码"),wt.create("NO_ACCESS",-5,"没有权限"),wt.create("INVALID_VALUE",-6,"非法的值");const vt=new ft("IDENTITY");vt.create("CHECK_FAILED",-1,"身份校验错误"),vt.create("IDENTITY_ADDED",-2,"身份已被添加");new ft("INTERNET").create("ENOTFOUND",-1,"ENOTFOUND");const Lt=new ft("JWT");Lt.create("NONE_JWT",-1,"需要JWT用于检查"),Lt.create("INVALID_JWT",-2,"非法的的JWT");new ft("MESSAGE");const St=new ft("REDEEM");St.create("REDEEM_CODE_HAS_EXISTED",-1,"重复生成兑换码"),St.create("REDEEM_CODE_HAS_USED",-2,"兑换码以被使用"),St.create("REDEEM_CODE_CREATE_FAILED",-3,"兑换码生成失败"),St.create("INVALID_REDEEM",-4,"无效的兑换码"),St.create("INACTIVE_REDEEM",-5,"不可用的兑换码");class Ct extends C{constructor(t,e){super(t,e,"graphqlController",{dependencies:["requestController"],settings:{on:!0}}),w()(this,"create",(t,e,i)=>{t.url="https://bilibilihelper.com/g",t.options||(t.options={query:null,variables:null}),t.options.query,t.options.graphql=!0;const n=new Headers;return t.options.headers instanceof Headers?T()(t.options.headers.entries()).forEach(([t,e])=>{n.append(t,e)}):N()(t.options.headers)&&D()(t.options.headers).forEach(([t,e])=>{n.append(t,e)}),n.append("Content-Type","application/json"),t.options.headers=n,t.options.method="POST",t.options.contentType="json",t.options.body=ut()({query:t.options.query.replace(/\s{2,}/g," "),variables:t.options.variables}),this.emit("requestController","create",t,async t=>{const{errors:e,data:n}=t;let s=null;e&&(s=this.dealWithErrors(e)),i({data:n,errors:s})})}),w()(this,"dealWithErrors",t=>{try{return t.map(t=>{if(!ft.map[t.module])throw"no module names "+t.module;if(!ft.map[t.module][t.type])throw`no type ${t.module} in module ${t.module}`;return ft.map[t.module][t.type]})}catch(t){console.error(t)}})}async onLaunch(){this.addListener("create",this.create)}}var kt=i(86),_t=i.n(kt);class Ot extends S.a{constructor(t,e,i,{userName:n="",face:s="",sign:o="",sex:a="保密",isSpecialAttention:r=!1,vip:c=null}={userName:"",face:"",sign:"",sex:"保密",isSpecialAttention:!1,vip:null}){super(t,e,"bilibiliAccount_"+i,{dependencies:["bilibiliAccountController"],settings:{on:!0},cache:{limit:{duration:864e5}}}),w()(this,"__initing",!1),w()(this,"initialized",!1),w()(this,"hasLogin",!1),w()(this,"hasLocalData",!1),w()(this,"isLocal",!1),w()(this,"isSpecialAttention",!1),w()(this,"uid",void 0),w()(this,"userName",void 0),w()(this,"sex",void 0),w()(this,"sign",void 0),w()(this,"face",void 0),w()(this,"level",void 0),w()(this,"roomId",void 0),w()(this,"emailVerified",void 0),w()(this,"mobileVerified",void 0),w()(this,"specialAttentionUidList",[]),w()(this,"videos",[]),w()(this,"vip",void 0),w()(this,"saveAccountData",()=>{this.setStore("default",this)}),w()(this,"getSpaceInfo",t=>new L.a(e=>{this.emit("requestController","create",{url:"https://api.bilibili.com/x/space/acc/info?mid="+t,options:{contentType:"json"}},e)}).then(({code:t,message:e,data:i})=>{if(0===t){const{mid:t,name:e,sex:n,face:s,sign:o,level:a,live_room:r,vip:c}=i;return{uid:t,name:e,sex:n,face:s,sign:o,level:a,vip:c,roomId:r?+r.roomid:void 0}}return L.a.reject(e)})),w()(this,"checkLogin",async()=>{const t=await this.getSESSIONDATA(),e=await this.getLocalUID();t&&+e===this.uid?(this.isLocal=!0,this.hasLogin=!0):(this.isLocal=!1,this.hasLogin=!1)}),w()(this,"getLocalUID",async()=>new L.a(t=>{this.emit("cookieController","get",{name:"DedeUserID",url:"https://www.bilibili.com/"},e=>{e?t(e):t()})})),w()(this,"getSESSIONDATA",()=>new L.a(t=>{this.emit("cookieController","get",{name:"SESSDATA",url:"https://www.bilibili.com/"},e=>{e?t(e):t()})})),this.uid=i,this.userName=n,this.face=s,this.sign=o,this.sex=a,this.vip=c,this.isSpecialAttention=r;const l=this.getStore("default");l&&(pt()(this,l),this.hasLocalData=!0)}async initAccountData(t=!1){if(!this.__initing||t)return this.__initing=!0,await this.getSpaceInfo(this.uid).then(t=>{pt()(this,t)}).catch(t=>{console.error(t)}),await this.checkLogin(),this.saveAccountData(),this.initialized=!0,this}updateInfoDetails(){}toJSON(){const{uid:t,name:e,face:i,sign:n,sex:s,level:o,isLocal:a,hasLogin:r,vip:c}=this;return{uid:t,name:e,face:i,sign:n,sex:s,level:o,isLocal:a,hasLogin:r,vip:c}}}class At extends C{constructor(t,e){super(t,e,"bilibiliAccountController",{settings:{on:!0}}),w()(this,"accountBus",new _.a),w()(this,"isLocalBilibiliAccountLogin",!1),w()(this,"onLaunch",async()=>{await this.initLocalAccount()}),w()(this,"getLocalAccountLoginState",(t,e,i)=>{i(!!this.localAccount&&this.localAccount.hasLogin)}),w()(this,"create",async(t,e,i)=>{if(t.uid){const{uid:e}=t,n=this.store.get(e);if(n)return await n.initAccountData(!0),i(n);{const t=new Ot(this,this.accountBus,e);return await t.initAccountData(!0),this.store.set(e,t),this.setStore("uidList",T()(this.store.keys())),i(t)}}i(!1)}),w()(this,"getLocalAccount",(t,e,i)=>{i(this.localAccount)}),w()(this,"getAccount",(t,e,i)=>{this.store.has(t.uid)?i(this.store.get(t.uid)):i(!1)}),w()(this,"getAccountList",(t,e,i)=>{t.uidList?L.a.all(t.uidList.map(async t=>{const e=this.store.get(t);return e||await this.create({uid:t},this,t=>t)})).then(t=>{i(t)}).catch(()=>{i([])}):i(!1)}),w()(this,"updateAccount",(t,e,i)=>{this.store.get(t.uid)&&t.videos}),w()(this,"initNewAccount",t=>{}),w()(this,"updateBaseInfo",t=>{}),w()(this,"initLocalAccount",async()=>new L.a(t=>{this.emit("cookieController","get",{name:"DedeUserID",url:"https://www.bilibili.com/"},e=>{e?t(e):t()})}).then(t=>new L.a(e=>this.create({uid:t},null,e)))),w()(this,"getLocalUID",(t,e,i)=>{i(this.localAccount?this.localAccount.uid:void 0)}),w()(this,"localBilibiliAccountLoginChange",async({removed:t,cookie:e,cause:i})=>{const{name:n}=e;"explicit"!==i||t||"SESSDATA"!==n?t&&"SESSDATA"===n&&(this.localAccount&&await this.localAccount.initAccountData(!0),await this.emit("*","localBilibiliAccountLoginStateChange",{login:!1})):(await this.initLocalAccount(),await this.emit("*","localBilibiliAccountLoginStateChange",{login:e.expirationDate>B()()/1e3}))})}get localAccount(){return T()(this.store.values()).find(t=>t.isLocal)}async onInitStore(){const t=this.getStore("uidList");this.store=t?new _.a(t.map(t=>{const e=new Ot(this,this.accountBus,t);return e.checkLogin(),[t,e]})):new _.a}async onBeforeLaunch(){await this.emit("cookieController","create",{name:"watchLocalBilibiliAccountLoginState",data:{filter:{names:["SESSDATA"],domain:".bilibili.com"}},callback:_t()(this.localBilibiliAccountLoginChange,50)}),this.addListener("create",this.create),this.addListener("getAccount",this.getAccount),this.addListener("getLocalAccount",this.getLocalAccount),this.addListener("getAccountList",this.getAccountList),this.addListener("getLocalUID",this.getLocalUID),this.addListener("getLocalAccountLoginState",this.getLocalAccountLoginState)}}var xt=i(46),Dt=i.n(xt),It=i(34),Tt=i.n(It),Pt=i(147),Nt=i.n(Pt),Et=i(62);const Mt=new O("bilibiliHelperAccountController");Mt.create("notLogin"),Mt.create("loginFailed"),Mt.create("getStatusFailed");class Ft extends C{constructor(t,e){super(t,e,"bilibiliHelperAccountController",{dependencies:["bilibiliAccountController"],settings:{on:!0},cache:{type:"local",dataType:"boolean",delayDuration:0}}),w()(this,"hasLogin",!1),w()(this,"hasRegister",!1),w()(this,"bilibiliAccount",null),w()(this,"needFillPassword",!1),w()(this,"uploadSettingsDuration",1e3),w()(this,"downloadSettingsDuration",2e3),w()(this,"downloadingSettings",!1),w()(this,"needDownloadSettings",!1),w()(this,"settingsNeedUpload",{}),w()(this,"accountDataInitialized",!1),w()(this,"onNetworkOnline",async t=>{t&&await this.getBHAccountState().then(this.initLocalBilibiliAccount)}),w()(this,"onLaunch",async()=>{await this.getBHAccountState().then(this.initLocalBilibiliAccount),await this.emit("app","setInitialStatus",{name:"bilibiliHelperAccount",value:!0})}),w()(this,"login",async(t,e,i)=>{const{uid:n,password:s}=t;if(!n||!s)return;const o={query:"mutation ($blid: BLID!, $password: String) {\n                        bilibiliHelperAccount {\n                            login(blid: $blid, password: $password) {\n                                bhid\n                                bhName\n                                email\n                                identities {\n                                    name\n                                    from\n                                    to\n                                    hasDateTimeLimit\n                                }\n                            }\n                        }\n                    }\n                    ",variables:{blid:n,password:t.password}};await this.emit("requestController","createGraphQL",{options:o},async t=>{const{errors:e,data:n}=t;if(e&&e.length>0)return e.forEach(t=>i&&i(t)),console.log(e),await this.emit("*","accountChanged",{hasLogin:this.hasLogin,bilibiliAccount:this.bilibiliAccount,downloadingSettings:this.downloadingSettings}),await this.emit("*","bhAccountChange",{bhAccount:null}),i&&i("LOGIN_ERROR");t&&n&&(this.setStore("default",n.bilibiliHelperAccount.login),this.bhAccount=n.bilibiliHelperAccount.login,this.hasLogin=!0,this.bilibiliAccount&&await this.initLocalBilibiliAccount(),await this.emit("*","accountChanged",{hasLogin:this.hasLogin,bilibiliAccount:this.bilibiliAccount,downloadingSettings:this.downloadingSettings}),await this.emit("*","bhAccountChange",{bhAccount:this.getStore("default")}),await this.checkSettingNeedUpdate(!0),i&&i({hasLogin:!0,bhAccount:this.bhAccount,bilibiliAccount:this.bilibiliAccount}))})}),w()(this,"resetPassword",async(t,e,i)=>{console.log(t);const{uid:n,password:s}=t;if(!n||!s)return;const o={query:"mutation ($blid: BLID!, $password: String!) {\n                      bilibiliHelperAccount {\n                        resetPassword(blid: $blid, password: $password)\n                      }\n                    }",variables:{blid:n,password:s}};await this.emit("requestController","createGraphQL",{options:o},async t=>{console.log(t);const{errors:e,data:n}=t;e&&e.length>0?e.forEach(t=>{switch(t.module){case"BILIBILI_HELPER_ACCOUNT":switch(t.type){case"NO_ACCESS_TO_RESET_PASSWORD":return this.needFillPassword=!0,i&&i("NO_ACCESS_TO_RESET_PASSWORD");case"BIND_ERROR":return this.hasLogin=!1,i&&i("LOGIN_ERROR")}}}):t&&n&&i&&i(n.bilibiliHelperAccount.resetPassword)})}),w()(this,"initLocalBilibiliAccount",async()=>(await this.emit("bilibiliAccountController","getLocalAccount",null,t=>{this.bilibiliAccount=t}),await this.getLocalBlidRegisterStatus(),this.bilibiliAccount)),w()(this,"signOut",async(t,e,i)=>{const n={query:"mutation {\n                      bilibiliHelperAccount {\n                        signOut\n                      }\n                    }"};await this.emit("requestController","createGraphQL",{options:n},async t=>{console.log(t);const{errors:e,data:n}=t;e&&e.length>0?i instanceof Function&&i(!1):t&&(this.hasLogin=!1,this.cache.clearCache(),await this.emit("*","accountChanged",{hasLogin:this.hasLogin,bilibiliAccount:this.bilibiliAccount,downloadingSettings:this.downloadingSettings}),i instanceof Function&&i(!0))})}),w()(this,"sendCaptchaForBindEmail",(t,e,i)=>{const n={query:"mutation sendCaptchaForBindEmail($email: String!) {\n                      bilibiliHelperAccount {\n                        sendCaptchaForBindEmail(email: $email)\n                      }\n                    }",variables:{email:t.email}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):i&&i("发送验证码成功")})}),w()(this,"validateCaptchaForEmailBind",(t,e,i)=>{const n={query:"mutation validateCaptchaForEmailBind($captcha: String!) {\n                      bilibiliHelperAccount {\n                        validateCaptchaForEmailBind(captcha: $captcha)\n                      }\n                    }",variables:{captcha:t.captcha+""}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):(await this.getBHAccountState().then(this.initLocalBilibiliAccount),i&&i("绑定成功"))})}),w()(this,"sendCaptchaForChangePassword",(t,e,i)=>{const n={query:"mutation changePassword($email: String!) {\n                      bilibiliHelperAccount {\n                        sendCaptchaForChangePassword(email: $email)\n                      }\n                    }",variables:{email:t.email}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):i&&i("发送验证码成功")})}),w()(this,"validateCaptchaForChangePassword",(t,e,i)=>{const n={query:"mutation changePassword($captcha: String!, $password: String!) {\n                      bilibiliHelperAccount {\n                        validateCaptchaForChangePassword(captcha: $captcha, password: $password)\n                      }\n                    }",variables:{captcha:t.captcha+"",password:t.password}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):i&&i("修改成功")})}),w()(this,"sendCaptchaForSignUp",(t,e,i)=>{const n={query:"mutation signUp($blid: BLID!, $email: String!) {\n                      bilibiliHelperAccount {\n                        sendCaptchaForSignUp(blid: $blid, email: $email)\n                      }\n                    }",variables:{blid:t.blid,email:t.email}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):i&&i("发送验证码成功")})}),w()(this,"validateCaptchaForSignUp",(t,e,i)=>{const n={query:"mutation signUp($blid: BLID!, $email: String!, $captcha: String!, $password: String!) {\n                      bilibiliHelperAccount {\n                        validateCaptchaForSignUp(blid: $blid, email: $email, captcha: $captcha, password: $password)\n                      }\n                    }",variables:{blid:t.blid,email:t.email,captcha:t.captcha+"",password:t.password}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):i&&i("注册成功")})}),w()(this,"sendCaptchaForResetPassword",(t,e,i)=>{const n={query:"mutation resetPassword($blid: BLID!, $email: String!) {\n                      bilibiliHelperAccount {\n                        sendCaptchaForResetPassword(blid: $blid, email: $email)\n                      }\n                    }",variables:{blid:t.blid,email:t.email}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):i&&i("发送验证码成功")})}),w()(this,"validateCaptchaForResetPassword",(t,e,i)=>{const n={query:"mutation resetPassword($blid: BLID!, $captcha: String!, $password: String!) {\n                      bilibiliHelperAccount {\n                        validateCaptchaForResetPassword(blid: $blid, captcha: $captcha, password: $password)\n                      }\n                    }",variables:{blid:t.blid,captcha:t.captcha+"",password:t.password}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):i&&i("修改成功")})}),w()(this,"queryTradeNoComplete",(t,e,i)=>{const n={query:"query queryTrade ($outTradeNo: String!) {\n                        payment {\n                            queryTradeByOutTradeNo(outTradeNo: $outTradeNo) {\n                                code\n                                sub_msg\n                                sub_code\n                                trade_status\n                            }\n                        }\n                    }",variables:{outTradeNo:t.outTradeNo}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):("10000"===n.payment.queryTradeByOutTradeNo.code&&await this.getBHAccountState().then(this.initLocalBilibiliAccount),i&&i(n.payment.queryTradeByOutTradeNo))})}),w()(this,"useRedeem",(t,e,i)=>{const n={query:"mutation useRedeem ($code: String!) {\n                        bilibiliHelperAccount {\n                            useRedeem(code: $code)\n                        }\n                    }",variables:{code:t.code}};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):(await this.getBHAccountState().then(this.initLocalBilibiliAccount),i&&i("兑换成功"))})}),w()(this,"queryOrderAndRedeemList",(t,e,i)=>{const n={query:"query queryOrderList {\n                        bilibiliHelperAccount {\n                            queryOrderList {\n                              redeemList {\n                                active\n                                used\n                                generateType\n                                name\n                                code\n                                days\n                                to\n                                createDateTime\n                              }\n                              orderList {\n                                gmt_create\n                                out_trade_no\n                                total_amount\n                                product_id\n                              }\n                            }\n                        }\n                    }"};this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;return e&&e.length>0?i&&i(e[0].message):i&&i(n.bilibiliHelperAccount.queryOrderList)})}),w()(this,"uploadSettings2Cloud",async(t,e,i)=>{const{featureName:n}=t;this.settingsNeedUpload[n]=await new L.a(t=>this.emit(n,"getSettingsForUpload",null,t)),clearTimeout(this.uploadSettingIntervalNumber),this.uploadSettingIntervalNumber=setTimeout(()=>{const t={query:"mutation ($bhVersion: String!, $modelVersion: Int!, $value: String!) {\n                      bilibiliHelperSetting {\n                        setByFragment(bhVersion: $bhVersion, modelVersion: $modelVersion, value: $value)\n                      }\n                    }\n                    ",variables:ut()({bhVersion:Et.c,modelVersion:2,value:ut()(this.settingsNeedUpload)})};this.settingsNeedUpload={},this.emit("requestController","createGraphQL",{options:t},async t=>{const{errors:e}=t;e&&e.length>0?(console.log(e),i instanceof Function&&i(!1)):t&&i instanceof Function&&i(!0)})},this.uploadSettingsDuration)}),w()(this,"checkSESSIONDATA",async t=>new L.a(e=>{this.emit("requestController","create",{url:"https://api.bilibili.com/x/web-interface/nav",options:{contentType:"json",credential:"omit",headers:{"bilibili-helper-header-action-set-cookie":t}}},t=>{e(!!t&&(0===t.code&&t.data.isLogin))})})),w()(this,"modifyReferer",t=>{const{initiator:e,requestHeaders:i}=t,n=!Tt()(Dt()(i,({name:t})=>t.match("bilibili-helper-header-action"))),s=[...i];if(n){const t=s.findIndex(({name:t})=>"bilibili-helper-header-action-set-cookie"===t);t>-1&&(s.push({name:"cookie",value:s[t].value}),s.splice(t,1))}return{requestHeaders:s}}),w()(this,"syncSettingsFromCloud",async(t,e=!1)=>{if(this.downloadingSettings&&this.cache.get()&&!(this.cache.get()<t)&&!e)return!1;this.downloadingSettings=!0,t&&this.cache.set(t),this.downloadSettings().then(()=>{this.downloadingSettings=!1})}),w()(this,"downloadSettings",(t,e,i)=>{const n={query:"query ($bhVersion: String!, $modelVersion: Int!) {\n                      bilibiliHelperSetting {\n                        get(bhVersion: $bhVersion, modelVersion: $modelVersion) {\n                            value\n                            bhVersion\n                            modelVersion\n                            lastUpdateTime\n                        }\n                      }\n                    }",variables:ut()({bhVersion:Et.c,modelVersion:2})};return this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;e&&e.length>0?(console.log(e),i instanceof Function&&i(!1)):t&&n&&(i instanceof Function&&i(!0),n.bilibiliHelperSetting.get&&(this.cache.set(n.bilibiliHelperSetting.get.lastUpdateTime),this.emit("app","setSettingsFromCloud",{settings:JSON.parse(n.bilibiliHelperSetting.get.value)})))})}),w()(this,"checkSettingNeedUpdate",async(t=!1)=>{this.needDownloadSettings=!1,this.hasLogin&&await this.getSettingLastUpdateTime().then(e=>{(!this.cache.get()||t||e)&&this.syncSettingsFromCloud(e,t)})}),w()(this,"getSettingLastUpdateTime",async(t,e,i)=>{const n={query:"query ($bhVersion: String!, $modelVersion: Int!) {\n                      bilibiliHelperSetting {\n                        get(bhVersion: $bhVersion, modelVersion: $modelVersion) {\n                            lastUpdateTime\n                        }\n                      }\n                    }",variables:ut()({bhVersion:Et.c,modelVersion:2})};await this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:n}=t;e&&e.length>0?(console.log(e),i instanceof Function&&i(!1)):t&&n&&i instanceof Function&&i(n.bilibiliHelperSetting.get.lastUpdateTime)})})}async onInitStore(){const t=this.getStore("default");this.store=t?{hasLogin:!1,bhid:null,blidList:[],identities:[]}:t,this.settingStore=this.getStore("settings")||{}}async onBeforeLaunch(){this.addListener("networkOnlineChange",this.onNetworkOnline),this.addListener("login",this.login),this.addListener("signOut",this.signOut),this.addListener("getStatus",(t,e,i)=>{let n;const s=()=>{if(this.accountDataInitialized)return i({hasLogin:this.hasLogin,bilibiliAccount:this.bilibiliAccount?this.bilibiliAccount.toJSON():null,downloadingSettings:this.downloadingSettings,hasRegister:this.hasRegister,bhAccount:this.bhAccount}),clearInterval(n),!0};s()||(n=setInterval(()=>{s()},1e3))}),this.addListener("initBHAccountAfterSignUp",(t,e,i)=>{this.getBHAccountState().then(this.initLocalBilibiliAccount).then(()=>{i({hasLogin:this.hasLogin,bhAccount:this.bhAccount,bilibiliAccount:this.bilibiliAccount})})}),this.addListener("getBHAccount",(t,e,i)=>{i(this.getStore("default"))}),this.addListener("uploadSettings",this.uploadSettings2Cloud),this.addListener("downloadSettings",Nt()(this.downloadSettings,this.downloadSettingsDuration)),this.addListener("resetPassword",this.resetPassword),this.addListener("allHasLoaded",({firstInstall:t},e,i)=>{this.checkSettingNeedUpdate(t||this.needDownloadSettings),i()}),this.addListener("queryTradeNoComplete",this.queryTradeNoComplete),this.addListener("sendCaptchaForSignUp",this.sendCaptchaForSignUp),this.addListener("validateCaptchaForSignUp",this.validateCaptchaForSignUp),this.addListener("sendCaptchaForBindEmail",this.sendCaptchaForBindEmail),this.addListener("validateCaptchaForEmailBind",this.validateCaptchaForEmailBind),this.addListener("sendCaptchaForChangePassword",this.sendCaptchaForChangePassword),this.addListener("validateCaptchaForChangePassword",this.validateCaptchaForChangePassword),this.addListener("sendCaptchaForResetPassword",this.sendCaptchaForResetPassword),this.addListener("validateCaptchaForResetPassword",this.validateCaptchaForResetPassword),this.addListener("useRedeem",this.useRedeem),this.addListener("queryOrderAndRedeemList",this.queryOrderAndRedeemList),this.addListener("localBilibiliAccountLoginStateChange",async({login:t})=>{t?(await this.initLocalBilibiliAccount(),await this.emit("*","accountChanged",{hasLogin:this.hasLogin,bhAccount:this.bhAccount,bilibiliAccount:this.bilibiliAccount,downloadingSettings:this.downloadingSettings})):(this.bilibiliAccount=null,await this.emit("*","accountChanged",{hasLogin:this.hasLogin,bhAccount:this.bhAccount,bilibiliAccount:this.bilibiliAccount,downloadingSettings:this.downloadingSettings}),await this.signOut())})}async onAfterLaunch(){}async getLocalBlidRegisterStatus(){const t=this.bilibiliAccount?this.bilibiliAccount.uid:null;if(t){const e={query:"query ($blid: BLID!) {\n                          bilibiliHelperAccount {\n                            hasRegister(blid: $blid)\n                          }\n                        }",variables:{blid:+t}};await this.emit("requestController","createGraphQL",{options:e},t=>{const{errors:e,data:i}=t;if(e&&e.length>0){const t=e.find(({type:t,module:e})=>"BILIBILI_HELPER_ACCOUNT"===e&&"NEED_SIGNIN"===t);console.warn(e,t),t&&(this.hasRegister=!0)}else t&&i&&(this.hasRegister=i.bilibiliHelperAccount.hasRegister)})}else this.hasRegister=!1;this.accountDataInitialized=!0}async getBHAccountState(){const t={query:"query {\n                        bilibiliHelperAccount {\n                            getState {\n                                bhid\n                                boundBlid\n                                email\n                                identities {\n                                    name\n                                    from\n                                    to\n                                    hasDateTimeLimit\n                                }\n                            }\n                        }\n                    }"};await this.emit("requestController","createGraphQL",{options:t},async t=>{const{errors:e,data:i}=t;return e&&e.length>0?(this.setStore("default",null),this.bhAccount=null,this.hasLogin=!1,e[0].message):(this.setStore("default",t.data.bilibiliHelperAccount.getState),this.bhAccount=t.data.bilibiliHelperAccount.getState,this.hasLogin=!0,t.data.bilibiliHelperAccount.getState)})}}var jt=i(9);i(48);class Rt extends jt.a{constructor(t,e){super(t,e,"emoji",{settings:{on:!0}}),w()(this,"emojiMap",new _.a)}launch(){this.emit("requestController","create",{url:"https://api.bilibili.com/x/v2/reply/v2/emojis",options:{contentType:"json"}},t=>{if(0===t.code){const{free:e,vip:i,mapping:n}=t.data;[e,i].forEach(t=>{t.forEach(({emojis:t})=>{t.forEach(({name:t,url:e})=>{this.emojiMap.set(t,e),t in n&&this.emojiMap.set(n[t],e)})})}),window.emojis=this.emojiMap}else console.error(t)}).catch(console.error)}}i(385);class Bt extends jt.a{constructor(t,e){super(t,e,"googleAnalytics",{settings:{on:!0},cache:{type:"local",dataType:"number"}}),w()(this,"__send",({hitType:t="event",eventAction:e,eventCategory:i,eventLabel:n,nonInteraction:s})=>{window.ga&&window.ga("send",{hitType:t,eventAction:e,eventCategory:i,eventLabel:n,nonInteraction:s})}),w()(this,"__sendPageView",t=>{window.ga&&window.ga("send",{hitType:"pageview",page:t})}),w()(this,"sendGA",(t,e,i)=>{if(this.settings.on&&t.action&&t.category){const{hitType:e,action:n,label:s,category:o="",nonInteraction:a=!1}=t;this.insertGAScriptTag(),this.__send({hitType:e,eventAction:n,eventCategory:o,eventLabel:s,nonInteraction:a}),i(!0)}else i(!1)}),w()(this,"sendPage",(t,e,i)=>{if(this.settings.on&&t.pathname){const{pathname:e}=t;this.insertGAScriptTag(),this.__sendPageView(e),i(!0)}else i(!1)}),w()(this,"insertGAScriptTag",(t="UA-39765420-8")=>{0===document.getElementsByClassName("ga-script").length&&(window.GoogleAnalyticsObject="ga",window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=1*new Date,window.ga("create",t,"auto"),window.ga("set","dimension1",ct.version),window.ga("set","checkProtocolTask"),window.ga("set","userId",this.store.uid||this.store.randomUserId))}),w()(this,"localBilibiliAccountLoginStateChange",({login:t},e,i)=>{void 0!==t?(t?this.emit("bilibiliAccountController","getLocalAccount",null,t=>{console.error(t),t?(this.store.uid=t.uid,window.ga("set","userId",this.store.uid)):(this.store.uid="",this.store.randomUserId||(this.store.randomUserId=String(Math.random()).slice(2),window.ga("set","userId",this.store.randomUserId))),this.setStore("default",this.store)}):(this.store.uid="",this.store.randomUserId||(this.store.randomUserId=String(Math.random()).slice(2),window.ga("set","userId",this.store.randomUserId),this.setStore("default",this.store))),i(!0)):i(!1)}),w()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:jt.a.simplifyConfig(this.settings),stores:{default:this.getStore("default")}})})}get todayPassed(){return this.cache.get()===(new Date).getDate()}async onInitStore(){this.store=this.getStore("default"),this.store={},await this.emit("bilibiliHelperAccountController","getStatus",null,({bilibiliAccount:t})=>{t&&t.uid?this.store.uid=t.uid:this.store.randomUserId=String(Math.random()).slice(2),this.setStore("default",this.store)})}async onLaunch(){this.addListener("localBilibiliAccountLoginStateChange",this.localBilibiliAccountLoginStateChange),this.addListener("send",this.sendGA),this.addListener("sendPage",this.sendPage),this.insertGAScriptTag();const t=this.getSetting("debug")||{};this.todayPassed||(this.__send({hitType:"event",eventCategory:"initialization",eventAction:"init",eventLabel:`${t.on?"official":"dev"}_${ct.version}`}),this.cache.set((new Date).getDate()))}}var qt=i(41),Ut=i.n(qt);function Ht(t,e){var i=b()(t);if(m.a){var n=m()(t);e&&(n=n.filter((function(e){return p()(t,e).enumerable}))),i.push.apply(i,n)}return i}function $t(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ht(Object(i),!0).forEach((function(e){w()(t,e,i[e])})):u.a?l()(t,u()(i)):Ht(Object(i)).forEach((function(e){r()(t,e,p()(i,e))}))}return t}const Wt={};class Vt extends jt.a{constructor(t,e){super(t,e,"proxyForWebsite",{dependencies:["requestController","webRequestController"],settings:{on:!0}}),w()(this,"callback",t=>{const{initiator:e,requestHeaders:i}=t,n=!Tt()(Dt()(i,({name:t,value:e})=>"From"===t&&"bilibili-helper"===e));if(/^chrome-extension:\/\//.test(e)||n){const t=i.find(t=>"origin"===t.name.toLowerCase());return t?t.value="https://h.bilibili.com":i.push({name:"Origin",value:"https://h.bilibili.com"}),{requestHeaders:i}}}),w()(this,"fetchJSON",async(t,{url:e,options:i,sign:n,model:s})=>{if(!s)throw"fetch from Model "+s;const o=new Ut.a(e,!0);return this.emit("requestController","create",{url:e,options:$t($t({},i),{},{contentType:"json"})},e=>{t.postMessage({command:"returnFetch",data:$t($t({},e),{},{receipt:o.query}),from:"helperProxy",model:s,sign:n})})}),w()(this,"fetchImage",async(t,{url:e,options:i,sign:n,model:s,mine:o})=>{let a="";a=Wt[n]?Wt[n]:await this.emit("requestController","create",{url:e,options:i},t=>t.arrayBuffer().then(t=>Wt[n]=`data:${o};base64,`+(t=>{const e=[].slice.call(new Uint8Array(t));let i="";return e.forEach(t=>i+=String.fromCharCode(t)),window.btoa(i)})(t))),t.postMessage({command:"returnFetch",data:a,from:"helperProxy",model:s,sign:n})}),w()(this,"fetchPOST",async(t,{url:e,options:i,sign:n,model:s})=>{if(!s)throw"fetch from Model "+s;const{body:o}=i,a=Y()(i,["body"]),r=new FormData;for(let t in o)r.append(t,o[t]);return i.body=r,a.body=r,this.emit("requestController","create",{url:e,options:$t($t({},a),{},{contentType:"json"})},e=>{t.postMessage({command:"returnFetch",data:$t($t({},e),{},{receipt:o}),from:"helperProxy",model:s,sign:n})})})}async onLaunch(){this.emit("webRequestController","create",{name:"proxyForWebsite",eventName:"onBeforeSendHeaders",filter:{urls:["https://api.bilibili.com/x/v2/reply/action?*","https://api.bilibili.com/x/v2/reply/add?*"]},options:["blocking","requestHeaders","extraHeaders"],callback:this.callback}),chrome.runtime.onConnect.addListener(t=>{t.onMessage.addListener((e,i)=>{console.log("proxy for website: Receive message",e,i);const{command:n,data:s}=e;switch(n){case"connect":((t,{model:e,sign:i})=>{t.postMessage({command:"returnApp",data:{code:0,data:{connected:!0,version:ct.version}},from:"helperProxy",model:e,sign:i})})(i,s);break;case"fetch":{const{type:t}=s,e=Y()(s,["type"]);"json"===t?this.fetchJSON(i,e):"image"===t?this.fetchImage(i,e):"post"===t&&this.fetchPOST(i,e);break}case"cookie":(async(t,e)=>{const{detail:i,model:n,sign:s}=e;if(!n)throw"fetch from Model "+n;chrome.cookies.get(i,e=>{t.postMessage({command:"returnCookie",data:e.value,from:"helperProxy",model:n,sign:s})})})(i,s);break;case"actionInParent":chrome.tabs.sendMessage(t.sender.tab.id,s);break;case"actionInOrigin":chrome.tabs.sendMessage(t.sender.tab.id,s,{frameId:t.sender.frameId})}})})}}class zt extends jt.a{constructor(t,e){super(t,e,"language",{settings:{on:!0,lang:"zh_CN"}}),w()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:jt.a.simplifyConfig(this.settings)})})}async onLaunch(){this.addListener("getI18nMap",(t,e,i)=>{i(window.i18nMap)})}}function Gt(t,e){var i=b()(t);if(m.a){var n=m()(t);e&&(n=n.filter((function(e){return p()(t,e).enumerable}))),i.push.apply(i,n)}return i}class Qt extends jt.a{constructor(t,e){super(t,e,"message",{settings:{on:!0,announcementNotification:!0},cache:{type:"local",dataType:"object",delayDuration:0}}),w()(this,"onNetworkOnline",async t=>{t&&this.checkNewAnnouncement().then(this.sendNotification)}),w()(this,"createAnnouncementCheckClock",()=>{this.emit("clockController","create",{name:"message",alarmInfo:{periodInMinutes:180},focus:!0,callback:()=>{this.checkNewAnnouncement().then(this.sendNotification)}})}),w()(this,"checkNewAnnouncement",async t=>{const e={query:"query ($type: String!, $id: Int){\n                      message {\n                        getLatest(type: $type, id: $id) {\n                          latestUpdateDateTime\n                        }\n                      }\n                    }",variables:{type:"announcement",id:t}};return await this.emit("requestController","createGraphQL",{options:e},e=>{const{errors:i,data:n}=e;if(i)return!1;if(e&&n){const{latestUpdateDateTime:e}=n.message.getLatest||{},i=this.cache.get();if(!i||Tt()(i)||!i.announcement||i.announcement.latestUpdateDateTime<e)return this.getLatestAnnouncement(t,!1)}})}),w()(this,"getLatestAnnouncement",async(t,e=!0)=>this.getLatestMessage("announcement",t,e)),w()(this,"getLatestMessage",async(t,e,i=!0)=>{if(i){const t=this.cache.get(i);if(!Tt()(t))return t}const n={query:"query ($type: String!, $id: Int){\n                        message {\n                            getLatest(type: $type, id: $id) {\n                                id\n                                title\n                                type\n                                content\n                                latestUpdateDateTime\n                            }\n                        }\n                    }",variables:{type:t,id:e}};return this.emit("requestController","createGraphQL",{options:n},e=>{const{errors:i,data:n}=e;if(i)return!1;{const e=this.cache.get();if(void 0===e[t])e[t]={list:[n.message.getLatest],latestUpdateDateTime:n.message.getLatest.latestUpdateDateTime,hasNew:!0};else{if(!(e[t].latestUpdateDateTime<n.message.getLatest.latestUpdateDateTime))return!1;e[t].latestUpdateDateTime=n.message.getLatest.latestUpdateDateTime,e[t].list.unshift(n.message.getLatest),e[t].hasNew=!0}return this.cache.set(e),e}})}),w()(this,"sendNotification",t=>{const{announcementNotification:e}=this.settings;if(!e)return;if(!t||!t.announcement||!t.announcement.hasNew)return;const i=t.announcement.list[0];this.emit("notificationController","post",{title:"收到新公告，点击查阅",icon:chrome.runtime.getURL("statics/images/bilibili-cat-256.png"),body:i.title,autoCloseInterval:1e4,data:{url:("production".match("dev")?"http://bilibilihelper.com:8000":"https://bilibilihelper.com")+"/announcement?id="+i.id},actions:[{action:"watch",title:"立即查看"}]})}),w()(this,"getSettingsForUpload",async(t,e,i)=>{i({settings:jt.a.simplifyConfig(this.settings)})})}async onInitStore(){const t=this.cache.get();if(t&&t.latestUpdateDateTime){const e={},i=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Gt(Object(i),!0).forEach((function(e){w()(t,e,i[e])})):u.a?l()(t,u()(i)):Gt(Object(i)).forEach((function(e){r()(t,e,p()(i,e))}))}return t}({},t);e.announcement={latestUpdateDateTime:t.latestUpdateDateTime,list:[i],hasNew:!1},this.cache.set(e)}}async onBeforeLaunch(){this.addListener("networkOnlineChange",this.onNetworkOnline),this.addListener("getLatestAnnouncement",(t,e,i)=>{this.getLatestAnnouncement(null,!0).then(t=>i(t))}),this.addListener("setAnnouncementRead",(t,e,i)=>{const n=this.cache.get();n.announcement.hasNew=!1,this.cache.set(n),i(!0)})}async onLaunch(){this.createAnnouncementCheckClock(),this.checkNewAnnouncement().then(this.sendNotification)}}function Jt(t,e){var i=b()(t);if(m.a){var n=m()(t);e&&(n=n.filter((function(e){return p()(t,e).enumerable}))),i.push.apply(i,n)}return i}function Yt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Jt(Object(i),!0).forEach((function(e){w()(t,e,i[e])})):u.a?l()(t,u()(i)):Jt(Object(i)).forEach((function(e){r()(t,e,p()(i,e))}))}return t}class Kt extends jt.a{constructor(t,e){super(t,e,"states",{settings:{on:!0},cache:{type:"local",dataType:"object",delayDuration:0,limit:{duration:18e4}}}),w()(this,"states",null),w()(this,"shouldUpdate",!1),w()(this,"onNetworkOnline",async t=>{t&&(await this.getVersionInfo(!0),await this.getStates(!1))}),w()(this,"getStates",async(t=!0)=>{let e=this.cache.checkExpired().expired;const i=this.cache.get(t);if(!e&&i&&!Tt()(i)&&t)return i;const n={query:"query get($names: [String!]!) {\n                        app {\n                            get(names: $names) {\n                                latestVersion\n                                publishState\n                                minVersion\n                                paymentLink\n                                paymentIframe\n                            }\n                        }\n                    }\n                    ",variables:{names:["latestVersion","publishState","minVersion","paymentLink","paymentIframe"]}};return await this.emit("requestController","createGraphQL",{options:n},async t=>{const{errors:e,data:i}=t;return!(e||!t)&&(t&&i?(this.states=b()(i.app.get).reduce((t,e)=>(i.app.get[e].length&&["{","["].includes(i.app.get[e][0])&&["}","]"].includes(i.app.get[e][i.app.get[e].length-1])?t[e]=JSON.parse(i.app.get[e]):t[e]=i.app.get[e],t),{}),Object(ct.isBiggerThan)(this.states.minVersion,ct.version)>0&&(this.shouldUpdate=!0),this.cache.set(this.states),this.states):void 0)})}),w()(this,"getVersionInfo",async(t=!1)=>{if(!this.getStore("currentVersionInfo")||t){const t={query:"query get($version: String!) {\n                        version {\n                            get(version: $version) {\n                                version\n                                available\n                                publishType\n                            }\n                        }\n                    }\n                    ",variables:{version:ct.version}};await this.emit("requestController","createGraphQL",{options:t},t=>{const{errors:e,data:i}=t;if(e)return!1;{const t=i.version.get;return void 0!==t&&this.setStore("currentVersionInfo",t),t}})}})}async onBeforeLaunch(){this.addListener("networkOnlineChange",this.onNetworkOnline),this.addListener("getStates",(t,e,i)=>{this.getStates().then(t=>i(Yt(Yt({},t),{},{shouldUpdate:this.shouldUpdate})))}),this.addListener("getVersionInfo",(t,e,i)=>{const n=this.getStore("currentVersionInfo");void 0!==n?i(n):this.getVersionInfo().then(t=>i(t))})}async onLaunch(){await this.getVersionInfo(!0),await this.getStates(!1)}}class Xt extends jt.a{constructor(t,e){super(t,e,"ad",{settings:{on:!0}}),w()(this,"adMap",[]),w()(this,"clearIntervalDuration",18e5),w()(this,"clearIntervalTimer",null),w()(this,"systemType",ct.isMacOS?"mac":"win"),w()(this,"onNetworkOnline",async t=>{t&&(this.adMap=await this.getADs(["test"]))}),w()(this,"clearCache",()=>{clearTimeout(this.clearIntervalTimer),this.clearIntervalTimer=setTimeout(()=>{this.adMap=[]},this.clearIntervalDuration)}),w()(this,"getADs",async(t=["test"])=>{const e={query:"query get($tags: [String!]!) {\n                        ad {\n                            get(tags: $tags) {\n                                id\n                                title\n                                content\n                                cover\n                                link\n                                to\n                                tags\n                                position\n                                available\n                                system\n                            }\n                        }\n                    }\n                    ",variables:{tags:t}};return await this.emit("requestController","createGraphQL",{options:e},async t=>{const{errors:e,data:i}=t;return!(e||!t)&&(t&&i?i.ad.get:void 0)})})}async onBeforeLaunch(){this.addListener("networkOnline",this.onNetworkOnline),this.addListener("getAds",(t,e,i)=>{this.clearCache(),new L.a(e=>{this.adMap&&0===this.adMap.length?this.getADs(t.tags).then(t=>{t&&(this.adMap=t),e(this.adMap)}):e(this.adMap)}).then(e=>{let n=[];e&&t.position&&(n=e.filter(e=>e.position===t.position)),n=n.filter(t=>t.system===this.systemType||"all"===t.system),i(n)})})}async onLaunch(){this.adMap=await this.getADs(["test"])}}var Zt=i(202),te=i(95),ee=i.n(te),ie=i(131),ne=i.n(ie),se=i(295),oe=i.n(se);i(2);const ae=new O("app"),re={INVALID_ITEM_NAME:ae.create("invalidItemName"),UNDEFINED_ITEM:ae.create("undefinedItem"),INVALID_SETTINGS:ae.create("invalidSettings")};class ce extends S.a{constructor(){super(null,new _.a,"app"),w()(this,"__itemType","app"),w()(this,"items",new _.a),w()(this,"require2LoadList",new at.a),w()(this,"initialStatuses",{}),w()(this,"onReceivedMessageByChromeInterface",(t,e,i)=>{if(!N()(t)||!t.target)return!0;this.logger.log("Received message",t);const{target:n,event:s}=t,o=Y()(t,["target","event"]);return this.emit(n,s,o,i,e),!0})}async onBeforeLaunch(){chrome.runtime.onMessage.addListener(this.onReceivedMessageByChromeInterface),this.addListener("setInitialStatus",(t,e,i)=>{this.logger.log("setInitialStatus",t,e),t.name&&t.value&&(this.initialStatuses[t.name]=t.value),i()}),this.addListener("getInitialStatus",(t,e,i)=>{i(this.initialStatuses)}),this.addListener("getSetting",(t,e,i)=>{if(0===t.filter(t=>"string"==typeof t).length)return i(re.INVALID_ITEM_NAME);if(1===t.length){const e=this.items.get(t);return i(e?e.settings:re.UNDEFINED_ITEM)}if(t.length>1){return i(t.map(t=>this.items.has(t)?[t,this.items.get(t).settings]:(this.logger.warn(re.UNDEFINED_ITEM,t),!1)).filter(Boolean))}}),this.addListener("getSettingsForUpload",(t,e,i)=>{const n=T()(this.items.values());L.a.all(n.map(async t=>{const e=await t.getSettingsForUpload();if(e)return{[t.name]:e}})).then(t=>t.filter(Boolean)).then(t=>{const e=ee()(t).reduce((t,e)=>{if(e){const[i,n]=D()(e)[0];n&&(t[i]=n)}return t},{});i(e)})}),this.addListener("setSettingsFromCloud",(t,e,i)=>{const{settings:n}=t;if(!n)return i(!1);L.a.all(T()(this.items.values()).map(t=>{if(t.name in n&&t.setSettingsFromCloud)return t.setSettingsFromCloud(n[t.name])})).then(()=>{i(!0)})})}async loadItems(t,e={}){const{onBeforeItemLoad:i,onAfterItemLoad:n}=e||{};i&&(this.onBeforeLoad=i),n&&(this.onAfterLoad=n),await this.onBeforeLoad(t),await this.onLoad(t),await this.onAfterLoad()}async onBeforeLoad(t){this.retryMax=b()(t).length,this.retryTime=0}async onLoad(t){const e=await this.__instantiateItems(t);await this.__loadItems(e)}async onAfterLoad(){this.retryMax=0,this.retryTime=0}async __instantiateItems(t){return new L.a(e=>{let i=new _.a;b()(t).forEach(e=>{const n=t[e];if(n.prototype&&(n.prototype.constructor.prototype instanceof jt.a||n.prototype.constructor.prototype instanceof C||n.prototype.constructor.prototype instanceof S.a)){const t=oe()(e);i.has(t)||(n?i.set(t,new n(this,this.bus)):this.logger.warn(re.UNDEFINED_ITEM,e))}}),e(i)})}async __loadItems(t){this.waitQueue=T()(t.values()),await this.dealWidthWaitQueue()}async dealWidthWaitQueue(t=!1){t&&++this.retryTime;const e=this.waitQueue.shift();await new L.a(i=>{this.checkDependencies(e)?(t&&--this.retryTime,i(this.__loadItem(e))):(this.waitQueue.push(e),i(!1))}).then(()=>{if(this.waitQueue.length>0&&this.retryTime<=this.retryMax)return this.dealWidthWaitQueue(!0)})}async __loadItem(t){t&&this.logger.log(`load ${t.__itemType} ${t.name}`,t),await this.onBeforeItemLoad(t),await this.onItemLoad(t),await this.onAfterItemLoad(t)}async onBeforeItemLoad(t){}async onItemLoad(t){const{settings:e}=t;void 0===e||void 0===e.on?this.logger.error(re.INVALID_SETTINGS):(await t.init(),this.items.set(t.name,t))}async onUninstall(){chrome.runtime.onMessage.addListener(this.onReceivedMessageByChromeInterface),this.require2LoadList=new at.a}async onAfterItemLoad(t){}checkDependencies(t){if(!t)return this.logger.error("invalid item for check dependencies"),!1;const e=t.dependencies||[];if(!e||0===e.length)return!0;let i=e.length;const n=e.filter(t=>{if(this.items.has(t)&&this.items.get(t).__initialized)return this.require2LoadList.has(t)&&this.require2LoadList.delete(t),!0;this.require2LoadList.add(t)}).length===i;return!n&&this.retryTime>this.retryMax&&this.logger.error(`${ne()(t.name)} Require Item(s): ${T()(this.require2LoadList).join(", ")}`,this.items),n}}var le=i(294);function he(t,e){var i=b()(t);if(m.a){var n=m()(t);e&&(n=n.filter((function(e){return p()(t,e).enumerable}))),i.push.apply(i,n)}return i}function ue(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?he(Object(i),!0).forEach((function(e){w()(t,e,i[e])})):u.a?l()(t,u()(i)):he(Object(i)).forEach((function(e){r()(t,e,p()(i,e))}))}return t}chrome.contextMenus.removeAll();let de=!1;chrome.runtime.onInstalled.addListener((function(t){const{reason:e,previousVersion:i}=t;"install"===e&&(de=!0)})),chrome.i18n.getAcceptLanguages(t=>{const e=le||[],i=e.map(t=>`../_locales/${t}/messages.json`).map((t,i)=>fetch(t).then(async t=>({[e[i].replace("_","-")]:await t.json()})));L.a.all(i).then(e=>{const i=e.reduce((t,e)=>ue(ue({},t),e),{});window.i18nMap=t.reduce((t,e)=>(/^zh/.test(e)&&"zh-TW"!==e?t["zh-CN"]||(t["zh-CN"]=i["zh-CN"]):t[e]=i[e],t),{})})});const pe=new ce;pe.onLaunch=async()=>{n&&await pe.loadItems(n),s&&await pe.loadItems(s),o&&await pe.loadItems(o),Zt&&await pe.loadItems(Zt),await pe.emit("*","allHasLoaded",{firstInstall:de}),de&&Object(ct.createTabByURL)(Object(ct.getURL)("html/config.html"))},pe.init().catch(t=>{console.error(t)})},385:function(t,e,i){var n=i(45),s=i(71);!function(){var t,e,i,n=this||self,s=function(t,e){t=t.split(".");var i,s=n;t[0]in s||void 0===s.execScript||s.execScript("var "+t[0]);for(;t.length&&(i=t.shift());)t.length||void 0===e?s=s[i]&&s[i]!==Object.prototype[i]?s[i]:s[i]={}:s[i]=e},o=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},a=function(t){for(var e in t)if(t.hasOwnProperty(e))return!0;return!1},r=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i,c=window,l=document,h=function(t,e){l.addEventListener?l.addEventListener(t,e,!1):l.attachEvent&&l.attachEvent("on"+t,e)},u={},d=function(){u.TAGGING=u.TAGGING||[],u.TAGGING[1]=!0},p=/:[0-9]+$/,g=function(t,e,i){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].split("=");if(decodeURIComponent(s[0]).replace(/\+/g," ")===e)return e=s.slice(1).join("="),i?e:decodeURIComponent(e).replace(/\+/g," ")}},m=function(t,e){return e&&(e=String(e).toLowerCase()),"protocol"!==e&&"port"!==e||(t.protocol=b(t.protocol)||b(c.location.protocol)),"port"===e?t.port=String(Number(t.hostname?t.port:c.location.port)||("http"==t.protocol?80:"https"==t.protocol?443:"")):"host"===e&&(t.hostname=(t.hostname||c.location.hostname).replace(p,"").toLowerCase()),f(t,e,void 0,void 0,void 0)},f=function(t,e,i,n,s){var o=b(t.protocol);switch(e&&(e=String(e).toLowerCase()),e){case"url_no_fragment":n="",t&&t.href&&(n=0>(n=t.href.indexOf("#"))?t.href:t.href.substr(0,n)),t=n;break;case"protocol":t=o;break;case"host":t=t.hostname.replace(p,"").toLowerCase(),i&&(n=/^www\d*\./.exec(t))&&n[0]&&(t=t.substr(n[0].length));break;case"port":t=String(Number(t.port)||("http"==o?80:"https"==o?443:""));break;case"path":t.pathname||t.hostname||d();t:if(n=n||[],i=(t=(t="/"==t.pathname.substr(0,1)?t.pathname:"/"+t.pathname).split("/"))[t.length-1],Array.prototype.indexOf)n=n.indexOf(i),n="number"==typeof n?n:-1;else{for(s=0;s<n.length;s++)if(n[s]===i){n=s;break t}n=-1}0<=n&&(t[t.length-1]=""),t=t.join("/");break;case"query":t=t.search.replace("?",""),s&&(t=g(t,s,void 0));break;case"extension":t=(t=1<(t=t.pathname.split(".")).length?t[t.length-1]:"").split("/")[0];break;case"fragment":t=t.hash.replace("#","");break;default:t=t&&t.href}return t},b=function(t){return t?t.replace(":","").toLowerCase():""},y=function(t){var e=l.createElement("a");t&&(e.href=t);var i=e.pathname;return"/"!==i[0]&&(t||d(),i="/"+i),t=e.hostname.replace(p,""),{href:e.href,protocol:e.protocol,host:e.host,hostname:t,pathname:i,search:e.search,hash:e.hash,port:e.port}};function w(){for(var e=t,i={},n=0;n<e.length;++n)i[e[n]]=n;return i}function v(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return(t+=t.toLowerCase()+"0123456789-_")+"."}function L(i){t=t||v(),e=e||w();for(var n=[],s=0;s<i.length;s+=3){var o=s+1<i.length,a=s+2<i.length,r=i.charCodeAt(s),c=o?i.charCodeAt(s+1):0,l=a?i.charCodeAt(s+2):0,h=r>>2;r=(3&r)<<4|c>>4,c=(15&c)<<2|l>>6,l&=63,a||(l=64,o||(c=64)),n.push(t[h],t[r],t[c],t[l])}return n.join("")}function S(i){function n(t){for(;o<i.length;){var n=i.charAt(o++),s=e[n];if(null!=s)return s;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}t=t||v(),e=e||w();for(var s="",o=0;;){var a=n(-1),r=n(0),c=n(64),l=n(64);if(64===l&&-1===a)return s;s+=String.fromCharCode(a<<2|r>>4),64!=c&&(s+=String.fromCharCode(r<<4&240|c>>2),64!=l&&(s+=String.fromCharCode(c<<6&192|l)))}}var C=function(){var t=q,e=U,i=O(),n=function(e){t(e.target||e.srcElement||{})};if(!i.init){h("mousedown",n),h("keyup",n),h("submit",(function(t){e(t.target||t.srcElement||{})}));var s=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){e(this),s.call(this)},i.init=!0}},k=function(t,e,i,n,s){t={callback:t,domains:e,fragment:2===i,placement:i,forms:n,sameHost:s},O().decorators.push(t)},_=function(t,e,i){for(var n=O().decorators,s={},a=0;a<n.length;++a){var r,c=n[a];if(r=!i||c.forms)t:{r=c.domains;var h=t,u=!!c.sameHost;if(r&&(u||h!==l.location.hostname))for(var d=0;d<r.length;d++)if(r[d]instanceof RegExp){if(r[d].test(h)){r=!0;break t}}else if(0<=h.indexOf(r[d])||u&&0<=r[d].indexOf(h)){r=!0;break t}r=!1}r&&(null==(r=c.placement)&&(r=c.fragment?2:1),r===e&&o(s,c.callback()))}return s},O=function(){var t={},e=c.google_tag_data;return c.google_tag_data=void 0===e?t:e,(e=(t=c.google_tag_data).gl)&&e.decorators||(e={decorators:[]},t.gl=e),e},A=/(.*?)\*(.*?)\*(.*)/,x=/([^?#]+)(\?[^#]*)?(#.*)?/;function D(t){return new RegExp("(.*?)(^|&)"+t+"=([^&]*)&?(.*)")}var I=function(t){var e,i=[];for(e in t)if(t.hasOwnProperty(e)){var n=t[e];void 0!==n&&n==n&&null!==n&&"[object Object]"!==n.toString()&&(i.push(e),i.push(L(String(n))))}return t=i.join("*"),["1",T(t),t].join("*")},T=function(t,e){if(t=[window.navigator.userAgent,(new Date).getTimezoneOffset(),window.navigator.userLanguage||window.navigator.language,Math.floor((new Date).getTime()/60/1e3)-(void 0===e?0:e),t].join("*"),!(e=i)){e=Array(256);for(var n=0;256>n;n++){for(var s=n,o=0;8>o;o++)s=1&s?s>>>1^3988292384:s>>>1;e[n]=s}}for(i=e,e=4294967295,n=0;n<t.length;n++)e=e>>>8^i[255&(e^t.charCodeAt(n))];return((-1^e)>>>0).toString(36)};function P(t,e){if(t=D(t).exec(e)){var i=t[2],n=t[4];e=t[1],n&&(e=e+i+n)}return e}var N=function(t,e,i){function n(t,e){return(t=P("_gl",t)).length&&(t=e+t),t}if(c.history&&c.history.replaceState){var s=D("_gl");(s.test(e)||s.test(i))&&(t=m(t,"path"),e=n(e,"?"),i=n(i,"#"),c.history.replaceState({},void 0,""+t+e+i))}},E=function(t){var e=void 0===e?3:e;try{if(t){t:{for(var i=0;3>i;++i){var n=A.exec(t);if(n){var s=n;break t}t=decodeURIComponent(t)}s=void 0}if(s&&"1"===s[1]){var o=s[2],a=s[3];t:{for(s=0;s<e;++s)if(o===T(a,s)){var r=!0;break t}r=!1}if(r){e={};var c=a?a.split("*"):[];for(a=0;a<c.length;a+=2)e[c[a]]=S(c[a+1]);return e}}}}catch(t){}};function M(t,e,i,n){function s(e){var i=(e=P(t,e)).charAt(e.length-1);return e&&"&"!==i&&(e+="&"),e+r}n=void 0!==n&&n;var o=x.exec(i);if(!o)return"";i=o[1];var a=o[2]||"";o=o[3]||"";var r=t+"="+e;return n?o="#"+s(o.substring(1)):a="?"+s(a.substring(1)),""+i+a+o}function F(t,e){var i="FORM"===(t.tagName||"").toUpperCase(),n=_(e,1,i),s=_(e,2,i);for(var o in e=_(e,3,i),a(n)&&(n=I(n),i?B("_gl",n,t):R("_gl",n,t,!1)),!i&&a(s)&&R("_gl",i=I(s),t,!0),e)e.hasOwnProperty(o)&&j(o,e[o],t)}function j(t,e,i,n){if(i.tagName){if("a"===i.tagName.toLowerCase())return R(t,e,i,n);if("form"===i.tagName.toLowerCase())return B(t,e,i)}if("string"==typeof i)return M(t,e,i,n)}function R(t,e,i,n){i.href&&(t=M(t,e,i.href,void 0!==n&&n),r.test(t)&&(i.href=t))}function B(t,e,i){if(i&&i.action){var n=(i.method||"").toLowerCase();if("get"===n){n=i.childNodes||[];for(var s=!1,o=0;o<n.length;o++){var a=n[o];if(a.name===t){a.setAttribute("value",e),s=!0;break}}s||((n=l.createElement("input")).setAttribute("type","hidden"),n.setAttribute("name",t),n.setAttribute("value",e),i.appendChild(n))}else"post"===n&&(t=M(t,e,i.action),r.test(t)&&(i.action=t))}}var q=function(t){try{t:{for(var e=100;t&&0<e;){if(t.href&&t.nodeName.match(/^a(?:rea)?$/i)){var i=t;break t}t=t.parentNode,e--}i=null}if(i){var n=i.protocol;"http:"!==n&&"https:"!==n||F(i,i.hostname)}}catch(t){}},U=function(t){try{if(t.action)F(t,m(y(t.action),"host"))}catch(t){}};s("google_tag_data.glBridge.auto",(function(t,e,i,n){C(),k(t,e,"fragment"===i?2:1,!!n,!1)})),s("google_tag_data.glBridge.passthrough",(function(t,e,i){C(),k(t,[f(c.location,"host",!0)],e,!!i,!0)})),s("google_tag_data.glBridge.decorate",(function(t,e,i){return j("_gl",t=I(t),e,!!i)})),s("google_tag_data.glBridge.generate",I),s("google_tag_data.glBridge.get",(function(t,e){var i=function(t){return function(e){var i=y(c.location.href),n=i.search.replace("?",""),s=g(n,"_gl",!0);e.query=E(s||"")||{};var o=(s=m(i,"fragment")).match(D("_gl"));e.fragment=E(o&&o[3]||"")||{},t&&N(i,n,s)}}(!!e);return(e=O()).data||(e.data={query:{},fragment:{}},i(e.data)),i={},(e=e.data)&&(o(i,e.query),t&&o(i,e.fragment)),i}))}(window),function(){function t(t){var e,i=1;if(t)for(i=0,e=t.length-1;0<=e;e--){var n=t.charCodeAt(e);i=0!=(n=266338304&(i=(i<<6&268435455)+n+(n<<14)))?i^n>>21:i}return i}var e=function(t){this.C=t||[]};e.prototype.set=function(t){this.C[t]=!0},e.prototype.encode=function(){for(var t=[],e=0;e<this.C.length;e++)this.C[e]&&(t[Math.floor(e/6)]^=1<<e%6);for(e=0;e<t.length;e++)t[e]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(t[e]||0);return t.join("")+"~"};var i,o,a=window.GoogleAnalyticsObject;if((i=null!=a)&&(i=-1<(a.constructor+"").indexOf("String")),o=i){var r=window.GoogleAnalyticsObject;o=r?r.replace(/^[\s\xa0]+|[\s\xa0]+$/g,""):""}var c=o||"ga",l=/^(?:utma\.)?\d+\.\d+$/,h=/^amp-[\w.-]{22,64}$/,u=!1,d=new e;function p(t){d.set(t)}var g=function(t){t=m(t),t=new e(t);for(var i=d.C.slice(),n=0;n<t.C.length;n++)i[n]=i[n]||t.C[n];return new e(i).encode()},m=function(t){return t=t.get(He),b(t)||(t=[]),t},f=function(t){return"function"==typeof t},b=function(t){return"[object Array]"==Object.prototype.toString.call(Object(t))},y=function(t){return null!=t&&-1<(t.constructor+"").indexOf("String")},w=function(t,e){return 0==t.indexOf(e)},v=function(){for(var e=j.navigator.userAgent+(R.cookie?R.cookie:"")+(R.referrer?R.referrer:""),i=e.length,n=j.history.length;0<n;)e+=n--^i++;return[xt()^2147483647&t(e),Math.round((new Date).getTime()/1e3)].join(".")},L=function(){},S=function(t){return encodeURIComponent instanceof Function?encodeURIComponent(t):(p(28),t)},C=function(t,e,i,n){try{t.addEventListener?t.addEventListener(e,i,!!n):t.attachEvent&&t.attachEvent("on"+e,i)}catch(t){p(27)}},k=/^[\w\-:/.?=&%!\[\]]+$/,_=/^[\w+/_-]+[=]{0,2}$/,O=function(t,e,i){if(t){var n=R.querySelector&&R.querySelector("script[nonce]")||null;if(n=n&&(n.nonce||n.getAttribute&&n.getAttribute("nonce"))||"",i){var s=i="";e&&k.test(e)&&(i=' id="'+e+'"'),n&&_.test(n)&&(s=' nonce="'+n+'"'),k.test(t)&&R.write("<script"+i+s+' src="'+t+'"><\/script>')}else(i=R.createElement("script")).type="text/javascript",i.async=!0,i.src=t,e&&(i.id=e),n&&i.setAttribute("nonce",n),(t=R.getElementsByTagName("script")[0]).parentNode.insertBefore(i,t)}},A=function(t,e){return x(R.location[e?"href":"search"],t)},x=function(t,e){return(t=t.match("(?:&|#|\\?)"+S(e).replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")+"=([^&#]*)"))&&2==t.length?t[1]:""},D=function(){var t=""+R.location.hostname;return 0==t.indexOf("www.")?t.substring(4):t},I=function(t,e){var i=t.indexOf(e);return(5==i||6==i)&&("/"==(t=t.charAt(i+e.length))||"?"==t||""==t||":"==t)},T=function(t,e){if(1==e.length&&null!=e[0]&&"object"==typeof e[0])return e[0];for(var i={},n=Math.min(t.length+1,e.length),s=0;s<n;s++){if("object"==typeof e[s]){for(var o in e[s])e[s].hasOwnProperty(o)&&(i[o]=e[s][o]);break}s<t.length&&(i[t[s]]=e[s])}return i},P=function(){this.b=[],this.ea={},this.m={}};P.prototype.set=function(t,e,i){this.b.push(t),i?this.m[":"+t]=e:this.ea[":"+t]=e},P.prototype.get=function(t){return this.m.hasOwnProperty(":"+t)?this.m[":"+t]:this.ea[":"+t]},P.prototype.map=function(t){for(var e=0;e<this.b.length;e++){var i=this.b[e],n=this.get(i);n&&t(i,n)}};var N,E,M,F,j=window,R=document,B=function(t,e){return setTimeout(t,e)},q=window,U=document,H=function(t){var e=q._gaUserPrefs;if(e&&e.ioo&&e.ioo()||t&&!0===q["ga-disable-"+t])return!0;try{var i=q.external;if(i&&i._gaUserPrefs&&"oo"==i._gaUserPrefs)return!0}catch(t){}for(t=[],e=String(U.cookie).split(";"),i=0;i<e.length;i++){var n=e[i].split("="),s=n[0].replace(/^\s*|\s*$/g,"");s&&"AMP_TOKEN"==s&&((n=n.slice(1).join("=").replace(/^\s*|\s*$/g,""))&&(n=decodeURIComponent(n)),t.push(n))}for(e=0;e<t.length;e++)if("$OPT_OUT"==t[e])return!0;return!!U.getElementById("__gaOptOutExtension")},$=function(t){var e=[],i=R.cookie.split(";");t=new RegExp("^\\s*"+t+"=\\s*(.*?)\\s*$");for(var n=0;n<i.length;n++){var s=i[n].match(t);s&&e.push(s[1])}return e},W=function(t,e,i,n,s,o,a){if(!(s=!H(s)&&!(G.test(R.location.hostname)||"/"==i&&z.test(n))))return!1;if(e&&1200<e.length&&(e=e.substring(0,1200)),i=t+"="+e+"; path="+i+"; ",o&&(i+="expires="+new Date((new Date).getTime()+o).toGMTString()+"; "),n&&"none"!==n&&(i+="domain="+n+";"),a&&(i+=a+";"),n=R.cookie,R.cookie=i,!(n=n!=R.cookie))t:{for(t=$(t),n=0;n<t.length;n++)if(e==t[n]){n=!0;break t}n=!1}return n},V=function(t){return encodeURIComponent?encodeURIComponent(t).replace(/\(/g,"%28").replace(/\)/g,"%29"):t},z=/^(www\.)?google(\.com?)?(\.[a-z]{2})?$/,G=/(^|\.)doubleclick\.net$/i,Q=/^https?:\/\/[^/]*cdn\.ampproject\.org\//,J=/^(?:www\.|m\.|amp\.)+/,Y=[],K=function(t){if(st(t[Di])){var e;if(void 0===F)(e=(e=vn.get())&&e._ga||void 0)&&(F=e,p(81));if(void 0!==F)return t[ci]||(t[ci]=F),!1}if(t[Di]){if(p(67),t[Li]&&"cookie"!=t[Li])return!1;if(void 0!==F)t[ci]||(t[ci]=F);else{t:{e=String(t[gi]||D());var i=String(t[mi]||"/"),n=$(String(t[pi]||"_ga"));if(!(e=hn(n,e,i))||l.test(e))e=!0;else if(0==(e=$("AMP_TOKEN")).length)e=!0;else{if(1==e.length&&("$RETRIEVING"==(e=decodeURIComponent(e[0]))||"$OPT_OUT"==e||"$ERROR"==e||"$NOT_FOUND"==e)){e=!0;break t}e=!1}}if(e&&Z(X,String(t[di])))return!0}}return!1},X=function(){ms.D([L])},Z=function(t,e){var i=$("AMP_TOKEN");return 1<i.length?(p(55),!1):"$OPT_OUT"==(i=decodeURIComponent(i[0]||""))||"$ERROR"==i||H(e)?(p(62),!1):Q.test(R.referrer)||"$NOT_FOUND"!=i?void 0!==F?(p(56),B((function(){t(F)}),0),!0):N?(Y.push(t),!0):"$RETRIEVING"==i?(p(57),B((function(){Z(t,e)}),1e4),!0):(N=!0,i&&"$"!=i[0]||(it("$RETRIEVING",3e4),setTimeout(et,3e4),i=""),!!tt(i,e)&&(Y.push(t),!0)):(p(68),!1)},tt=function(t,e,i){if(!window.JSON)return p(58),!1;var n=j.XMLHttpRequest;if(!n)return p(59),!1;var o=new n;return"withCredentials"in o?(o.open("POST",(i||"https://ampcid.google.com/v1/publisher:getClientId")+"?key=AIzaSyA65lEHUEizIsNtlbNo-l2K18dT680nsaM",!0),o.withCredentials=!0,o.setRequestHeader("Content-Type","text/plain"),o.onload=function(){if(N=!1,4==o.readyState){try{200!=o.status&&(p(61),nt("","$ERROR",3e4));var n=JSON.parse(o.responseText);n.optOut?(p(63),nt("","$OPT_OUT",31536e6)):n.clientId?nt(n.clientId,n.securityToken,31536e6):!i&&n.alternateUrl?(E&&clearTimeout(E),N=!0,tt(t,e,n.alternateUrl)):(p(64),nt("","$NOT_FOUND",36e5))}catch(t){p(65),nt("","$ERROR",3e4)}o=null}},n={originScope:"AMP_ECID_GOOGLE"},t&&(n.securityToken=t),o.send(s(n)),E=B((function(){p(66),nt("","$ERROR",3e4)}),1e4),!0):(p(60),!1)},et=function(){N=!1},it=function(t,e){if(void 0===M){M="";for(var i=pn(),n=0;n<i.length;n++){var s=i[n];if(W("AMP_TOKEN",encodeURIComponent(t),"/",s,"",e))return void(M=s)}}W("AMP_TOKEN",encodeURIComponent(t),"/",M,"",e)},nt=function(t,e,i){for(E&&clearTimeout(E),e&&it(e,i),F=t,e=Y,Y=[],i=0;i<e.length;i++)e[i](t)},st=function(t){t:{if(Q.test(R.referrer)){var e=R.location.hostname.replace(J,"");e:{var i=R.referrer,n=(i=i.replace(/^https?:\/\//,"")).replace(/^[^/]+/,"").split("/"),s=n[2];if(!(n=(n="s"==s?n[3]:s)?decodeURIComponent(n):n)){if(0==i.indexOf("xn--")){i="";break e}(i=i.match(/(.*)\.cdn\.ampproject\.org\/?$/))&&2==i.length&&(n=i[1].replace(/-/g,".").replace(/\.\./g,"-"))}i=n?n.replace(J,""):""}if((n=e===i)||(i="."+i,n=e.substring(e.length-i.length,e.length)===i),n){e=!0;break t}p(78)}e=!1}return e&&!1!==t},ot=function(t){return(t||u||"https:"==R.location.protocol?"https:":"http:")+"//www.google-analytics.com"},at=function(t){switch(t){default:case 1:return"https://www.google-analytics.com/gtm/js?id=";case 2:return"https://www.googletagmanager.com/gtag/js?id="}},rt=function(t){this.name="len",this.message=t+"-8192"},ct=function(t,e,i){if(i=i||L,2036>=e.length)ht(t,e,i);else{if(!(8192>=e.length))throw mt("len",e.length),new rt(e.length);gt(t,e,i)||ut(t,e,i)||ht(t,e,i)}},lt=function(t,e,i,n){ut(t+"?"+e,"",n=n||L,i)},ht=function(t,e,i){var n=function(t){var e=R.createElement("img");return e.width=1,e.height=1,e.src=t,e}(t+"?"+e);n.onload=n.onerror=function(){n.onload=null,n.onerror=null,i()}},ut=function(t,e,i,n){var s=j.XMLHttpRequest;if(!s)return!1;var o=new s;return"withCredentials"in o&&(t=t.replace(/^http:/,"https:"),o.open("POST",t,!0),o.withCredentials=!0,o.setRequestHeader("Content-Type","text/plain"),o.onreadystatechange=function(){if(4==o.readyState){if(n&&"text/plain"===o.getResponseHeader("Content-Type"))try{dt(n,o.responseText,i)}catch(t){mt("xhr","rsp"),i()}else i();o=null}},o.send(e),!0)},dt=function(t,e,i){if(1>e.length)mt("xhr","ver","0"),i();else if(3<t.count++)mt("xhr","tmr",""+t.count),i();else{var n=e.charAt(0);if("1"===n)pt(t,e.substring(1),i);else if(t.V&&"2"===n){var s=e.substring(1).split(","),o=0;for(e=function(){++o===s.length&&i()},n=0;n<s.length;n++)pt(t,s[n],e)}else mt("xhr","ver",String(e.length)),i()}},pt=function(t,e,i){if(0===e.length)i();else{var n=e.charAt(0);switch(n){case"d":lt("https://stats.g.doubleclick.net/j/collect",t.U,t,i);break;case"g":ht("https://www.google.%/ads/ga-audiences".replace("%","com"),t.google,i),(e=e.substring(1))&&(/^[a-z.]{1,6}$/.test(e)?ht("https://www.google.%/ads/ga-audiences".replace("%",e),t.google,L):mt("tld","bcc",e));break;case"G":if(t.V){t.V("G-"+e.substring(1)),i();break}case"x":if(t.V){t.V(),i();break}default:mt("xhr","brc",n),i()}}},gt=function(t,e,i){return!!j.navigator.sendBeacon&&(!!j.navigator.sendBeacon(t,e)&&(i(),!0))},mt=function(t,e,i){1<=100*Math.random()||H("?")||(t=["t=error","_e="+t,"_v=j87","sr=1"],e&&t.push("_f="+e),i&&t.push("_m="+S(i.substring(0,100))),t.push("aip=1"),t.push("z="+xt()),ht(ot(!0)+"/u/d",t.join("&"),L))},ft=function(){return j.gaData=j.gaData||{}},bt=function(t){var e=ft();return e[t]=e[t]||{}},yt=function(){this.M=[]};function wt(e){if(100!=e.get(ki)&&t(Pt(e,ci))%1e4>=100*Nt(e,ki))throw"abort"}function vt(t){if(H(Pt(t,di)))throw"abort"}function Lt(){var t=R.location.protocol;if("http:"!=t&&"https:"!=t)throw"abort"}function St(t){try{j.navigator.sendBeacon?p(42):j.XMLHttpRequest&&"withCredentials"in new j.XMLHttpRequest&&p(40)}catch(t){}t.set(Ue,g(t),!0),t.set(Kt,Nt(t,Kt)+1);var e=[];Mt.map((function(i,n){n.F&&(null!=(i=t.get(i))&&i!=n.defaultValue&&("boolean"==typeof i&&(i*=1),e.push(n.F+"="+S(""+i))))})),!1===t.get(zi)&&e.push("npa=1"),e.push("z="+Dt()),t.set(Qt,e.join("&"),!0)}function Ct(t){var e=Pt(t,Yt);!e&&t.get(Jt)&&(e="beacon");var i=Pt(t,qi),n=Pt(t,Mi),s=i||(n||ot(!1)+"")+"/collect";switch(Pt(t,Wi)){case"d":s=i||(n||ot(!1)+"")+"/j/collect",e=t.get($i)||void 0,lt(s,Pt(t,Qt),e,t.Z(Gt));break;default:e?(i=Pt(t,Qt),n=(n=t.Z(Gt))||L,"image"==e?ht(s,i,n):"xhr"==e&&ut(s,i,n)||"beacon"==e&&gt(s,i,n)||ct(s,i,n)):ct(s,Pt(t,Qt),t.Z(Gt))}s=Pt(t,di),e=(s=bt(s)).hitcount,s.hitcount=e?e+1:1,s.first_hit||(s.first_hit=(new Date).getTime()),s=Pt(t,di),delete bt(s).pending_experiments,t.set(Gt,L,!0)}function kt(t){ft().expId&&t.set(Te,ft().expId),ft().expVar&&t.set(Pe,ft().expVar);var e=Pt(t,di);if(e=bt(e).pending_experiments){var i=[];for(n in e)e.hasOwnProperty(n)&&e[n]&&i.push(encodeURIComponent(n)+"."+encodeURIComponent(e[n]));var n=i.join("!")}else n=void 0;n&&((e=t.get(Ne))&&(n=e+"!"+n),t.set(Ne,n,!0))}function _t(){if(j.navigator&&"preview"==j.navigator.loadPurpose)throw"abort"}function Ot(t){var e=j.gaDevIds||[];if(b(e)){var i=t.get("&did");y(i)&&0<i.length&&(e=e.concat(i.split(","))),i=[];for(var n=0;n<e.length;n++){var s;t:{for(s=0;s<i.length;s++)if(e[n]==i[s]){s=!0;break t}s=!1}s||i.push(e[n])}0!=i.length&&t.set("&did",i.join(","),!0)}}function At(t){if(!t.get(di))throw"abort"}yt.prototype.add=function(t){this.M.push(t)},yt.prototype.D=function(t){try{for(var e=0;e<this.M.length;e++){var i=t.get(this.M[e]);i&&f(i)&&i.call(j,t)}}catch(t){}(e=t.get(Gt))!=L&&f(e)&&(t.set(Gt,L,!0),setTimeout(e,10))};var xt=function(){return Math.round(2147483647*Math.random())},Dt=function(){try{var t=new Uint32Array(1);return j.crypto.getRandomValues(t),2147483647&t[0]}catch(t){return xt()}};function It(t){var e=Nt(t,je);500<=e&&p(15);var i=Pt(t,zt);if("transaction"!=i&&"item"!=i){i=Nt(t,Be);var n=(new Date).getTime(),s=Nt(t,Re);if(0==s&&t.set(Re,n),0<(s=Math.round(2*(n-s)/1e3))&&(i=Math.min(i+s,20),t.set(Re,n)),0>=i)throw"abort";t.set(Be,--i)}t.set(je,++e)}var Tt=function(){this.data=new P};Tt.prototype.get=function(t){var e=Rt(t),i=this.data.get(t);return e&&null==i&&(i=f(e.defaultValue)?e.defaultValue():e.defaultValue),e&&e.Z?e.Z(this,t,i):i};var Pt=function(t,e){return null==(t=t.get(e))?"":""+t},Nt=function(t,e){return null==(t=t.get(e))||""===t?0:Number(t)};Tt.prototype.Z=function(t){return(t=this.get(t))&&f(t)?t:L},Tt.prototype.set=function(t,e,i){if(t)if("object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&Et(this,n,t[n],i);else Et(this,t,e,i)};var Et=function(t,e,i,n){if(null!=i)switch(e){case di:Jn.test(i)}var s=Rt(e);s&&s.o?s.o(t,e,i,n):t.data.set(e,i,n)},Mt=new P,Ft=[],jt=function(t,e,i,n,s){this.name=t,this.F=e,this.Z=n,this.o=s,this.defaultValue=i},Rt=function(t){var e=Mt.get(t);if(!e)for(var i=0;i<Ft.length;i++){var n=Ft[i],s=n[0].exec(t);if(s){e=n[1](s),Mt.set(e.name,e);break}}return e},Bt=function(t,e,i,n,s){return t=new jt(t,e,i,n,s),Mt.set(t.name,t),t.name},qt=function(t,e){Ft.push([new RegExp("^"+t+"$"),e])},Ut=function(t,e,i){return Bt(t,e,i,void 0,Ht)},Ht=function(){},$t=Ut("apiVersion","v"),Wt=Ut("clientVersion","_v");Bt("anonymizeIp","aip");var Vt=Bt("adSenseId","a"),zt=Bt("hitType","t"),Gt=Bt("hitCallback"),Qt=Bt("hitPayload");Bt("nonInteraction","ni"),Bt("currencyCode","cu"),Bt("dataSource","ds");var Jt=Bt("useBeacon",void 0,!1),Yt=Bt("transport");Bt("sessionControl","sc",""),Bt("sessionGroup","sg"),Bt("queueTime","qt");var Kt=Bt("_s","_s");Bt("screenName","cd");var Xt=Bt("location","dl",""),Zt=Bt("referrer","dr"),te=Bt("page","dp","");Bt("hostname","dh");var ee=Bt("language","ul"),ie=Bt("encoding","de");Bt("title","dt",(function(){return R.title||void 0})),qt("contentGroup([0-9]+)",(function(t){return new jt(t[0],"cg"+t[1])}));var ne=Bt("screenColors","sd"),se=Bt("screenResolution","sr"),oe=Bt("viewportSize","vp"),ae=Bt("javaEnabled","je"),re=Bt("flashVersion","fl");Bt("campaignId","ci"),Bt("campaignName","cn"),Bt("campaignSource","cs"),Bt("campaignMedium","cm"),Bt("campaignKeyword","ck"),Bt("campaignContent","cc");var ce=Bt("eventCategory","ec"),le=Bt("eventAction","ea"),he=Bt("eventLabel","el"),ue=Bt("eventValue","ev"),de=Bt("socialNetwork","sn"),pe=Bt("socialAction","sa"),ge=Bt("socialTarget","st"),me=Bt("l1","plt"),fe=Bt("l2","pdt"),be=Bt("l3","dns"),ye=Bt("l4","rrt"),we=Bt("l5","srt"),ve=Bt("l6","tcp"),Le=Bt("l7","dit"),Se=Bt("l8","clt"),Ce=Bt("l9","_gst"),ke=Bt("l10","_gbt"),_e=Bt("l11","_cst"),Oe=Bt("l12","_cbt"),Ae=Bt("timingCategory","utc"),xe=Bt("timingVar","utv"),De=Bt("timingLabel","utl"),Ie=Bt("timingValue","utt");Bt("appName","an"),Bt("appVersion","av",""),Bt("appId","aid",""),Bt("appInstallerId","aiid",""),Bt("exDescription","exd"),Bt("exFatal","exf");var Te=Bt("expId","xid"),Pe=Bt("expVar","xvar"),Ne=Bt("exp","exp"),Ee=Bt("_utma","_utma"),Me=Bt("_utmz","_utmz"),Fe=Bt("_utmht","_utmht"),je=Bt("_hc",void 0,0),Re=Bt("_ti",void 0,0),Be=Bt("_to",void 0,20);qt("dimension([0-9]+)",(function(t){return new jt(t[0],"cd"+t[1])})),qt("metric([0-9]+)",(function(t){return new jt(t[0],"cm"+t[1])})),Bt("linkerParam",void 0,void 0,(function(t){if(t.get(qe))return p(35),vn.generate(In(t));var e=Pt(t,ci),i=Pt(t,Ai)||"";return e="_ga=2."+S(kn(i+e,0)+"."+i+"-"+e),(t=Tn(t))?(p(44),t="&_gac=1."+S([kn(t.qa,0),t.timestamp,t.qa].join("."))):t="",e+t}),Ht);var qe=Ut("_cd2l",void 0,!1),Ue=Bt("usage","_u"),He=Bt("_um");Bt("forceSSL",void 0,void 0,(function(){return u}),(function(t,e,i){p(34),u=!!i}));var $e=Bt("_j1","jid"),We=Bt("_j2","gjid");qt("\\&(.*)",(function(t){var e=new jt(t[0],t[1]),i=function(t){var e;return Mt.map((function(i,n){n.F==t&&(e=n)})),e&&e.name}(t[0].substring(1));return i&&(e.Z=function(t){return t.get(i)},e.o=function(t,e,n,s){t.set(i,n,s)},e.F=void 0),e}));var Ve=Ut("_oot"),ze=Bt("previewTask"),Ge=Bt("checkProtocolTask"),Qe=Bt("validationTask"),Je=Bt("checkStorageTask"),Ye=Bt("historyImportTask"),Ke=Bt("samplerTask"),Xe=Bt("_rlt"),Ze=Bt("buildHitTask"),ti=Bt("sendHitTask"),ei=Bt("ceTask"),ii=Bt("devIdTask"),ni=Bt("timingTask"),si=Bt("displayFeaturesTask"),oi=Bt("customTask"),ai=Bt("fpsCrossDomainTask"),ri=Ut("name"),ci=Ut("clientId","cid"),li=Ut("clientIdTime"),hi=Ut("storedClientId"),ui=Bt("userId","uid"),di=Ut("trackingId","tid"),pi=Ut("cookieName",void 0,"_ga"),gi=Ut("cookieDomain"),mi=Ut("cookiePath",void 0,"/"),fi=Ut("cookieExpires",void 0,63072e3),bi=Ut("cookieUpdate",void 0,!0),yi=Ut("cookieFlags",void 0,""),wi=Ut("legacyCookieDomain"),vi=Ut("legacyHistoryImport",void 0,!0),Li=Ut("storage",void 0,"cookie"),Si=Ut("allowLinker",void 0,!1),Ci=Ut("allowAnchor",void 0,!0),ki=Ut("sampleRate","sf",100),_i=Ut("siteSpeedSampleRate",void 0,1),Oi=Ut("alwaysSendReferrer",void 0,!1),Ai=Ut("_gid","_gid"),xi=Ut("_gcn"),Di=Ut("useAmpClientId"),Ii=Ut("_gclid"),Ti=Ut("_gt"),Pi=Ut("_ge",void 0,7776e6),Ni=Ut("_gclsrc"),Ei=Ut("storeGac",void 0,!0),Mi=Bt("_x_19"),Fi=Bt("_fplc","_fplc"),ji=Ut("_cs"),Ri=Ut("_useUp",void 0,!1),Bi=Bt("up","up"),qi=Bt("transportUrl"),Ui=Bt("_r","_r"),Hi=Bt("_slc","_slc"),$i=Bt("_dp"),Wi=Bt("_jt",void 0,"n"),Vi=Bt("allowAdFeatures",void 0,!0),zi=Bt("allowAdPersonalizationSignals",void 0,!0);function Gi(t,e,i,n){e[t]=function(){try{return n&&p(n),i.apply(this,arguments)}catch(e){throw mt("exc",t,e&&e.name),e}}}var Qi=function(t){if("cookie"==t.get(Li))return 0<(t=$("FPLC")).length?t[0]:void 0},Ji=function(t){var e;(e=Pt(t,Mi)&&t.get(qe))&&(e=!((e=vn.get(t.get(Ci)))&&e._fplc)),e&&t.set(Fi,Qi(t)||"0")},Yi=function(t){var e={};if(Ki(e)||Xi(e)){var i=e[me];null==i||1/0==i||isNaN(i)||(0<i?(Zi(e,be),Zi(e,ve),Zi(e,we),Zi(e,fe),Zi(e,ye),Zi(e,Le),Zi(e,Se),Zi(e,Ce),Zi(e,ke),Zi(e,_e),Zi(e,Oe),B((function(){t(e)}),10)):C(j,"load",(function(){Yi(t)}),!1))}},Ki=function(t){var e=j.performance||j.webkitPerformance;if(!(e=e&&e.timing))return!1;var i=e.navigationStart;return 0!=i&&(t[me]=e.loadEventStart-i,t[be]=e.domainLookupEnd-e.domainLookupStart,t[ve]=e.connectEnd-e.connectStart,t[we]=e.responseStart-e.requestStart,t[fe]=e.responseEnd-e.responseStart,t[ye]=e.fetchStart-i,t[Le]=e.domInteractive-i,t[Se]=e.domContentLoadedEventStart-i,t[Ce]=fs.L-i,t[ke]=fs.ya-i,j.google_tag_manager&&j.google_tag_manager._li&&(e=j.google_tag_manager._li,t[_e]=e.cst,t[Oe]=e.cbt),!0)},Xi=function(t){if(j.top!=j)return!1;var e=j.external,i=e&&e.onloadT;return e&&!e.isValidLoadTime&&(i=void 0),2147483648<i&&(i=void 0),0<i&&e.setPageReadyTime(),null!=i&&(t[me]=i,!0)},Zi=function(t,e){var i=t[e];(isNaN(i)||1/0==i||0>i)&&(t[e]=void 0)},tn=function(e){return function(i){if("pageview"==i.get(zt)&&!e.I){e.I=!0;var n=function(e){var i=Math.min(Nt(e,_i),100);return!(t(Pt(e,ci))%100>=i)}(i),s=0<x(Pt(i,Xt),"gclid").length;(n||s)&&Yi((function(t){n&&e.send("timing",t),s&&e.send("adtiming",t)}))}}},en=!1,nn=function(t){if("cookie"==Pt(t,Li)){if(t.get(bi)||Pt(t,hi)!=Pt(t,ci)){var e=1e3*Nt(t,fi);sn(t,ci,pi,e),t.data.set(hi,Pt(t,ci))}if((t.get(bi)||on(t)!=Pt(t,Ai))&&sn(t,Ai,xi,864e5),t.get(Ei)){var i=Pt(t,Ii);if(i){var n=Math.min(Nt(t,Pi),1e3*Nt(t,fi));n=Math.min(n,1e3*Nt(t,Ti)+n-(new Date).getTime()),t.data.set(Pi,n),e={};var s=Pt(t,Ti),o=Pt(t,Ni),a=gn(Pt(t,mi)),r=dn(Pt(t,gi)),c=Pt(t,di);t=Pt(t,yi),o&&"aw.ds"!=o?e&&(e.ua=!0):(i=["1",s,V(i)].join("."),0<n&&(e&&(e.ta=!0),W("_gac_"+V(c),i,a,r,c,n,t))),fn(e)}}else p(75)}},sn=function(t,e,i,n){var s=cn(t,e);if(s){i=Pt(t,i);var o=gn(Pt(t,mi)),a=dn(Pt(t,gi)),r=Pt(t,yi),c=Pt(t,di);if("auto"!=a)W(i,s,o,a,c,n,r)&&(en=!0);else{p(32);for(var l=pn(),h=0;h<l.length;h++)if(a=l[h],t.data.set(gi,a),s=cn(t,e),W(i,s,o,a,c,n,r))return void(en=!0);t.data.set(gi,"auto")}}},on=function(t){var e=$(Pt(t,xi));return ln(t,e)},an=function(t){if("cookie"==Pt(t,Li)&&!en&&(nn(t),!en))throw"abort"},rn=function(t){if(t.get(vi)){var e=Pt(t,gi),i=Pt(t,wi)||D(),n=bn("__utma",i,e);n&&(p(19),t.set(Fe,(new Date).getTime(),!0),t.set(Ee,n.R),(e=bn("__utmz",i,e))&&n.hash==e.hash&&t.set(Me,e.R))}},cn=function(t,e){e=V(Pt(t,e));var i=dn(Pt(t,gi)).split(".").length;return 1<(t=mn(Pt(t,mi)))&&(i+="-"+t),e?["GA1",i,e].join("."):""},ln=function(t,e){return hn(e,Pt(t,gi),Pt(t,mi))},hn=function(t,e,i){if(!t||1>t.length)p(12);else{for(var n=[],s=0;s<t.length;s++){var o=t[s],a=o.split("."),r=a.shift();("GA1"==r||"1"==r)&&1<a.length?(1==(o=a.shift().split("-")).length&&(o[1]="1"),o[0]*=1,o[1]*=1,a={H:o,s:a.join(".")}):a=h.test(o)?{H:[0,0],s:o}:void 0,a&&n.push(a)}if(1==n.length)return p(13),n[0].s;if(0!=n.length)return p(14),1==(n=un(n,dn(e).split(".").length,0)).length?n[0].s:(1<(n=un(n,mn(i),1)).length&&p(41),n[0]&&n[0].s);p(12)}},un=function(t,e,i){for(var n,s=[],o=[],a=0;a<t.length;a++){var r=t[a];r.H[i]==e?s.push(r):null==n||r.H[i]<n?(o=[r],n=r.H[i]):r.H[i]==n&&o.push(r)}return 0<s.length?s:o},dn=function(t){return 0==t.indexOf(".")?t.substr(1):t},pn=function(){var t=[],e=D().split(".");if(4==e.length){var i=e[e.length-1];if(n(i,10)==i)return["none"]}for(i=e.length-2;0<=i;i--)t.push(e.slice(i).join("."));return e=R.location.hostname,G.test(e)||z.test(e)||t.push("none"),t},gn=function(t){return t?(1<t.length&&t.lastIndexOf("/")==t.length-1&&(t=t.substr(0,t.length-1)),0!=t.indexOf("/")&&(t="/"+t),t):"/"},mn=function(t){return"/"==(t=gn(t))?1:t.split("/").length},fn=function(t){t.ta&&p(77),t.na&&p(74),t.pa&&p(73),t.ua&&p(69)};function bn(t,e,i){"none"==e&&(e="");var n=[],s=$(t);t="__utma"==t?6:2;for(var o=0;o<s.length;o++){var a=(""+s[o]).split(".");a.length>=t&&n.push({hash:a[0],R:s[o],O:a})}if(0!=n.length)return 1==n.length?n[0]:yn(e,n)||yn(i,n)||yn(null,n)||n[0]}function yn(e,i){if(null==e)var n=e=1;else n=t(e),e=t(w(e,".")?e.substring(1):"."+e);for(var s=0;s<i.length;s++)if(i[s].hash==n||i[s].hash==e)return i[s]}var wn=new RegExp(/^https?:\/\/([^\/:]+)/),vn=j.google_tag_data.glBridge,Ln=/(.*)([?&#])(?:_ga=[^&#]*)(?:&?)(.*)/,Sn=/(.*)([?&#])(?:_gac=[^&#]*)(?:&?)(.*)/;function Cn(e,i){var n=new Date,s=j.navigator,o=s.plugins||[];for(e=[e,s.userAgent,n.getTimezoneOffset(),n.getYear(),n.getDate(),n.getHours(),n.getMinutes()+i],i=0;i<o.length;++i)e.push(o[i].description);return t(e.join("."))}function kn(e,i){var n=new Date,s=j.navigator,o=n.getHours()+Math.floor((n.getMinutes()+i)/60);return t([e,s.userAgent,s.language||"",n.getTimezoneOffset(),n.getYear(),n.getDate()+Math.floor(o/24),(24+o)%24,(60+n.getMinutes()+i)%60].join("."))}var _n=function(t){p(48),this.target=t,this.T=!1};_n.prototype.ca=function(t,e){if(t){if(this.target.get(qe))return vn.decorate(In(this.target),t,e);if(t.tagName){if("a"==t.tagName.toLowerCase())return void(t.href&&(t.href=On(this,t.href,e)));if("form"==t.tagName.toLowerCase())return An(this,t)}if("string"==typeof t)return On(this,t,e)}};var On=function(t,e,i){var n=Ln.exec(e);n&&3<=n.length&&(e=n[1]+(n[3]?n[2]+n[3]:"")),(n=Sn.exec(e))&&3<=n.length&&(e=n[1]+(n[3]?n[2]+n[3]:"")),t=t.target.get("linkerParam");var s=e.indexOf("?");return n=e.indexOf("#"),i?e+=(-1==n?"#":"&")+t:(i=-1==s?"?":"&",e=-1==n?e+(i+t):e.substring(0,n)+i+t+e.substring(n)),(e=e.replace(/&+_ga=/,"&_ga=")).replace(/&+_gac=/,"&_gac=")},An=function(t,e){if(e&&e.action)if("get"==e.method.toLowerCase()){t=t.target.get("linkerParam").split("&");for(var i=0;i<t.length;i++){var n=t[i].split("="),s=n[1];n=n[0];for(var o=e.childNodes||[],a=!1,r=0;r<o.length;r++)if(o[r].name==n){o[r].setAttribute("value",s),a=!0;break}a||((o=R.createElement("input")).setAttribute("type","hidden"),o.setAttribute("name",n),o.setAttribute("value",s),e.appendChild(o))}}else"post"==e.method.toLowerCase()&&(e.action=On(t,e.action))};function xn(t,e){if(e==R.location.hostname)return!1;for(var i=0;i<t.length;i++)if(t[i]instanceof RegExp){if(t[i].test(e))return!0}else if(0<=e.indexOf(t[i]))return!0;return!1}function Dn(t,e){return e!=Cn(t,0)&&e!=Cn(t,-1)&&e!=Cn(t,-2)&&e!=kn(t,0)&&e!=kn(t,-1)&&e!=kn(t,-2)}function In(t){var e=Tn(t),i={};return i._ga=t.get(ci),i._gid=t.get(Ai)||void 0,i._gac=e?[e.qa,e.timestamp].join("."):void 0,e=t.get(Fi),t=Qi(t),i._fplc=e&&"0"!==e?e:t,i}function Tn(t){function e(t){return null==t||""===t?0:Number(t)}var i=t.get(Ii);if(i&&t.get(Ei)){var n=e(t.get(Ti));if(!(1e3*n+e(t.get(Pi))<=(new Date).getTime()))return{timestamp:n,qa:i};p(76)}}_n.prototype.S=function(t,e,i){function n(i){try{i=i||j.event;t:{var n=i.target||i.srcElement;for(i=100;n&&0<i;){if(n.href&&n.nodeName.match(/^a(?:rea)?$/i)){var o=n;break t}n=n.parentNode,i--}o={}}("http:"==o.protocol||"https:"==o.protocol)&&xn(t,o.hostname||"")&&o.href&&(o.href=On(s,o.href,e))}catch(t){p(26)}}var s=this;this.target.get(qe)?vn.auto((function(){return In(s.target)}),t,e?"fragment":"",i):(this.T||(this.T=!0,C(R,"mousedown",n,!1),C(R,"keyup",n,!1)),i&&C(R,"submit",(function(e){if((e=(e=e||j.event).target||e.srcElement)&&e.action){var i=e.action.match(wn);i&&xn(t,i[1])&&An(s,e)}})))},_n.prototype.$=function(t){if(t){var e=this,i=e.target.get(ji);void 0!==i&&vn.passthrough((function(){if(i("analytics_storage"))return{};var t={};return t._ga=e.target.get(ci),t._up="1",t}),1,!0)}};var Pn=/^(GTM|OPT)-[A-Z0-9]+$/,Nn=/^G-[A-Z0-9]+$/,En=/;_gaexp=[^;]*/g,Mn=/;((__utma=)|([^;=]+=GAX?\d+\.))[^;]*/g,Fn=/^https?:\/\/[\w\-.]+\.google.com(:\d+)?\/optimize\/opt-launch\.html\?.*$/,jn=function(t,e,i,n){i=i||{};var s=1;Nn.test(e)&&(s=2);var o={id:e,type:s,B:i.dataLayer||"dataLayer",G:!1},a=void 0;return t.get("&gtm")==e&&(o.G=!0),1===s?(o.ia=!!t.get("anonymizeIp"),o.sync=n,"t0"!=(e=String(t.get("name")))&&(o.target=e),H(String(t.get("trackingId")))||(o.clientId=String(t.get(ci)),o.ka=Number(t.get(li)),i=i.palindrome?Mn:En,i=(i=R.cookie.replace(/^|(; +)/g,";").match(i))?i.sort().join("").substring(1):void 0,o.la=i,o.qa=x(Pt(t,Xt),"gclid"))):2===s&&(o.context="c",a={allow_google_signals:t.get(Vi),allow_ad_personalization_signals:t.get(zi)}),function(t,e){var i=(new Date).getTime();j[t.B]=j[t.B]||[],i={"gtm.start":i},t.sync||(i.event="gtm.js"),j[t.B].push(i),2===t.type&&function(e,i,n){j[t.B].push(arguments)}("config",t.id,e)}(o,a),function(t){function e(t,e){e&&(i+="&"+t+"="+S(e))}var i=at(t.type)+S(t.id);return"dataLayer"!=t.B&&e("l",t.B),e("cx",t.context),e("t",t.target),e("cid",t.clientId),e("cidt",t.ka),e("gac",t.la),e("aip",t.ia),t.sync&&e("m","sync"),e("cycle",t.G),t.qa&&e("gclid",t.qa),Fn.test(R.referrer)&&e("cb",String(xt())),i}(o)},Rn={},Bn=function(t,e){e||(e=(e=Pt(t,ri))&&"t0"!=e?zn.test(e)?"_gat_"+V(Pt(t,di)):"_gat_"+V(e):"_gat"),this.Y=e},qn=function(t,e,i){!1===e.get(Vi)||e.get(i)||("1"==$(t.Y)[0]?e.set(i,"",!0):e.set(i,""+xt(),!0))},Un=function(t,e){Hn(e)&&W(t.Y,"1",Pt(e,mi),Pt(e,gi),Pt(e,di),6e4,Pt(e,yi))},Hn=function(t){return!!t.get($e)&&!1!==t.get(Vi)},$n=function(t){return!Rn[Pt(t,di)]&&void 0===t.get("&gtm")&&void 0===t.get(Yt)&&void 0===t.get(qi)&&void 0===t.get(Mi)},Wn=function(t,e){var i=new P,n=function(e){Rt(e).F&&i.set(Rt(e).F,t.get(e))};n($t),n(Wt),n(di),n(ci),n($e),1==e&&(n(ui),n(We),n(Ai)),!1===t.get(zi)&&i.set("npa","1"),i.set(Rt(Ue).F,g(t));var s="";return i.map((function(t,e){s+=S(t)+"=",s+=S(""+e)+"&"})),s+="z="+xt(),1==e?s="t=dc&aip=1&_r=3&"+s:2==e&&(s="t=sr&aip=1&_r=4&slf_rd=1&"+s),s},Vn=function(t){if($n(t))return Rn[Pt(t,di)]=!0,function(e){if(e&&!Rn[e]){var i=jn(t,e);O(i),Rn[e]=!0}}},zn=/^gtm\d+$/,Gn=function(t,i){if(!(t=t.model).get("dcLoaded")){var n,s=new e(m(t));s.set(29),t.set(He,s.C),(i=i||{})[pi]&&(n=V(i[pi])),function(t,e){var i=e.get(Ze);e.set(Ze,(function(e){qn(t,e,$e),qn(t,e,We);var n=i(e);return Un(t,e),n}));var n=e.get(ti);e.set(ti,(function(t){var e=n(t);if(Hn(t)){p(80);var i={U:Wn(t,1),google:Wn(t,2),count:0};lt("https://stats.g.doubleclick.net/j/collect",i.U,i),t.set($e,"",!0)}return e}))}(i=new Bn(t,n),t),t.set("dcLoaded",!0)}},Qn=function(t){if(!t.get("dcLoaded")&&"cookie"==t.get(Li)){var e=new Bn(t);qn(e,t,$e),qn(e,t,We),Un(e,t),e=Hn(t);var i=$n(t);e&&t.set(Ui,1,!0),i&&t.set(Hi,1,!0),(e||i)&&(t.set(Wi,"d",!0),p(79),t.set($i,{U:Wn(t,1),google:Wn(t,2),V:Vn(t),count:0},!0))}},Jn=/^(UA|YT|MO|GP)-(\d+)-(\d+)$/,Yn=function(t){function e(t,e){n.model.data.set(t,e)}function i(t,i){e(t,i),n.filters.add(t)}var n=this;this.model=new Tt,this.filters=new yt,e(ri,t[ri]),e(di,function(t){return t?t.replace(/^[\s\xa0]+|[\s\xa0]+$/g,""):""}(t[di])),e(pi,t[pi]),e(gi,t[gi]||D()),e(mi,t[mi]),e(fi,t[fi]),e(bi,t[bi]),e(yi,t[yi]),e(wi,t[wi]),e(vi,t[vi]),e(Si,t[Si]),e(Ci,t[Ci]),e(ki,t[ki]),e(_i,t[_i]),e(Oi,t[Oi]),e(Li,t[Li]),e(ui,t[ui]),e(li,t[li]),e(Di,t[Di]),e(Ei,t[Ei]),e(qe,t[qe]),e(Mi,t[Mi]),e(Ri,t[Ri]),e(ji,t[ji]),e($t,1),e(Wt,"j87"),i(Ve,vt),i(oi,L),i(ze,_t),i(Ge,Lt),i(Qe,At),i(Je,an),i(Ye,rn),i(Ke,wt),i(Xe,It),i(ei,kt),i(ii,Ot),i(si,Qn),i(ai,Ji),i(Ze,St),i(ti,Ct),i(ni,tn(this)),is(this.model),es(this.model,t[ci]),this.model.set(Vt,function(){var t=j.gaGlobal=j.gaGlobal||{};return t.hid=t.hid||xt()}())};Yn.prototype.get=function(t){return this.model.get(t)},Yn.prototype.set=function(t,e){this.model.set(t,e)},Yn.prototype.send=function(t){if(!(1>arguments.length)){if("string"==typeof arguments[0])var e=arguments[0],i=[].slice.call(arguments,1);else e=arguments[0]&&arguments[0][zt],i=arguments;e&&((i=T(ns[e]||[],i))[zt]=e,this.model.set(i,void 0,!0),this.filters.D(this.model),this.model.data.m={})}},Yn.prototype.ma=function(t,e){var i=this;ls(t,i,e)||(us(t,(function(){ls(t,i,e)})),hs(String(i.get(ri)),t,void 0,e,!0))};var Kn,Xn,Zn,ts,es=function(t,e){var i=Pt(t,pi);if(t.data.set(xi,"_ga"==i?"_gid":i+"_gid"),"cookie"==Pt(t,Li)){if(en=!1,i=$(Pt(t,pi)),!(i=ln(t,i))){i=Pt(t,gi);var n=Pt(t,wi)||D();null!=(i=bn("__utma",n,i))?(p(10),i=i.O[1]+"."+i.O[2]):i=void 0}if(i&&(en=!0),n=i&&!t.get(bi))if(2!=(n=i.split(".")).length)n=!1;else if(n=Number(n[1])){var s=Nt(t,fi);n=n+s<(new Date).getTime()/1e3}else n=!1;if(n&&(i=void 0),i&&(t.data.set(hi,i),t.data.set(ci,i),(i=on(t))&&t.data.set(Ai,i)),t.get(Ei)&&(i=t.get(Ii),n=t.get(Ni),!i||n&&"aw.ds"!=n)){if(i={},R){n=[],s=R.cookie.split(";");for(var o=/^\s*_gac_(UA-\d+-\d+)=\s*(.+?)\s*$/,a=0;a<s.length;a++){var r=s[a].match(o);r&&n.push({ja:r[1],value:r[2]})}if(s={},n&&n.length)for(o=0;o<n.length;o++)"1"!=(a=n[o].value.split("."))[0]||3!=a.length?i&&(i.na=!0):a[1]&&(s[n[o].ja]?i&&(i.pa=!0):s[n[o].ja]=[],s[n[o].ja].push({timestamp:a[1],qa:a[2]}));n=s}else n={};n=n[Pt(t,di)],fn(i),n&&0!=n.length&&(i=n[0],t.data.set(Ti,i.timestamp),t.data.set(Ii,i.qa))}}if(t.get(bi)&&(i=A("_ga",!!t.get(Ci)),o=A("_gl",!!t.get(Ci)),s=(n=vn.get(t.get(Ci)))._ga,o&&0<o.indexOf("_ga*")&&!s&&p(30),e||!t.get(Ri)?o=!1:void 0===(o=t.get(ji))||o("analytics_storage")?o=!1:(p(84),t.data.set(Bi,1),(o=n._up)&&((o=wn.exec(R.referrer))?(o=o[1],o=(a=R.location.hostname)===o||0<=a.indexOf("."+o)||0<=o.indexOf("."+a)):o=!1),o=!!o),a=n.gclid,r=n._gac,i||s||a||r))if(i&&s&&p(36),t.get(Si)||st(t.get(Di))||o){if(s&&(p(38),t.data.set(ci,s),n._gid&&(p(51),t.data.set(Ai,n._gid))),a?(p(82),t.data.set(Ii,a),n.gclsrc&&t.data.set(Ni,n.gclsrc)):r&&(s=r.split("."))&&2===s.length&&(p(37),t.data.set(Ii,s[0]),t.data.set(Ti,s[1])),(n=n._fplc)&&(p(83),t.data.set(Fi,n)),i)t:if(n=i.indexOf("."),-1==n)p(22);else{if(s=i.substring(0,n),n=(o=i.substring(n+1)).indexOf("."),i=o.substring(0,n),o=o.substring(n+1),"1"==s){if(Dn(n=o,i)){p(23);break t}}else{if("2"!=s){p(22);break t}if(s="",0<(n=o.indexOf("-"))?(s=o.substring(0,n),n=o.substring(n+1)):n=o.substring(1),Dn(s+n,i)){p(53);break t}s&&(p(2),t.data.set(Ai,s))}p(11),t.data.set(ci,n),(i=A("_gac",!!t.get(Ci)))&&("1"!=(i=i.split("."))[0]||4!=i.length?p(72):Dn(i[3],i[1])?p(71):(t.data.set(Ii,i[3]),t.data.set(Ti,i[2]),p(70)))}}else p(21);e&&(p(9),t.data.set(ci,S(e))),t.get(ci)||((e=(e=j.gaGlobal)&&e.from_cookie&&"cookie"!==Pt(t,Li)?void 0:(e=e&&e.vid)&&-1!==e.search(l)?e:void 0)?(p(17),t.data.set(ci,e)):(p(8),t.data.set(ci,v()))),t.get(Ai)||(p(3),t.data.set(Ai,v())),nn(t),e=j.gaGlobal=j.gaGlobal||{},t=(i=Pt(t,ci))===Pt(t,hi),(null==e.vid||t&&!e.from_cookie)&&(e.vid=i,e.from_cookie=t)},is=function(t){var e=j.navigator,i=j.screen,n=R.location;if(t.set(Zt,function(t,e){var i=R.referrer;if(/^(https?|android-app):\/\//i.test(i)){if(t)return i;if(t="//"+R.location.hostname,!I(i,t))return e&&(e=t.replace(/\./g,"-")+".cdn.ampproject.org",I(i,e))?void 0:i}}(!!t.get(Oi),!!t.get(Di))),n){var s=n.pathname||"";"/"!=s.charAt(0)&&(p(31),s="/"+s),t.set(Xt,n.protocol+"//"+n.hostname+s+n.search)}i&&t.set(se,i.width+"x"+i.height),i&&t.set(ne,i.colorDepth+"-bit"),i=R.documentElement;var o=(s=R.body)&&s.clientWidth&&s.clientHeight,a=[];if(i&&i.clientWidth&&i.clientHeight&&("CSS1Compat"===R.compatMode||!o)?a=[i.clientWidth,i.clientHeight]:o&&(a=[s.clientWidth,s.clientHeight]),i=0>=a[0]||0>=a[1]?"":a.join("x"),t.set(oe,i),t.set(re,function(){var t,e;if((e=(e=j.navigator)?e.plugins:null)&&e.length)for(var i=0;i<e.length&&!t;i++){var n=e[i];-1<n.name.indexOf("Shockwave Flash")&&(t=n.description)}if(!t)try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");t=s.GetVariable("$version")}catch(t){}if(!t)try{s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),t="WIN 6,0,21,0",s.AllowScriptAccess="always",t=s.GetVariable("$version")}catch(t){}if(!t)try{t=(s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(t){}return t&&(s=t.match(/[\d]+/g))&&3<=s.length&&(t=s[0]+"."+s[1]+" r"+s[2]),t||void 0}()),t.set(ie,R.characterSet||R.charset),t.set(ae,e&&"function"==typeof e.javaEnabled&&e.javaEnabled()||!1),t.set(ee,(e&&(e.language||e.browserLanguage)||"").toLowerCase()),t.data.set(Ii,A("gclid",!0)),t.data.set(Ni,A("gclsrc",!0)),t.data.set(Ti,Math.round((new Date).getTime()/1e3)),n&&t.get(Ci)&&(e=R.location.hash)){for(e=e.split(/[?&#]+/),n=[],i=0;i<e.length;++i)(w(e[i],"utm_id")||w(e[i],"utm_campaign")||w(e[i],"utm_source")||w(e[i],"utm_medium")||w(e[i],"utm_term")||w(e[i],"utm_content")||w(e[i],"gclid")||w(e[i],"dclid")||w(e[i],"gclsrc"))&&n.push(e[i]);0<n.length&&(e="#"+n.join("&"),t.set(Xt,t.get(Xt)+e))}},ns={pageview:[te],event:[ce,le,he,ue],social:[de,pe,ge],timing:[Ae,xe,Ie,De]},ss=function(t){return"prerender"!=R.visibilityState&&(t(),!0)},os=function(t){if(!ss(t)){p(16);var e=!1,i=function(){if(!e&&ss(t)){e=!0;var n=i,s=R;s.removeEventListener?s.removeEventListener("visibilitychange",n,!1):s.detachEvent&&s.detachEvent("onvisibilitychange",n)}};C(R,"visibilitychange",i)}},as=/^(?:(\w+)\.)?(?:(\w+):)?(\w+)$/,rs=function(t){if(f(t[0]))this.u=t[0];else{var e=as.exec(t[0]);if(null!=e&&4==e.length&&(this.c=e[1]||"t0",this.K=e[2]||"",this.methodName=e[3],this.a=[].slice.call(t,1),this.K||(this.A="create"==this.methodName,this.i="require"==this.methodName,this.g="provide"==this.methodName,this.ba="remove"==this.methodName),this.i&&(3<=this.a.length?(this.X=this.a[1],this.W=this.a[2]):this.a[1]&&(y(this.a[1])?this.X=this.a[1]:this.W=this.a[1]))),e=t[1],t=t[2],!this.methodName)throw"abort";if(this.i&&(!y(e)||""==e))throw"abort";if(this.g&&(!y(e)||""==e||!f(t)))throw"abort";if(cs(this.c)||cs(this.K))throw"abort";if(this.g&&"t0"!=this.c)throw"abort"}};function cs(t){return 0<=t.indexOf(".")||0<=t.indexOf(":")}Kn=new P,Zn=new P,ts=new P,Xn={ec:45,ecommerce:46,linkid:47};var ls=function(t,e,i){e==fs||e.get(ri);var n=Kn.get(t);return!!f(n)&&(e.plugins_=e.plugins_||new P,e.plugins_.get(t)||e.plugins_.set(t,new n(e,i||{})),!0)},hs=function(t,e,i,n,s){if(!f(Kn.get(e))&&!Zn.get(e)){if(Xn.hasOwnProperty(e)&&p(Xn[e]),t=fs.j(t),Pn.test(e)){if(p(52),!t)return!0;i=jn(t.model,e,n,s)}if(!i&&Xn.hasOwnProperty(e)?(p(39),i=e+".js"):p(43),i){if(t){var o=t.get(Mi);y(o)||(o=void 0)}i&&0<=i.indexOf("/")||(i=(o||ot(!1))+"/plugins/ua/"+i),o=(n=gs(i)).protocol,i=R.location.protocol,("https:"==o||o==i||"http:"==o&&"http:"==i)&&ps(n)&&(O(n.url,void 0,s),Zn.set(e,!0))}}},us=function(t,e){var i=ts.get(t)||[];i.push(e),ts.set(t,i)},ds=function(t,e){Kn.set(t,e),e=ts.get(t)||[];for(var i=0;i<e.length;i++)e[i]();ts.set(t,[])},ps=function(t){var e=gs(R.location.href);return!(!w(t.url,at(1))&&!w(t.url,at(2)))||!(t.query||0<=t.url.indexOf("?")||0<=t.path.indexOf("://"))&&(t.host==e.host&&t.port==e.port||(e="http:"==t.protocol?80:443,!("www.google-analytics.com"!=t.host||(t.port||e)!=e||!w(t.path,"/plugins/"))))},gs=function(t){function e(t){var e=t.hostname||"",i=0<=e.indexOf("]");return e=e.split(i?"]":":")[0].toLowerCase(),i&&(e+="]"),i=(t.protocol||"").toLowerCase(),i=1*t.port||("http:"==i?80:"https:"==i?443:""),t=t.pathname||"",w(t,"/")||(t="/"+t),[e,""+i,t]}var i=R.createElement("a");i.href=R.location.href;var n=(i.protocol||"").toLowerCase(),s=e(i),o=i.search||"",a=n+"//"+s[0]+(s[1]?":"+s[1]:"");return w(t,"//")?t=n+t:w(t,"/")?t=a+t:!t||w(t,"?")?t=a+s[2]+(t||o):0>t.split("/")[0].indexOf(":")&&(t=a+s[2].substring(0,s[2].lastIndexOf("/"))+"/"+t),i.href=t,n=e(i),{protocol:(i.protocol||"").toLowerCase(),host:n[0],port:n[1],path:n[2],query:i.search||"",url:t||""}},ms={ga:function(){ms.f=[]}};ms.ga(),ms.D=function(t){var e=ms.J.apply(ms,arguments);for(e=ms.f.concat(e),ms.f=[];0<e.length&&!ms.v(e[0])&&(e.shift(),!(0<ms.f.length)););ms.f=ms.f.concat(e)},ms.J=function(t){for(var e=[],i=0;i<arguments.length;i++)try{var n=new rs(arguments[i]);n.g?ds(n.a[0],n.a[1]):(n.i&&(n.ha=hs(n.c,n.a[0],n.X,n.W)),e.push(n))}catch(t){}return e},ms.v=function(t){try{if(t.u)t.u.call(j,fs.j("t0"));else{var e=t.c==c?fs:fs.j(t.c);if(t.A){if("t0"==t.c&&null===(e=fs.create.apply(fs,t.a)))return!0}else if(t.ba)fs.remove(t.c);else if(e)if(t.i){if(t.ha&&(t.ha=hs(t.c,t.a[0],t.X,t.W)),!ls(t.a[0],e,t.W))return!0}else if(t.K){var i=t.methodName,n=t.a,s=e.plugins_.get(t.K);s[i].apply(s,n)}else e[t.methodName].apply(e,t.a)}}catch(t){}};var fs=function(t){p(1),ms.D.apply(ms,[arguments])};fs.h={},fs.P=[],fs.L=0,fs.ya=0,fs.answer=42;var bs=[di,gi,ri];fs.create=function(t){var e=T(bs,[].slice.call(arguments));e[ri]||(e[ri]="t0");var i=""+e[ri];if(fs.h[i])return fs.h[i];if(K(e))return null;if(e=new Yn(e),fs.h[i]=e,fs.P.push(e),i=ft().tracker_created,f(i))try{i(e)}catch(t){}return e},fs.remove=function(t){for(var e=0;e<fs.P.length;e++)if(fs.P[e].get(ri)==t){fs.P.splice(e,1),fs.h[t]=null;break}},fs.j=function(t){return fs.h[t]},fs.getAll=function(){return fs.P.slice(0)},fs.N=function(){"ga"!=c&&p(49);var t=j[c];if(!t||42!=t.answer){fs.L=t&&t.l,fs.ya=1*new Date,fs.loaded=!0;var e=j[c]=fs;if(Gi("create",e,e.create),Gi("remove",e,e.remove),Gi("getByName",e,e.j,5),Gi("getAll",e,e.getAll,6),Gi("get",e=Yn.prototype,e.get,7),Gi("set",e,e.set,4),Gi("send",e,e.send),Gi("requireSync",e,e.ma),Gi("get",e=Tt.prototype,e.get),Gi("set",e,e.set),"https:"!=R.location.protocol&&!u){t:{e=R.getElementsByTagName("script");for(var i=0;i<e.length&&100>i;i++){var n=e[i].src;if(n&&0==n.indexOf(ot(!0)+"/analytics")){e=!0;break t}}e=!1}e&&(u=!0)}(j.gaplugins=j.gaplugins||{}).Linker=_n,e=_n.prototype,ds("linker",_n),Gi("decorate",e,e.ca,20),Gi("autoLink",e,e.S,25),Gi("passthrough",e,e.$,25),ds("displayfeatures",Gn),ds("adfeatures",Gn),t=t&&t.q,b(t)?ms.D.apply(fs,t):p(50)}};var ys=fs.N,ws=j[c];ws&&ws.r?ys():os(ys),os((function(){ms.D(["provide","render",L])}))}(window)},50:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return o}));const n={superAdmin:"猫国设计师",admin:"猫国城管",catForever:"猫国大护法",catVIPSuper:"助手猫培育师",catVIP:"助手猫观察员",catWatcher:"助手猫瞭望者",catVIPHonor:"猫国荣誉市民",catAirborneCommander:"空降指挥官",catAirbornePilot:"喵营飞行员"},s=["superAdmin","admin","catForever","catVIPSuper","catVIP"],o=["superAdmin","admin","catForever","catVIPSuper"]},80:function(t,e,i){"use strict";var n=i(50);i.d(e,"a",(function(){return n.a})),i.d(e,"b",(function(){return n.b})),i.d(e,"c",(function(){return n.c}))},87:function(t,e,i){"use strict";var n=i(28),s=i.n(n),o=i(29),a=i.n(o),r=i(15),c=i.n(r),l=i(14),h=i.n(l),u=i(12),d=i.n(u),p=i(11),g=i.n(p),m=i(70),f=i.n(m),b=i(71),y=i.n(b),w=i(17),v=i.n(w),L=i(66),S=i.n(L),C=i(6),k=i.n(C),_=i(16),O=i.n(_),A=i(30),x=i.n(A),D=i(1),I=i.n(D),T=i(58),P=i.n(T),N=i(34),E=i.n(N),M=i(203),F=i.n(M),j=i(13),R=i.n(j),B=i(31),q=i.n(B),U=i(40),H=i.n(U);class ${constructor(t,{type:e,dataType:i,limit:n={},delayDuration:s=2e3,initFunc:o}){if(I()(this,"owner",void 0),I()(this,"store",void 0),I()(this,"config",{limit:{size:void 0,duration:void 0}}),I()(this,"delayDuration",1e3),I()(this,"delayTimer",void 0),I()(this,"init",t=>{this.set(t)}),I()(this,"set",(t,e=!1)=>{e&&this.clearCache(!0),void 0!==t&&(this.store=t,this.config.limit.duration&&(this.config.limit.t=H()(),R.a.set(this.configName,this.config))),this.isLocalCache&&!this.delayTimer&&(clearTimeout(this.delayTimer),this.delayDuration?this.delayTimer=setTimeout(()=>{R.a.set(this.name,this.store),this.delayTimer=void 0},this.delayDuration):(R.a.set(this.name,this.store),this.delayTimer=void 0))}),I()(this,"checkExpired",()=>{let t=!1,e=void 0;const{size:i,duration:n,t:s}=this.config.limit;return void 0===(i||n||s)&&(t=!0),this.store instanceof Array&&(e="array",i&&this.store.length>i&&(t=!0)),this.store instanceof q.a&&(e="set",i&&this.store.size>i&&(t=!0)),this.store instanceof x.a&&(e="map",i&&this.store.size>i&&(t=!0)),P()(this.store)&&(e="object",i&&g()(this.store).length>i&&(t=!0)),void 0===e&&(e=typeof this.store),n&&H()()-s>n&&(t=!0),{type:e,expired:t}}),I()(this,"clearCache",(t=!1)=>{const{type:e,expired:i}=this.checkExpired();if(i||t)switch(e){case"array":this.store.length=0;break;case"set":case"map":this.store.clear();break;case"object":this.store={};break;case"string":this.store="";break;case"number":this.store=0;break;case"boolean":this.store=!1;break;default:this.store=void 0}}),I()(this,"remove",()=>{R.a.remove(this.name),R.a.remove(this.configName)}),I()(this,"get",(t=!0)=>(!t&&this.clearCache(),this.store)),!t)throw"invalid owner";this.owner=t,this.dataType=i,this.initFunc=o||$.__dataInitFunc,this.name=t.name+"-cache",this.configName=this.name+"-config",this.isLocalCache="local"===e;const a=R.a.get(this.configName);if(void 0===a?R.a.set(this.configName,this.config):this.config=a,E()(n)&&(this.expired=!0),n.size){if(isNaN(n.size))throw"invalid limit size";this.config.limit.size=+n.size}if(n.duration){if(isNaN(n.duration))throw"invalid limit duration";this.config.limit.duration=+n.duration}if(R.a.set(this.configName,this.config),this.isLocalCache){let t=R.a.get(this.name);this.store=this.initFunc(this.dataType,R.a.get(this.name))||this.initFunc(this.dataType),t||this.set(this.store,!1)}else R.a.remove(this.name),this.dataType&&(this.store=this.initFunc(this.dataType),this.set(this.store,!1));void 0!==s&&(this.delayDuration=s)}}I()($,"__dataInitFunc",(t,e)=>{if(e){if(["number","boolean","string","array","object"].includes(t))return e;switch(t){case"set":return new q.a(e);case"map":return new x.a(e);default:return e}}else switch(t){case"number":return 0;case"boolean":return!1;case"string":return"";case"array":return[];case"set":return new q.a;case"map":return new x.a;case"object":return{};default:return}});var W=i(155);function V(t,e){var i=g()(t);if(d.a){var n=d()(t);e&&(n=n.filter((function(e){return h()(t,e).enumerable}))),i.push.apply(i,n)}return i}function z(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?V(Object(i),!0).forEach((function(e){I()(t,e,i[e])})):c.a?a()(t,c()(i)):V(Object(i)).forEach((function(e){s()(t,e,h()(i,e))}))}return t}i.d(e,"a",(function(){return Q}));const G=["description","title","permissions","dependencies","type","kind","name","hide"];class Q{constructor(t,e=new x.a,i,n={}){I()(this,"__hasInstantiated",!1),I()(this,"__initialized",!1),I()(this,"__launched",!1),I()(this,"emitter",new F.a),I()(this,"emit",async(t,e,i,n=null,s=!0,o=this)=>{"object"==typeof s&&(o=s,s=!0);try{if("*"===t){const t=(s,a=!0)=>{const r=O()(s.bus.values()).map(t=>!!t.emitter.eventNames().includes(e)&&new k.a(n=>{t.emitter.emit(e,i,o,n)}).then(t=>n?n(t):t)).filter(Boolean);return!1===a&&s.app&&s.app.bus&&r.push(...t(s.app,a)),r};return k.a.race(t(this,s))}{let s=Q.queryBusByName(this,t);if(s)return await new k.a(n=>{s.get(t).emitter._events[e]?s.get(t).emitter.emit(e,i,o,n):this.logger.warn(`none eventName in ${t}: `,e)}).then(t=>n?n(t):t);console.log(this),this.logger.warn("none item names: ",t),n&&n(!1)}}catch(a){console.error(a,t,e,i,n,s,o)}}),I()(this,"getStore",(t="default")=>{const e=[this.names.data,t].join("_");return R.a.get(e)}),I()(this,"setStore",(t="default",e)=>{const i=[this.names.data,t].join("_");return R.a.set(i,e),this}),I()(this,"getStorage",(...t)=>new k.a(e=>{chrome.storage.local.get([...t],(function(t){e(t)}))})),I()(this,"setStorage",t=>new k.a((e,i)=>{chrome.storage.local.set(t,(function(){chrome.runtime.lastError?i():e()}))})),I()(this,"getStoreByCompleteName",t=>R.a.get(t)),I()(this,"deleteStoreByCompleteName",t=>{R.a.remove(t)}),I()(this,"getSettingsForUpload",async(t,e,i)=>i()),I()(this,"setSettingsFromCloud",async t=>{await this.onBeforeSetSettingsFromCloud(t),await this.onSetSettingsFromCloud(t),await this.onAfterSetSettingsFromCloud(t)}),I()(this,"onBeforeSetSettingsFromCloud",async()=>{}),I()(this,"onSetSettingsFromCloud",async({settings:t,stores:e})=>{console.log("set setting from cloud",this.name,t,e),await this.setSetting(t),e&&O()(S()(e)).forEach(([t,e])=>{this.setStore(t,e)})}),I()(this,"onAfterSetSettingsFromCloud",async()=>{});const{cache:s,dependencies:o,settings:a,launchAfterInit:r=!0,defaultListener:c=!0}=n;this.app=t,this.launchAfterInit=r,this.defaultListener=c,this.settings=z({},a);try{if(!i)throw"Need name in config";this.name=i,this.logger=new W.a(i),this.names={feature:i,config:i+"-config",data:i+"-data"},this.bus=e,this.bus&&this.bus.set(this.name,this),this.dependencies=o||[],this.__initSetting(a),this.__hasInstantiated=!0}catch(t){this.logger.error(t)}if(s){const{type:t,limit:e,delayDuration:i}=s,n=v()(s,["type","limit","delayDuration"]);this.cache=new $(this,z({type:t,limit:e,delayDuration:i},n))}}__initSetting(t={}){const{on:e}=t;void 0===e&&(t.on=!0);const i=R.a.get(this.names.config),n=Q.mergeConfig(t,i);this.settings=Q.mergeConfig(this.settings,n),R.a.set(this.names.config,Q.simplifyConfig(this.settings))}async onBeforeInit(){}async onInitStore(){}async onInit(){}async onAfterInit(){}async init(){await this.onBeforeInit(),await this.onInit(),await this.onInitStore(),await this.onAfterInit(),this.__initialized=!0,this.defaultListener&&await this.initDefaultListener(),this.launchAfterInit&&await this.launch()}async initDefaultListener(){this.addListener("message",this.onMessageReceived),this.addListener("getSettingsForUpload",this.getSettingsForUpload),this.addListener("setSetting",(t,e,i)=>{let{merge:n=!0}=t,s=v()(t,["merge"]);n&&(s=z(z({},this.settings),s)),this.setSetting(s).then(()=>{i(!0)})}),this.addListener("getSetting",(t,e,i)=>{i(z({},this.settings))})}async onBeforeSetSetting(){}async onSetSetting(t){this.settings=t,R.a.set(this.names.config,Q.simplifyConfig(t))}async onAfterSetSetting(t,e){}async setSetting(t){const e=JSON.parse(y()(this.settings)),i=await this.onBeforeSetSetting(t);await this.onSetSetting(i||t),await this.onAfterSetSetting(e,i||t)}async getSetting(){return this.settings}async onBeforeLaunch(){}async onLaunch(){}async onAfterLaunch(){}async launch(){await this.onBeforeLaunch(),await this.onLaunch(),await this.onAfterLaunch(),this.__launched=!0}async onBeforePause(){}async onPause(){}async onAfterPause(){}async pause(){await this.onBeforePause(),await this.onPause(),await this.onAfterPause(),this.__launched=!1}async onUninstall(){}async uninstall(){await this.onUninstall(),this.__initialized=!1,this.__launched=!1,this.items=new x.a,this.bus=new x.a,this.emitter=new F.a}onMessageReceived(t,e,i){}addListener(t,e){e&&e instanceof Function?(this.emitter.removeAllListeners(t),this.emitter.on(t,e)):console.warn("invalid listener callback",e)}static mergeConfig(t,e){if(void 0===t)return e;if(["string","number","boolean"].includes(typeof t))return typeof t==typeof e?e:t;if(f()(t))return f()(e)?e.map((e,i)=>Q.mergeConfig(t[i],e)):t;if(P()(t)){if(P()(e)){const i={};return g()(t).forEach(n=>{i[n]=Q.mergeConfig(t[n],e[n])}),i}return t}return t}static simplifyConfig(t,e=G,i={}){return["string","number","boolean"].includes(typeof t)?t:(g()(t).forEach(n=>{const s=t[n];if(e.indexOf(n)>-1)return!0;if(f()(s)&&s.length>0)i[n]=s.map(t=>Q.simplifyConfig(t,e));else if(P()(s)){const t=Q.simplifyConfig(s,e,{});E()(t)||(i[n]=t)}else i[n]=s}),i)}}I()(Q,"queryBusByName",(t,e)=>{if(e)return t.bus.has(e)?t.bus:t.app&&t.app.bus?Q.queryBusByName(t.app,e):void 0;console.warn("itemName is invalid",e)})},9:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i(1),s=i.n(n),o=i(87);i(50);class a extends o.a{constructor(t,e,i,n){super(t,e,i,n),s()(this,"__itemType","feature"),s()(this,"bhAccount",null)}async initDefaultListener(){await super.initDefaultListener(),this.addListener("bhAccountChange",(t,e,i)=>{void 0!==t.bhAccount&&(this.bhAccount=t.bhAccount,this.onBHAccountChange(t.bhAccount)),i instanceof Function&&i()}),await this.emit("bilibiliHelperAccountController","getBHAccount",null,t=>{t&&(this.bhAccount=t)})}async onBHAccountChange(){}}},92:function(t,e,i){"use strict";var n=i(49),s=i.n(n),o=i(1),a=i.n(o);class r{constructor(...t){a()(this,"x",void 0),a()(this,"y",void 0),a()(this,"__valid",!1),a()(this,"__needUpdate",!0),a()(this,"set",(...t)=>{if(isNaN(+t[0])||isNaN(+t[1])){if(t[0]instanceof Array&&2===t[0].length)this.set(...t[0]);else if(t[0]instanceof r){const{x:e,y:i}=t[0];this.set(e,i)}}else this.__needUpdate=!0,this.x=+t[0],this.y=+t[1];return this}),a()(this,"setX",t=>(this.x=t,this.__needUpdate=!0,this)),a()(this,"setY",t=>(this.y=t,this.__needUpdate=!0,this)),a()(this,"add",t=>(this.x+=t.x,this.y+=t.y,this)),a()(this,"addX",t=>(this.x+=t,this)),a()(this,"addY",t=>(this.y+=t,this)),a()(this,"sub",t=>(this.x-=t.x,this.y-=t.y,this)),a()(this,"subX",t=>this.addX(-t)),a()(this,"subY",t=>this.addY(-t)),a()(this,"multiply",t=>0===t?this.set(0,0):(this.x*=t,this.y*=t,this)),a()(this,"multiplyX",t=>(0===t?this.x=1/0:this.x*=t,this)),a()(this,"multiplyY",t=>(0===t?this.y=1/0:this.y*=t,this)),a()(this,"divide",t=>0===t?this.set(1/0,1/0):this.multiply(1/t)),a()(this,"divideX",t=>this.multiplyX(1/t)),a()(this,"divideY",t=>this.multiplyY(1/t)),a()(this,"dot",t=>this.x*t.x+this.y+t.y),a()(this,"equal",(...t)=>{if("number"==typeof t[0]&&"number"==typeof t[1])return t[0]===this.x&&t[1]===this.y;if(t[0]instanceof Array&&2===t.length)return this.equal(...t[0]);if(t[0]instanceof r){const{x:e,y:i}=t[0];return this.equal(e,i)}return!1}),a()(this,"normalize",()=>{const t=Math.sqrt(this.x**2+this.y**2);return this.divide(t)}),a()(this,"negtiveX",()=>(this.x*=-1,this)),a()(this,"negtiveY",()=>(this.y*=-1,this)),a()(this,"negtive",()=>this.negtiveX().negtiveY()),a()(this,"round",()=>(this.x=Math.round(this.x),this.y=Math.round(this.y),this)),a()(this,"roundX",()=>(this.x=Math.round(this.x),this)),a()(this,"roundY",()=>(this.y=Math.round(this.y),this)),a()(this,"floor",()=>(this.x=Math.floor(this.x),this.y=Math.floor(this.y),this)),a()(this,"floorX",()=>(this.x=Math.floor(this.x),this)),a()(this,"floorY",()=>(this.y=Math.floor(this.y),this)),a()(this,"ceil",()=>(this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this)),a()(this,"ceilX",()=>(this.x=Math.ceil(this.x),this)),a()(this,"ceilY",()=>(this.y=Math.ceil(this.y),this)),a()(this,"trunc",()=>(this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this)),a()(this,"truncX",()=>(this.x=Math.trunc(this.x),this)),a()(this,"truncY",()=>(this.y=Math.trunc(this.y),this)),a()(this,"clone",()=>new this.constructor(this.x,this.y)),a()(this,"toArray",()=>[this.x,this.y]),a()(this,"toObject",()=>({x:this.x,y:this.y})),a()(this,"toString",(t="x",e="y")=>`${t}${this.x}${e}${this.y}`),this.set(...t)}get zero(){return new this.constructor(0,0)}get infinity(){return new this.constructor(1/0,1/0)}get NaN(){return new this.constructor(NaN,NaN)}get unit(){return new this.constructor(1,1)}get valid(){return this.__needUpdate&&(this.__valid=s()(this.x)&&s()(this.y),this.__needUpdate=!1),this.__valid}get area(){return this.x*this.y}}i.d(e,"a",(function(){return c}));class c extends r{constructor(...t){super(...t)}}}});